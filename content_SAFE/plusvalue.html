<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-adsense-account" content="ca-pub-2209781252231399">
    <!-- Google AdSense -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2209781252231399"
      crossorigin="anonymous"
    ></script>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-TPFZCGX5");
    </script>
    <!-- End Google Tag Manager -->
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-2HNTGCYQ1X"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-2HNTGCYQ1X");
    </script>

    <!-- SEO & Social -->
    <title>
    simulateur plus-value immobiliÃ¨re  2026 â€“ Simulateur | LesCalculateurs</title>
    <meta name="description" content="
    simulateur plus-value immobiliÃ¨re  2026 â€“ Simulateur | LesCalculateurs. Outil gratuit pour estimer votre situation. RÃ©sultat immÃ©diat.">
    <meta
      name="keywords"
      content="plus-value immobiliÃ¨re 2026, calcul impÃ´t plus-value, abattement durÃ©e dÃ©tention, exonÃ©ration plus-value, taux impÃ´t immobilier, vente maison appartement, calculateur plus-value gratuit, barÃ¨mes fiscaux, CGI, rÃ©sidence principale"
    />

    <!-- SEO & Social -->
    <link rel="canonical" href="https://www.lescalculateurs.fr/pages/plusvalue" />
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {"@type": "ListItem", "position": 1, "name": "Accueil", "item": "https://www.lescalculateurs.fr/index"},
        {"@type": "ListItem", "position": 2, "name": "Plus-value immobiliÃ¨re", "item": "https://www.lescalculateurs.fr/pages/plusvalue"}
      ]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Plusâ€‘value immobiliÃ¨re",
      "url": "https://www.lescalculateurs.fr/pages/plusvalue",
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {"@type": "ListItem", "position": 1, "name": "Accueil", "item": "https://www.lescalculateurs.fr/index"},
          {"@type": "ListItem", "position": 2, "name": "Plusâ€‘value immobiliÃ¨re", "item": "https://www.lescalculateurs.fr/pages/plusvalue"}
        ]
      }
    }
    </script>
    <meta property="og:url" content="https://www.lescalculateurs.fr/pages/plusvalue" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Simulateur plus-value immobiliÃ¨re 2026 â€“ Calcul impÃ´t" />
    <meta property="og:description" content="Calculez lâ€™impÃ´t sur votre plus-value immobiliÃ¨re en 2026. Abattements, exonÃ©rations et estimation gratuite." />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Simulateur plus-value immobiliÃ¨re 2026 â€“ Calcul impÃ´t" />
    <meta name="twitter:description" content="Calculez lâ€™impÃ´t sur votre plus-value immobiliÃ¨re en 2026. Abattements, exonÃ©rations et estimation gratuite." />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicon-16x16.png">
    <link rel="manifest" href="../assets/site.webmanifest">
    <link rel="shortcut icon" href="../assets/favicon.ico">

    <script defer src="/third-party-loader.js"></script>

    <!-- WebApplication Schema.org -->
    <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Calculateur Plus-Value ImmobiliÃ¨re 2026",
  "description": "Calculez l'impÃ´t sur la plus-value immobiliÃ¨re avec abattements, graphiques, comparaison et export PDF/PNG.",
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "Web Browser",
  "url": "https://www.lescalculateurs.fr/pages/plusvalue",
  "isBasedOn": [
    "https://www.lescalculateurs.fr/pages/methodologie",
    "https://www.lescalculateurs.fr/pages/sources",
    "https://www.lescalculateurs.fr/pages/comment-calculer-plus-value"
  ],
  "citation": [
    {
      "@type": "CreativeWork",
      "name": "Legifrance.fr â€“ Articles L13 et L14",
      "url": "https://www.legifrance.gouv.fr"
    },
    {
      "@type": "Organization",
      "name": "Direction GÃ©nÃ©rale des Finances Publiques",
      "url": "https://www.impots.gouv.fr"
    },
    {
      "@type": "CreativeWork",
      "name": "Service-public.fr â€“ Plus-values immobiliÃ¨res",
      "url": "https://www.service-public.fr/particuliers/vosdroits/F16623"
    }
  ]
}</script>

    <!-- Sources Meta Tag for AI -->
    <meta name="source" content="legifrance.fr, impots.gouv.fr, service-public.fr">

    <!-- FAQ Schema.org (JSON-LD) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "Quels sont les abattements pour durÃ©e de dÃ©tention ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "ImpÃ´t sur le revenu : 6% par an dÃ¨s la 6Ã¨me annÃ©e, exonÃ©ration totale aprÃ¨s 22 ans. PrÃ©lÃ¨vements sociaux : 1,65% par an de la 6Ã¨me Ã  la 21Ã¨me annÃ©e, puis 9% par an, exonÃ©ration aprÃ¨s 30 ans."
            }
          },
          {
            "@type": "Question",
            "name": "Quels frais puis-je dÃ©duire ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Frais d'acquisition (notaire, droits), travaux d'amÃ©lioration avec factures, ou forfait de 15% du prix d'achat si dÃ©tention > 5 ans. Les frais d'entretien ne sont pas dÃ©ductibles."
            }
          },
          {
            "@type": "Question",
            "name": "La rÃ©sidence principale est-elle taxÃ©e ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Non, la vente de la rÃ©sidence principale est exonÃ©rÃ©e de plus-value immobiliÃ¨re. L'exonÃ©ration s'applique mÃªme si vous Ãªtes propriÃ©taire de plusieurs biens."
            }
          },
          {
            "@type": "Question",
            "name": "Existe-t-il des exonÃ©rations ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Oui : rÃ©sidence principale, petits propriÃ©taires (< 15000 â‚¬ de gain), plus-values infÃ©rieures Ã  1000 â‚¬, et diverses situations professionnelles. VÃ©rifiez votre Ã©ligibilitÃ©."
            }
          },
          {
            "@type": "Question",
            "name": "Quels frais puis-je dÃ©duire ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Frais d'acquisition (notaire, droits), travaux d'amÃ©lioration avec factures, ou forfait de 15% du prix d'achat si dÃ©tention > 5 ans. Les frais d'entretien ne sont pas dÃ©ductibles."
            }
          }
        ]
      }
    </script>
    
    <!-- JSON-LD Calculator Schema -->
    <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Calculator",
  "name": "Calculateur Plus-value ImmobiliÃ¨re 2026",
  "description": "Calculez l'impÃ´t sur votre plus-value immobiliÃ¨re avec abattements et exonÃ©rations 2026 - CGI compliant",
  "url": "https://www.lescalculateurs.fr/pages/plusvalue",
  "applicationCategory": "FinanceApplication",
  "screenshot": "https://www.lescalculateurs.fr/pages/plusvalue"
}</script>
    <!-- Schema.org SoftwareApplication -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Simulateur de plus-value immobiliÃ¨re",
        "operatingSystem": "Web",
        "applicationCategory": "FinanceApplication",
        "description": "Calculateur permettant d'estimer l'imposition sur la plus-value immobiliÃ¨re avec abattements lÃ©gaux.",
        "url": "https://www.lescalculateurs.fr/pages/plus-value-immobiliere",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "EUR"
        }
      }
    </script>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "OÃ¹ trouver le simulateur officiel pour un calcul prÃ©cis ?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Pour un calcul prÃ©cis et personnalisÃ©, utilisez le simulateur officiel sur le site de la CAF (caf.fr) ou notre outil de simulation intÃ©grÃ©. Ces simulateurs prennent en compte votre situation exacte."
      }
    },
    {
      "@type": "Question",
      "name": "Quelle diffÃ©rence entre une estimation et un calcul officiel ?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Une estimation vous donne un ordre de grandeur basÃ© sur des situations types. Le calcul officiel utilise vos donnÃ©es personnelles exactes (revenus, composition familiale, localisation) pour un rÃ©sultat prÃ©cis."
      }
    },
    {
      "@type": "Question",
      "name": "Les montants prÃ©sentÃ©s sont-ils Ã  jour pour 2026 ?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Les montants sont rÃ©guliÃ¨rement mis Ã  jour selon les barÃ¨mes officiels 2026. Cependant, seul le simulateur officiel garantit le montant exact de votre droit."
      }
    },
    {
      "@type": "Question",
      "name": "Comment interprÃ©ter les rÃ©sultats de simulation ?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Les rÃ©sultats sont indicatifs et basÃ©s sur les barÃ¨mes en vigueur. Pour une dÃ©cision administrative, consultez les services compÃ©tents ou utilisez le simulateur officiel."
      }
    }
  ]
}
</script>
</head>
  <body class="bg-gray-50">
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-TPFZCGX5"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col items-center py-4">
          <!-- Logo & Navigation centrÃ©s -->
          <img src="/assets/lescalculateurs-new-logo.png" alt="LesCalculateurs.fr" class="h-10 w-auto mb-2" loading="lazy">
          <div class="flex items-center justify-center space-x-3 mb-2">
            <a href="../index.html" class="flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
              </svg>
              <span>â† Accueil</span>
            </a>
            <span class="text-gray-400">|</span>
            <span class="text-sm font-medium text-gray-700">Plus-value</span>
            <span class="text-xs text-gray-500 ml-2">Abattements 2026</span>
          </div>
        </div>
      </div>
      </div>
    </header>

<div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-center"><p class="text-sm text-gray-800 m-0">Les calculs reposent sur les barÃ¨mes rÃ©glementÃ©s en vigueur et les taux dÃ©partementaux connus Ã  date. Ils constituent une estimation indicative et non contractuelle.</p>
<div class="sticky-ymyl">Cette page donne des ordres de grandeur. Pour un rÃ©sultat fiable, utilisez le simulateur officiel.</div></div>

<!-- Bloc titre dÃ©placÃ© ici -->
<div class="mb-6 text-center">
  <h1>
    Simulateur plus-value immobiliÃ¨re : estimation de lâ€™impÃ´t
   2026</h1>
  <p class="text-base sm:text-lg text-gray-600 mt-2">
    Estimez lâ€™impÃ´t sur votre plus-value immobiliÃ¨re selon le prix dâ€™achat, la durÃ©e de dÃ©tention et les abattements applicables.
  </p>
  <button
    data-scroll-target="#plusvalue-calculator"
    data-scroll-focus="input, select, textarea"
    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-colors shadow-md mt-6 mx-auto block"
  >
    ðŸŸ¢ Lancer la simulation
  </button>
</div>


    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg mb-8">
        <p class="text-blue-800 text-sm mb-2">
          <strong>ðŸ“Œ Simulation Ã  titre indicatif :</strong> Cette estimation ne constitue pas un conseil fiscal. Elle correspond aux rÃ¨gles en vigueur au 1er janvier 2026. VÃ©rifiez votre situation exacte (exonÃ©rations, surtaxe, justificatifs) avant dÃ©claration.
        </p>
        <p class="text-blue-800 text-sm m-0">
          RÃ©sultat affichÃ© : impÃ´t sur le revenu (19 %) + prÃ©lÃ¨vements sociaux (17,environ 1 Ã  3 %) aprÃ¨s abattements 2026.
        </p>
      </div>

      <section class="mb-8 bg-white border border-gray-200 rounded-xl p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">ðŸ“Œ RÃ©sumÃ© rapide</h2>
        <div class="space-y-2 text-gray-700 text-sm">
          <p>ðŸ›ï¸ <strong>Source</strong> : impots.gouv.fr, service-public.fr, legifrance.gouv.fr</p>
          <p>ðŸ“ <strong>Logique</strong> : calcul basÃ© sur prix dâ€™achat/vente, frais, travaux, durÃ©e, type de bien</p>
          <p>ðŸ“… <strong>AnnÃ©e</strong> : paramÃ¨tres 2026</p>
          <p>âš ï¸ <strong>Important</strong> : rÃ©sultat non contractuel</p>
        </div>
      </section>

      <section class="mb-8 bg-indigo-50 border border-indigo-100 rounded-xl p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">ðŸ§¾ Ce que permet ce simulateur</h2>
        <ul class="list-disc list-inside space-y-2 text-gray-700">
          <li>Obtenir un <strong>montant indicatif</strong> dâ€™impÃ´t sur la plusâ€‘value</li>
          <li>Comprendre lâ€™impact de vos paramÃ¨tres</li>
          <li>Comparer plusieurs scÃ©narios</li>
          <li>Croiser avec dâ€™autres outils (notaire, impÃ´t, etc.)</li>
        </ul>
      </section>

      <section class="mb-8 bg-white border border-gray-200 rounded-xl p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">ðŸ§­ Guide rapide (avant de calculer)</h2>

        <h3 class="text-lg font-semibold text-gray-900 mb-2">ðŸ”¹ Comment utiliser ce simulateur</h3>
        <ol class="list-decimal list-inside space-y-2 text-gray-700 text-sm mb-6">
          <li>Renseignez les informations demandÃ©es</li>
          <li>Indiquez vos montants ou paramÃ¨tres principaux</li>
          <li>Lancez la simulation</li>
          <li>Consultez le rÃ©sultat estimatif</li>
        </ol>

        <h3 class="text-lg font-semibold text-gray-900 mb-2">ðŸ”¹ Comment lire les rÃ©sultats</h3>
        <ul class="list-disc list-inside space-y-2 text-gray-700 text-sm mb-6">
          <li><strong>Montant estimÃ©</strong> : ordre de grandeur</li>
          <li><strong>DÃ©tail</strong> : paramÃ¨tres pris en compte</li>
          <li><strong>Avertissement</strong> : dÃ©pend de votre situation rÃ©elle</li>
        </ul>

        <h3 class="text-lg font-semibold text-gray-900 mb-2">ðŸ”¹ Pourquoi le rÃ©sultat peut Ãªtre nul / faible / diffÃ©rent</h3>
        <ul class="list-disc list-inside space-y-2 text-gray-700 text-sm">
          <li>DÃ©passement de seuils rÃ©glementaires</li>
          <li>ParamÃ¨tres non pris en compte dans une simulation simplifiÃ©e</li>
          <li>RÃ¨gles spÃ©cifiques propres Ã  votre dossier</li>
        </ul>
      </section>

      <section class="mb-8 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 rounded-lg p-6">
        <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:gap-6">
          <div class="text-4xl leading-none">ðŸ“Š</div>
          <div class="flex-1">
            <h2 class="text-xl font-bold text-gray-900 mb-2">
              Comparez plusieurs biens et visualisez les Ã©carts (facultatif)
            </h2>
            <p class="text-gray-700 mb-4">
              Faites un calcul pour un bien, puis ajoutez une variante (prix, travaux, durÃ©e de dÃ©tention)
              pour visualiser les Ã©carts et garder une trace de vos rÃ©sultats.
            </p>
            <div class="grid sm:grid-cols-3 gap-4">
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-bold text-gray-900 mb-1">ðŸ—ºï¸ Comparaison</h3>
                <p class="text-sm text-gray-600">
                  Comparez plusieurs biens cÃ´te Ã  cÃ´te.
                </p>
              </div>
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-bold text-gray-900 mb-1">ðŸ“ˆ Graphiques</h3>
                <p class="text-sm text-gray-600">
                  Visualisez instantanÃ©ment les Ã©carts entre scÃ©narios.
                </p>
              </div>
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-bold text-gray-900 mb-1">ðŸ§¾ DÃ©tail</h3>
                <p class="text-sm text-gray-600">
                  Lisez lâ€™IR, les prÃ©lÃ¨vements sociaux et les abattements.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Calculateur -->
      <div id="plusvalue-calculator" class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          ðŸ§® Calcul de votre plus-value immobiliÃ¨re â€” barÃ¨mes 2026
        </h2>

        <form id="plusvalue-form" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Prix de vente (â‚¬)
              </label>
              <input
                type="number"
                id="prixVente"
                placeholder="400000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Prix d'acquisition (â‚¬)
              </label>
              <input
                type="number"
                id="prixAchat"
                placeholder="250000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Frais d'acquisition (â‚¬)
              </label>
              <input
                type="number"
                id="fraisAchat"
                placeholder="25000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
              <p class="text-xs text-gray-500 mt-1">
                Frais de notaire, droits d'enregistrement...
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Travaux et amÃ©liorations (â‚¬)
              </label>
              <input
                type="number"
                id="travaux"
                placeholder="30000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
              <p class="text-xs text-gray-500 mt-1">
                Travaux dÃ©ductibles avec factures
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Date d'acquisition
              </label>
              <input
                type="date"
                id="dateAchat"
                max="2026-12-31"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Date de vente
              </label>
              <input
                type="date"
                id="dateVente"
                max="2026-12-31"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Type de bien
            </label>
            <select
              id="typeBien"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
              <option value="principale">RÃ©sidence principale</option>
              <option value="secondaire">RÃ©sidence secondaire</option>
              <option value="investissement">Investissement locatif</option>
              <option value="terrain">Terrain Ã  bÃ¢tir</option>
            </select>
          </div>

          <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors duration-200"
          >
            ðŸ’° Calculer la plus-value et l'impÃ´t
          </button>
        </form>

        <!-- RÃ©sultats avec graphiques -->
        <div id="results" class="invisible mt-8 min-h-[220px]">
          <!-- Les graphiques seront insÃ©rÃ©s ici dynamiquement -->
        </div>
      </div>

      <!-- Boutons de comparaison -->
      <div class="mt-6 flex justify-center gap-3">
        <button
          id="plusvalue-add-to-compare"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold shadow-md transition-colors"
        >
          âž• Ajouter Ã  la comparaison
        </button>
        <button
          id="plusvalue-add-other"
          class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold shadow-md transition-colors hidden"
        >
          âž• Ajouter un autre bien
        </button>
        <button
          id="plusvalue-reset-compare"
          class="px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 font-semibold shadow-md transition-colors hidden"
        >
          ðŸ”„ RÃ©initialiser
        </button>
      </div>

      <!-- Modal pour ajouter un autre bien -->
      <div id="modal-add-bien" class="hidden fixed inset-0 bg-black bg-opacity-50 justify-center items-center z-50" style="display: none;">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900">âž• Ajouter un autre bien Ã  la comparaison</h2>
            <button
              id="modal-close"
              class="text-gray-500 hover:text-gray-700 font-bold text-2xl"
            >
              âœ•
            </button>
          </div>

          <form id="modal-form" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Prix de vente (â‚¬) *
                </label>
                <input
                  type="number"
                  id="modal-prixVente"
                  placeholder="400000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Prix d'acquisition (â‚¬) *
                </label>
                <input
                  type="number"
                  id="modal-prixAchat"
                  placeholder="250000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Frais d'acquisition (â‚¬)
                </label>
                <input
                  type="number"
                  id="modal-fraisAchat"
                  placeholder="25000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Travaux (â‚¬)
                </label>
                <input
                  type="number"
                  id="modal-travaux"
                  placeholder="30000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Date d'acquisition *
                </label>
                <input
                  type="date"
                  id="modal-dateAchat"
                  max="2026-12-31"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Date de vente *
                </label>
                <input
                  type="date"
                  id="modal-dateVente"
                  max="2026-12-31"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                Type de bien *
              </label>
              <select
                id="modal-typeBien"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                required
              >
                <option value="principale">RÃ©sidence principale</option>
                <option value="secondaire">RÃ©sidence secondaire</option>
                <option value="investissement">Investissement locatif</option>
                <option value="terrain">Terrain Ã  bÃ¢tir</option>
              </select>
            </div>

            <div class="flex gap-3 justify-end mt-6">
              <button
                type="button"
                id="modal-cancel"
                class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-semibold"
              >
                Annuler
              </button>
              <button
                type="submit"
                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"
              >
                âœ… Calculer et ajouter
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Comparaison (masquÃ©e par dÃ©faut) -->
      <div id="plusvalue-comparaison" class="hidden mt-8"></div>

      <!-- Contenu Ã©ditorial (aprÃ¨s l'outil) -->
      <section class="mt-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          ðŸ“˜ Comprendre le calcul de la plus-value (barÃ¨mes 2026)
        </h2>

        <div class="bg-white rounded-lg p-6 shadow-sm mb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">
            â“ Comment calculer la plus-value immobiliÃ¨re en France ?
          </h3>
          <p class="text-gray-700">
            Plus-value brute = Prix de vente âˆ’ Prix de revient (prix dâ€™achat + frais dâ€™acquisition + travaux dÃ©ductibles). Puis, on applique des abattements pour durÃ©e de dÃ©tention (diffÃ©rents pour lâ€™impÃ´t sur le revenu et les prÃ©lÃ¨vements sociaux) avant de calculer lâ€™impÃ´t.
          </p>
        </div>

        <div class="bg-white rounded-lg p-6 shadow-sm mb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-3">ðŸ“Œ RÃ©sumÃ© rapide</h3>
          <ul class="space-y-2 text-gray-700">
            <li><strong>Sources :</strong> CGI (Legifrance) + DGFiP (impots.gouv.fr) + Service-public</li>
            <li><strong>Taux :</strong> 19 % (IR) + 17,environ 1 Ã  3 % (prÃ©lÃ¨vements sociaux), avant surtaxe Ã©ventuelle</li>
            <li><strong>ExonÃ©ration frÃ©quente :</strong> rÃ©sidence principale</li>
            <li><strong>Abattements :</strong> progressifs Ã  partir de la 6e annÃ©e (exonÃ©ration IR aprÃ¨s 22 ans, PS aprÃ¨s 30 ans)</li>
          </ul>
        </div>

        <section class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-8">
          <div class="grid md:grid-cols-2 gap-4">
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">ðŸ“ˆ</div>
              <h3 class="font-bold text-gray-900 mb-1">Base de calcul</h3>
              <p class="text-sm text-gray-600">
                Prix de vente, prix dâ€™achat, frais dâ€™acquisition et travaux dÃ©ductibles.
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">ðŸ“Š</div>
              <h3 class="font-bold text-gray-900 mb-1">Abattements 2026</h3>
              <p class="text-sm text-gray-600">
                Abattements distincts IR / prÃ©lÃ¨vements sociaux selon la durÃ©e de dÃ©tention.
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">âœ…</div>
              <h3 class="font-bold text-gray-900 mb-1">ExonÃ©rations</h3>
              <p class="text-sm text-gray-600">
                RÃ©sidence principale, durÃ©e de dÃ©tention, cas particuliers sous conditions.
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">ðŸ§¾</div>
              <h3 class="font-bold text-gray-900 mb-1">RÃ©sultat lisible</h3>
              <p class="text-sm text-gray-600">
                DÃ©tail chiffrÃ© (base, abattements, IR, prÃ©lÃ¨vements sociaux) + plus-value nette.
              </p>
            </div>
          </div>
        </section>

        <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "Calculer votre plus-value immobiliÃ¨re",
  "description": "Ã‰tapes pour estimer la plus-value et les impÃ´ts avec abattements 2026",
  "step": [
    {
      "@type": "HowToStep",
      "name": "Saisir les montants",
      "text": "Indiquez prix de vente, prix d'achat, frais et travaux."
    },
    {
      "@type": "HowToStep",
      "name": "Renseigner les dates",
      "text": "SÃ©lectionnez dates d'achat et de vente pour calculer la durÃ©e de dÃ©tention."
    },
    {
      "@type": "HowToStep",
      "name": "Choisir le type de bien",
      "text": "RÃ©sidence principale, secondaire, investissement ou terrain."
    },
    {
      "@type": "HowToStep",
      "name": "Calculer",
      "text": "Obtenez plus-value brute, abattements (IR/PS), impÃ´ts et plus-value nette."
    },
    {
      "@type": "HowToStep",
      "name": "Comparer et exporter",
      "text": "Ajoutez des scÃ©narios, comparez les impÃ´ts et exportez en PDF/PNG."
    }
  ]
}</script>
      </section>

      <!-- FAQ Schema.org -->
      <section class="mt-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          â“ Questions frÃ©quentes
        </h2>

        <div class="space-y-4">
          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              Quels sont les abattements pour durÃ©e de dÃ©tention ?
            </h3>
            <div>
              <p class="text-gray-600">
                ImpÃ´t sur le revenu : 6% par an dÃ¨s la 6Ã¨me annÃ©e, exonÃ©ration
                totale aprÃ¨s 22 ans. PrÃ©lÃ¨vements sociaux : 1,65% par an de la
                6Ã¨me Ã  la 21Ã¨me annÃ©e, puis environ 8 Ã  10 % par an, exonÃ©ration aprÃ¨s 30 ans.
              </p>
            </div>
          </div>

          <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">
              Quels frais puis-je dÃ©duire ?
            </h3>
            <div>
              <p class="text-gray-600">
                Frais d'acquisition (notaire, droits), travaux d'amÃ©lioration
                avec factures, ou forfait de 1environ 4 Ã  6 % du prix d'achat si dÃ©tention
                &gt; 5 ans. Les frais d'entretien ne sont pas dÃ©ductibles.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              La rÃ©sidence principale est-elle taxÃ©e ?
            </h3>
            <div>
              <p class="text-gray-600">
                Non, la vente de la rÃ©sidence principale est exonÃ©rÃ©e de
                plus-value immobiliÃ¨re. L'exonÃ©ration s'applique mÃªme si vous
                Ãªtes propriÃ©taire de plusieurs biens.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              Comment est calculÃ© le taux d'imposition ?
            </h3>
            <div>
              <p class="text-gray-600">
                ImpÃ´t sur le revenu : 19% (+ surtaxe si plus-value &gt; 50
                00un montant modeste). PrÃ©lÃ¨vements sociaux : 17,2%. Total : 36,environ 1 Ã  3 % avant
                abattements pour durÃ©e de dÃ©tention.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              Existe-t-il des exonÃ©rations particuliÃ¨res ?
            </h3>
            <div>
              <p class="text-gray-600">
                Oui : premiÃ¨re vente (sous conditions), vente &lt; 15 00un montant modeste,
                retraitÃ©s/invalides sous plafond de revenus, ou rÃ©investissement
                dans la rÃ©sidence principale dans les 24 mois.
              </p>
            </div>
          </div>
        </div>
      </section>

      <section class="mt-16 bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          ðŸ’¡ Exemples chiffrÃ©s (indicatifs)
        </h2>
        <p class="text-gray-600 mb-8">
          Les montants ci-dessous sont des ordres de grandeur. Pour un rÃ©sultat exact, renseignez vos chiffres dans le
          <a href="#plusvalue-calculator" class="text-blue-600 underline font-semibold">simulateur</a>.
        </p>

        <div class="space-y-6">
          <div class="border-l-4 border-blue-500 pl-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-3">
              Exemple 1 : RÃ©sidence secondaire, dÃ©tention 10 ans
            </h3>
            <div class="bg-gray-50 p-4 rounded-lg text-sm space-y-2 mb-3">
              <div><span class="text-gray-700">Vente :</span> <span class="font-medium">400 00un montant modeste</span></div>
              <div><span class="text-gray-700">Achat :</span> <span class="font-medium">250 00un montant modeste</span></div>
              <div><span class="text-gray-700">Frais :</span> <span class="font-medium">25 00un montant modeste</span></div>
              <div><span class="text-gray-700">Travaux :</span> <span class="font-medium">30 00un montant modeste</span></div>
            </div>
            <div class="bg-blue-50 p-4 rounded-lg">
              <p class="text-blue-900 m-0">
                <strong>Ordre de grandeur :</strong> impÃ´ts â‰ˆ <span class="text-xl font-bold text-blue-700">28 00un montant modeste</span> â†’ plus-value nette â‰ˆ <span class="text-xl font-bold text-blue-700">67 00un montant modeste</span>.
              </p>
            </div>
          </div>

          <div class="border-l-4 border-green-500 pl-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-3">
              Exemple 2 : DÃ©tention 25 ans (IR exonÃ©rÃ©, PS encore dus)
            </h3>
            <div class="bg-gray-50 p-4 rounded-lg text-sm space-y-2 mb-3">
              <div><span class="text-gray-700">Plus-value brute :</span> <span class="font-medium">100 00un montant modeste</span></div>
              <div><span class="text-gray-700">Abattement IR :</span> <span class="font-medium">10environ 0 Ã  1 %</span></div>
              <div><span class="text-gray-700">Abattement PS :</span> <span class="font-medium">â‰ˆ 5environ 4 Ã  6 %</span></div>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
              <p class="text-green-900 m-0">
                <strong>Ordre de grandeur :</strong> prÃ©lÃ¨vements sociaux â‰ˆ <span class="text-xl font-bold text-green-700">7 70un montant modeste</span>.
              </p>
            </div>
          </div>

          <div class="border-l-4 border-purple-500 pl-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-3">
              Exemple 3 : DÃ©tention 30 ans (exonÃ©ration totale)
            </h3>
            <div class="bg-purple-50 p-4 rounded-lg">
              <p class="text-purple-900 m-0">
                <strong>RÃ©sultat :</strong> impÃ´ts = <span class="text-xl font-bold text-purple-700">un montant modeste</span>.
              </p>
            </div>
          </div>
        </div>
      </section>

    </main>

    <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
      <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
        <h3 class="text-xl font-bold text-gray-900 mb-3">ðŸ”— Voir aussi</h3>
        <p class="text-sm text-gray-600 mb-3">
          Parcours fiscal immobilier :
          <a href="/pages/pret.html" class="text-blue-700 hover:underline">PrÃªt</a>
          â†’
          <a href="/pages/plusvalue.html" class="text-blue-700 hover:underline">Plusâ€‘value</a>
          â†’
          <a href="/pages/impot.html" class="text-blue-700 hover:underline">ImpÃ´t</a>
        </p>
        <div class="flex flex-wrap gap-3">
          <a href="/pages/apl.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">APL 2026</a>
          <a href="/pages/notaire.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Frais de notaire</a>
          <a href="/pages/pret.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">MensualitÃ© de prÃªt</a>
          <a href="/pages/charges.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Charges de copropriÃ©tÃ©</a>
          <a href="/pages/taxe.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Taxe fonciÃ¨re</a>
          <a href="/pages/impot.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">ImpÃ´t sur le revenu</a>
          <a href="/pages/ik.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">IndemnitÃ©s kilomÃ©triques (IK)</a>
          <a href="/pages/travail.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Temps de travail</a>
          <a href="/pages/blog/frais-notaire-departements.html" class="inline-block bg-blue-600 text-white rounded px-4 py-2 text-sm font-semibold shadow hover:bg-blue-700">Tous les dÃ©partements</a>
          <a href="/pages/blog.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Blog</a>
        </div>
      </div>
    </section>

    <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
      <div class="mt-12 bg-blue-50 rounded-lg p-6 border border-blue-200">
        <h3 class="font-bold text-blue-900 mb-3">ðŸ“š Sources 2026</h3>
        <ul class="text-sm text-gray-700 space-y-2">
          <li>
            â€¢ Plus-value immobiliÃ¨re (rÃ¨gles 2026):
            <a href="https://www.service-public.fr/particuliers/vosdroits/F10864" target="_blank" rel="noopener" class="text-blue-600 hover:underline">service-public.fr</a>
          </li>
          <li>
            â€¢ Informations officielles et dÃ©marches:
            <a href="https://www.impots.gouv.fr/particulier/questions/je-vends-mon-bien-immobilier-vais-je-payer-de-la-plus-value-immobiliere" target="_blank" rel="noopener" class="text-blue-600 hover:underline">impots.gouv.fr</a>
          </li>
        </ul>
      </div>
    </section>

    <footer class="bg-gray-800 text-white py-8 mt-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col items-center space-y-4">
          <p class="text-gray-300">
            Â© 2026 Les Calculateurs - Plus-value immobiliÃ¨re selon barÃ¨mes officiels
          </p>
          <div class="flex gap-4 text-sm">
            <a href="/pages/methodologie" class="text-gray-300 hover:text-white transition-colors">ðŸ“š Notre MÃ©thodologie</a>
            <span class="text-gray-500">|</span>
            <a href="/pages/sources" class="text-gray-300 hover:text-white transition-colors">ðŸ›ï¸ Sources Officielles</a>
          </div>
        </div>
      </div>
    </footer>

    <script type="module" src="../main.ts"></script>
    <script type="module">
      let __lcChartPromise;
      function __lcLoadChart() {
        if (__lcChartPromise) return __lcChartPromise;
        __lcChartPromise = import("chart.js/auto").then((mod) => {
          return mod.Chart || mod.default || mod;
        });
        return __lcChartPromise;
      }

      document
        .getElementById("plusvalue-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const prixVente =
            parseFloat(document.getElementById("prixVente").value) || 0;
          const prixAchat =
            parseFloat(document.getElementById("prixAchat").value) || 0;
          const fraisAchat =
            parseFloat(document.getElementById("fraisAchat").value) || 0;
          const travaux =
            parseFloat(document.getElementById("travaux").value) || 0;
          const dateAchat = new Date(
            document.getElementById("dateAchat").value
          );
          const dateVente = new Date(
            document.getElementById("dateVente").value
          );
          const typeBien = document.getElementById("typeBien").value;

          if (!prixVente || !prixAchat || !dateAchat || !dateVente) {
            alert("Veuillez remplir tous les champs obligatoires");
            return;
          }

          // Calcul de la durÃ©e de dÃ©tention
          const dureeMs = dateVente - dateAchat;
          const dureeAnnes = dureeMs / (1000 * 60 * 60 * 24 * 365.25);
          const dureeAnneesEntier = Math.floor(dureeAnnes);

          // Prix de revient
          let prixRevient = prixAchat + fraisAchat + travaux;

          // Abattement forfaitaire de 15% si dÃ©tention > 5 ans (optionnel)
          if (dureeAnnes > 5) {
            const abattementForfait = prixAchat * 0.15;
            if (abattementForfait > travaux) {
              prixRevient = prixAchat + fraisAchat + abattementForfait;
            }
          }

          // Plus-value brute
          const plusValueBrute = prixVente - prixRevient;

          const typeBienLabel =
            typeBien === "principale"
              ? "RÃ©sidence principale"
              : typeBien === "secondaire"
              ? "RÃ©sidence secondaire"
              : typeBien === "investissement"
              ? "Investissement locatif"
              : "Terrain Ã  bÃ¢tir";

          const forfaitTravauxApplique =
            dureeAnnes > 5 && prixAchat * 0.15 > travaux;

          if (plusValueBrute <= 0) {
            window.plusValueData = {
              prixVente,
              prixAchat,
              fraisAchat,
              travaux,
              dateAchat,
              dateVente,
              typeBien,
              dureeDetention: dureeAnnes,
              prixRevient: prixRevient,
              plusValueBrute,
              abattementIR: 0,
              abattementPS: 0,
              plusValueIR: 0,
              plusValuePS: 0,
              impotIR: 0,
              impotPS: 0,
              surtaxe: 0,
              impotTotal: 0,
              plusValueNette: plusValueBrute,
            };

            document.getElementById("results").innerHTML = `
            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-blue-900 mb-4">âœ… Aucun impÃ´t Ã  payer</h3>
              <p class="text-gray-700">Vous n'avez pas de plus-value imposable. La vente gÃ©nÃ¨re une moins-value de <strong>${Math.abs(
                plusValueBrute
              ).toLocaleString("fr-FR")} â‚¬</strong>.</p>
              <div class="mt-4 bg-white border border-blue-200 rounded-lg p-4">
                <h4 class="font-semibold text-gray-900 mb-2">Pourquoi un montant modeste ?</h4>
                <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                  <li>Le prix de vente est infÃ©rieur (ou proche) du prix de revient (achat + frais + travaux retenus).</li>
                  <li>Une moins-value nâ€™est pas imposable au titre de la plus-value immobiliÃ¨re.</li>
                  <li>VÃ©rifiez que les frais/travaux saisis correspondent bien Ã  des montants dÃ©ductibles.</li>
                </ul>
              </div>
            </div>
          `;
            document.getElementById("results").classList.remove("invisible");
            return;
          }

          if (typeBien === "principale") {
            window.plusValueData = {
              prixVente,
              prixAchat,
              fraisAchat,
              travaux,
              dateAchat,
              dateVente,
              typeBien,
              dureeDetention: dureeAnnes,
              prixRevient: prixRevient,
              plusValueBrute,
              abattementIR: 100,
              abattementPS: 100,
              plusValueIR: 0,
              plusValuePS: 0,
              impotIR: 0,
              impotPS: 0,
              surtaxe: 0,
              impotTotal: 0,
              plusValueNette: plusValueBrute,
            };

            document.getElementById("results").innerHTML = `
            <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-green-900 mb-4">âœ… ExonÃ©ration rÃ©sidence principale</h3>
              <p class="text-gray-700">La plus-value sur la vente de votre rÃ©sidence principale est exonÃ©rÃ©e d'impÃ´t (IR et prÃ©lÃ¨vements sociaux). Aucune imposition n'est due.</p>
              <div class="mt-4 bg-white border border-green-200 rounded-lg p-4">
                <h4 class="font-semibold text-gray-900 mb-2">Pourquoi un montant modeste ?</h4>
                <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                  <li>La cession de la rÃ©sidence principale est exonÃ©rÃ©e (sous conditions).</li>
                  <li>Les autres biens (secondaire/locatif/terrain) restent en principe imposables.</li>
                  <li>En cas de doute (occupation, dÃ©pendances, dÃ©lais), vÃ©rifiez la doctrine officielle.</li>
                </ul>
              </div>
            </div>
            `;
            document.getElementById("results").classList.remove("invisible");
            return;
          }

          // Calcul des abattements selon la durÃ©e
          let abattementIR = 0; // ImpÃ´t sur le revenu
          let abattementPS = 0; // PrÃ©lÃ¨vements sociaux

          if (dureeAnnes >= 22) {
            abattementIR = 100; // ExonÃ©ration totale
          } else if (dureeAnnes >= 6) {
            abattementIR = (dureeAnneesEntier - 5) * 6;
          }

          if (dureeAnneesEntier >= 30) {
            abattementPS = 100;
          } else if (dureeAnneesEntier >= 23) {
            abattementPS = 28 + (dureeAnneesEntier - 22) * 9;
          } else if (dureeAnneesEntier === 22) {
            abattementPS = 28;
          } else if (dureeAnneesEntier >= 6) {
            abattementPS = (dureeAnneesEntier - 5) * 1.65;
          }

          // Application des abattements
          const plusValueIR = plusValueBrute * (1 - abattementIR / 100);
          const plusValuePS = plusValueBrute * (1 - abattementPS / 100);

          // Calcul de l'impÃ´t
          const tauxIR = 0.19; // 19%
          const tauxPS = 0.172; // 17,2%

          let impotIR = plusValueIR * tauxIR;
          const impotPS = plusValuePS * tauxPS;

          // Surtaxe si plus-value IR > 50 000â‚¬
          let surtaxe = 0;
          if (plusValueIR > 50000) {
            const tranche = plusValueIR - 50000;
            if (tranche <= 10000) surtaxe = tranche * 0.02;
            else if (tranche <= 20000) surtaxe = 200 + (tranche - 10000) * 0.03;
            else if (tranche <= 30000) surtaxe = 500 + (tranche - 20000) * 0.04;
            else if (tranche <= 40000) surtaxe = 900 + (tranche - 30000) * 0.05;
            else surtaxe = 1400 + (tranche - 40000) * 0.06;
          }

          const impotTotal = impotIR + surtaxe + impotPS;
          const plusValueNette = plusValueBrute - impotTotal;

          function formatCurrency(amount) {
            return new Intl.NumberFormat("fr-FR", {
              style: "currency",
              currency: "EUR",
            }).format(amount);
          }

          if (dureeAnneesEntier >= 30) {
            window.plusValueData = {
              prixVente,
              prixAchat,
              fraisAchat,
              travaux,
              dateAchat,
              dateVente,
              typeBien,
              dureeDetention: dureeAnnes,
              prixRevient: prixRevient,
              plusValueBrute,
              abattementIR,
              abattementPS,
              plusValueIR,
              plusValuePS,
              impotIR: 0,
              impotPS: 0,
              surtaxe: 0,
              impotTotal: 0,
              plusValueNette: plusValueBrute,
            };

            document.getElementById("results").innerHTML = `
              <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
                <h3 class="text-xl font-bold text-green-900 mb-4">âœ… ExonÃ©ration liÃ©e Ã  la durÃ©e de dÃ©tention</h3>
                <p class="text-gray-700">
                  AprÃ¨s <strong>30 ans</strong> de dÃ©tention, la plus-value est exonÃ©rÃ©e de prÃ©lÃ¨vements sociaux, et l'IR lâ€™est dÃ©jÃ  aprÃ¨s 22 ans. Aucune imposition n'est due.
                </p>
                <div class="mt-4 bg-white border border-green-200 rounded-lg p-4">
                  <h4 class="font-semibold text-gray-900 mb-2">DÃ©tail</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                    <div><span class="text-gray-600">Plus-value brute :</span> <strong>${formatCurrency(plusValueBrute)}</strong></div>
                    <div><span class="text-gray-600">DurÃ©e :</span> <strong>${dureeAnneesEntier} ans</strong></div>
                    <div><span class="text-gray-600">Abattement IR :</span> <strong>${abattementIR.toFixed(1)}%</strong></div>
                    <div><span class="text-gray-600">Abattement PS :</span> <strong>${abattementPS.toFixed(1)}%</strong></div>
                  </div>
                </div>
              </div>
            `;
            document.getElementById("results").classList.remove("invisible");
            document.getElementById("plusvalue-add-to-compare")?.classList.remove("hidden");
            return;
          }

          // CrÃ©er un ID unique pour les graphiques
          const chartTimestamp = Date.now() + Math.random();
          
          const results = `
          <div class="space-y-6">
            <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
              <h3 class="text-xl font-bold text-gray-900 mb-4">ðŸŽ¯ RÃ©sultat principal</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                  <p class="text-sm text-gray-600">Total des impÃ´ts</p>
                  <p class="text-2xl font-bold text-red-700">${formatCurrency(impotTotal)}</p>
                </div>
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                  <p class="text-sm text-gray-600">Plus-value nette</p>
                  <p class="text-2xl font-bold text-purple-700">${formatCurrency(plusValueNette)}</p>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <p class="text-sm text-gray-600">Taux effectif</p>
                  <p class="text-2xl font-bold text-blue-700">${(
                    (impotTotal / plusValueBrute) *
                    100
                  ).toFixed(1)}%</p>
                </div>
              </div>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-blue-900 mb-3">ðŸ§  Logique de calcul (simplifiÃ©e)</h3>
              <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                <li>Plus-value brute = Prix de vente âˆ’ (Prix dâ€™achat + frais + travaux retenus)</li>
                <li>Plus-value taxable IR = Plus-value brute Ã— (1 âˆ’ abattement IR)</li>
                <li>Plus-value taxable PS = Plus-value brute Ã— (1 âˆ’ abattement PS)</li>
                <li>ImpÃ´t = (IR 19 % + prÃ©lÃ¨vements sociaux 17,environ 1 Ã  3 % + surtaxe Ã©ventuelle) appliquÃ©s aux bases taxables</li>
              </ul>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-blue-900 mb-4">ðŸ“Š DÃ©tail chiffrÃ© (Ã©tape par Ã©tape)</h3>
              <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-200 rounded-lg text-sm">
                  <tbody>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Prix de vente</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(prixVente)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Prix d'achat</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(prixAchat)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Frais d'acquisition</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(fraisAchat)}</td></tr>
                    <tr class="border-b">
                      <td class="px-4 py-3 text-gray-600">Travaux retenus</td>
                      <td class="px-4 py-3 font-semibold text-gray-900 text-right">
                        ${formatCurrency(forfaitTravauxApplique ? prixAchat * 0.15 : travaux)}
                        ${forfaitTravauxApplique ? '<span class="text-xs text-gray-500">(forfait 1environ 4 Ã  6 % &gt; travaux saisis)</span>' : ''}
                      </td>
                    </tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Prix de revient</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(prixRevient)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Plus-value brute</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(plusValueBrute)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">DurÃ©e de dÃ©tention</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${dureeAnneesEntier} ans ${Math.round((dureeAnnes - dureeAnneesEntier) * 12)} mois</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Abattement IR</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${abattementIR.toFixed(1)}%</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Abattement PS</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${abattementPS.toFixed(1)}%</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Base taxable IR</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(plusValueIR)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Base taxable PS</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(plusValuePS)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">ImpÃ´t sur le revenu (1environ 8 Ã  10 %)</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(impotIR)}</td></tr>
                    ${surtaxe > 0 ? `<tr class="border-b"><td class="px-4 py-3 text-gray-600">Surtaxe</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(surtaxe)}</td></tr>` : ''}
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">PrÃ©lÃ¨vements sociaux (17,environ 1 Ã  3 %)</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(impotPS)}</td></tr>
                    <tr class="bg-gray-50"><td class="px-4 py-3 font-bold text-gray-900">Total impÃ´ts</td><td class="px-4 py-3 font-bold text-red-700 text-right">${formatCurrency(impotTotal)}</td></tr>
                    <tr class="bg-gray-50"><td class="px-4 py-3 font-bold text-gray-900">Plus-value nette</td><td class="px-4 py-3 font-bold text-purple-700 text-right">${formatCurrency(plusValueNette)}</td></tr>
                  </tbody>
                </table>
<div class="ymyl-alert" role="alert">
  <strong>Estimation indicative.</strong> Montant rÃ©el uniquement via simulateur officiel <a href="https://www.caf.fr" target="_blank" rel="noopener">CAF</a> ou <a href="/simulateur">notre outil officiel</a>.
</div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <p class="text-sm text-gray-600">DurÃ©e de dÃ©tention</p>
                  <p class="text-lg font-semibold text-gray-900">${dureeAnneesEntier} ans ${Math.round(
            (dureeAnnes - dureeAnneesEntier) * 12
          )} mois</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Prix de revient</p>
                  <p class="text-lg font-semibold text-gray-900">${formatCurrency(
                    prixRevient
                  )}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Plus-value brute</p>
                  <p class="text-lg font-semibold text-gray-900">${formatCurrency(
                    plusValueBrute
                  )}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Type de bien</p>
                  <p class="text-lg font-semibold text-gray-900">${typeBienLabel}</p>
                </div>
              </div>
            </div>

            <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-green-900 mb-4">ðŸ’° Abattements appliquÃ©s</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600">Abattement impÃ´t sur le revenu :</span>
                  <span class="font-semibold text-green-700">${abattementIR.toFixed(
                    1
                  )}%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Abattement prÃ©lÃ¨vements sociaux :</span>
                  <span class="font-semibold text-green-700">${abattementPS.toFixed(
                    1
                  )}%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Plus-value taxable (IR) :</span>
                  <span class="font-semibold">${formatCurrency(
                    plusValueIR
                  )}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Plus-value taxable (PS) :</span>
                  <span class="font-semibold">${formatCurrency(
                    plusValuePS
                  )}</span>
                </div>
              </div>
            </div>

            <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-red-900 mb-4">ðŸ’¸ ImpÃ´ts Ã  payer</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600">ImpÃ´t sur le revenu (1environ 8 Ã  10 %) :</span>
                  <span class="font-semibold">${formatCurrency(impotIR)}</span>
                </div>
                ${
                  surtaxe > 0
                    ? `
                <div class="flex justify-between">
                  <span class="text-gray-600">Surtaxe (plus-value &gt; 50kâ‚¬) :</span>
                  <span class="font-semibold">${formatCurrency(surtaxe)}</span>
                </div>
                `
                    : ""
                }
                <div class="flex justify-between">
                  <span class="text-gray-600">PrÃ©lÃ¨vements sociaux (17,environ 1 Ã  3 %) :</span>
                  <span class="font-semibold">${formatCurrency(impotPS)}</span>
                </div>
                <div class="border-t pt-2 flex justify-between text-lg">
                  <span class="font-bold text-gray-900">Total des impÃ´ts :</span>
                  <span class="font-bold text-red-700">${formatCurrency(
                    impotTotal
                  )}</span>
                </div>
              </div>
            </div>

            <div class="bg-purple-50 border-l-4 border-purple-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-purple-900 mb-4">ðŸŽ¯ RÃ©sultat final</h3>
              <div class="space-y-3">
                <div class="flex justify-between text-lg">
                  <span class="font-bold text-gray-900">Plus-value nette (aprÃ¨s impÃ´ts) :</span>
                  <span class="font-bold text-purple-700">${formatCurrency(
                    plusValueNette
                  )}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Taux d'imposition effectif :</span>
                  <span class="font-semibold">${(
                    (impotTotal / plusValueBrute) *
                    100
                  ).toFixed(1)}%</span>
                </div>
              </div>
            </div>

            <div class="text-sm text-gray-500 bg-gray-50 p-4 rounded">
              <p><strong>ðŸ’¡ Bon Ã  savoir :</strong></p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li>ExonÃ©ration totale aprÃ¨s 30 ans de dÃ©tention</li>
                <li>La rÃ©sidence principale est toujours exonÃ©rÃ©e</li>
                <li>PossibilitÃ© d'abattement forfaitaire de 1environ 4 Ã  6 % si dÃ©tention > 5 ans</li>
                <li>Ces calculs sont indicatifs, consultez un fiscaliste</li>
              </ul>
            </div>

            <!-- Graphiques (affichÃ©s seulement s'il y a des impÃ´ts) -->
            ${impotTotal && impotTotal > 0 ? `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
              <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-900 mb-4">ðŸ“Š Ventilation des impÃ´ts</h3>
                <div style="position: relative; height: 300px; width: 100%;">
                  <canvas id="chart-impots-${chartTimestamp}"></canvas>
                </div>
              </div>
              <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-900 mb-4">ðŸ“ˆ Abattements selon durÃ©e</h3>
                <div style="position: relative; height: 300px; width: 100%;">
                  <canvas id="chart-abattements-${chartTimestamp}"></canvas>
                </div>
              </div>
            </div>
            ` : ''}
          </div>
        `;

          window.plusValueData = {
            prixVente,
            prixAchat,
            fraisAchat,
            travaux,
            dateAchat,
            dateVente,
            typeBien,
            dureeDetention: dureeAnnes,
            prixRevient: prixRevient,
            plusValueBrute,
            abattementIR,
            abattementPS,
            plusValueIR,
            plusValuePS,
            impotIR,
            impotPS,
            surtaxe,
            impotTotal,
            plusValueNette
          };

          document.getElementById("results").innerHTML = results;
          document.getElementById("results").classList.remove("invisible");
          
          // Ne pas masquer le bouton "Ajouter Ã  la comparaison" - on peut ajouter plusieurs fois
          document.getElementById("plusvalue-add-to-compare")?.classList.remove("hidden");
          
          // GÃ©nÃ©rer les graphiques aprÃ¨s un court dÃ©lai pour que les canvas soient dans le DOM
          // Uniquement si ce ne sont pas des cas d'exonÃ©ration (rÃ©sidence principale ou moins-value)
          if (impotTotal && impotTotal > 0) {
            setTimeout(async () => {
              const Chart = await __lcLoadChart();
              // Trouver les canvas gÃ©nÃ©rÃ©s avec les IDs spÃ©cifiques
              const chartImpotsId = `chart-impots-${chartTimestamp}`;
              const chartAbattementsId = `chart-abattements-${chartTimestamp}`;
              
              const chartImpotsCanvas = document.getElementById(chartImpotsId);
              const chartAbattementsCanvas = document.getElementById(chartAbattementsId);

              // Graphique 1: Ventilation des impÃ´ts
              if (chartImpotsCanvas) {
                const ctxImpots = chartImpotsCanvas.getContext('2d');
                if (ctxImpots) {
                  new Chart(ctxImpots, {
                    type: 'doughnut',
                    data: {
                      labels: ['ImpÃ´t sur revenu', 'Surtaxe', 'PrÃ©lÃ¨vements sociaux'],
                      datasets: [{
                        data: [impotIR, surtaxe, impotPS],
                        backgroundColor: ['#ef4444', '#f59e0b', '#8b5cf6'],
                        borderColor: '#fff',
                        borderWidth: 2
                      }]
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                          callbacks: {
                            label: function(context) {
                              const amount = context.parsed;
                              return formatCurrency(amount) + ' (' + ((amount / impotTotal) * 100).toFixed(1) + '%)';
                            }
                          }
                        }
                      }
                    }
                  });
                }
              }

              // Graphique 2: Ã‰volution des abattements
              if (chartAbattementsCanvas) {
                const ctxAbattements = chartAbattementsCanvas.getContext('2d');
                if (ctxAbattements) {
                  const yearsData = [];
                  const abattementIRData = [];
                  const abattementPSData = [];

                  for (let year = 0; year <= 30; year++) {
                    yearsData.push(year);
                    
                    let irAbat = 0;
                    if (year >= 22) irAbat = 100;
                    else if (year >= 6) irAbat = (year - 5) * 6;
                    
                    let psAbat = 0;
                    if (year >= 30) psAbat = 100;
                    else if (year >= 23) psAbat = 28 + (year - 22) * 9;
                    else if (year === 22) psAbat = 28;
                    else if (year >= 6) psAbat = (year - 5) * 1.65;
                    
                    abattementIRData.push(irAbat);
                    abattementPSData.push(psAbat);
                  }

                  new Chart(ctxAbattements, {
                    type: 'line',
                    data: {
                      labels: yearsData,
                      datasets: [
                        {
                          label: 'Abattement IR',
                          data: abattementIRData,
                          borderColor: '#ef4444',
                          backgroundColor: 'rgba(239, 68, 68, 0.1)',
                          borderWidth: 2,
                          fill: true,
                          pointRadius: 2
                        },
                        {
                          label: 'Abattement PS',
                          data: abattementPSData,
                          borderColor: '#8b5cf6',
                          backgroundColor: 'rgba(139, 92, 246, 0.1)',
                          borderWidth: 2,
                          fill: true,
                          pointRadius: 2
                        }
                      ]
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                          callbacks: {
                            label: function(context) {
                              return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                            }
                          }
                        }
                      },
                      scales: {
                        y: {
                          beginAtZero: true,
                          max: 100,
                          ticks: { callback: function(v) { return v + '%'; } }
                        },
                        x: {
                          title: { display: true, text: 'AnnÃ©es de dÃ©tention' }
                        }
                      }
                    }
                  });
                }
              }
            }, 200);
          }

          document
            .getElementById("results")
            .scrollIntoView({ behavior: "smooth" });
        });

      // Initialiser les dates par dÃ©faut
      document.addEventListener("DOMContentLoaded", () => {
        const today = new Date();
        const fiveYearsAgo = new Date();
        fiveYearsAgo.setFullYear(today.getFullYear() - 5);

        document.getElementById("dateVente").value = today
          .toISOString()
          .split("T")[0];
        document.getElementById("dateAchat").value = fiveYearsAgo
          .toISOString()
          .split("T")[0];

        // Initialiser les dates du modal aussi
        document.getElementById("modal-dateVente").value = today
          .toISOString()
          .split("T")[0];
        document.getElementById("modal-dateAchat").value = fiveYearsAgo
          .toISOString()
          .split("T")[0];

        // Event listeners pour comparaison
        import("../components/PlusValueComparison.ts").then(({ PlusValueComparison }) => {
          // Initialiser le conteneur de comparaison
          PlusValueComparison.initialize("plusvalue-comparaison");

          const addBtn = document.getElementById("plusvalue-add-to-compare");
          const addOtherBtn = document.getElementById("plusvalue-add-other");
          const resetBtn = document.getElementById("plusvalue-reset-compare");
          const modal = document.getElementById("modal-add-bien");
          const modalForm = document.getElementById("modal-form");
          const modalClose = document.getElementById("modal-close");
          const modalCancel = document.getElementById("modal-cancel");

          // Ouvrir/fermer le modal
          function openModal() {
            modal.style.display = "flex";
          }

          function closeModal() {
            modal.style.display = "none";
            modalForm.reset();
          }

          // Fermer le modal en cliquant sur le X ou Annuler
          modalClose.addEventListener("click", closeModal);
          modalCancel.addEventListener("click", closeModal);

          // Fermer le modal en cliquant en dehors
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              closeModal();
            }
          });

          if (addBtn && resetBtn && addOtherBtn) {
            // Bouton Ajouter Ã  la comparaison (premier bien)
            addBtn.addEventListener("click", () => {
              if (window.plusValueData && window.plusValueData.impotTotal !== undefined) {
                PlusValueComparison.addComparison(window.plusValueData);
                
                // DÃ‰SACTIVER le bouton Ajouter
                addBtn.disabled = true;
                addBtn.classList.add("opacity-50", "cursor-not-allowed");
                addBtn.classList.remove("hover:bg-blue-700");
                
                // AFFICHER le bouton Ajouter un autre bien
                addOtherBtn.classList.remove("hidden");
                
                // Afficher le bouton rÃ©initialiser et la section comparaison
                resetBtn.classList.remove("hidden");
                document.getElementById("plusvalue-comparaison").classList.remove("hidden");
                document.getElementById("plusvalue-comparaison").scrollIntoView({ behavior: "smooth" });
              } else {
                alert("Veuillez d'abord effectuer un calcul");
              }
            });

            // Bouton Ajouter un autre bien (ouvre le modal)
            addOtherBtn.addEventListener("click", () => {
              openModal();
            });

            // Bouton RÃ©initialiser
            resetBtn.addEventListener("click", () => {
              PlusValueComparison.clearAll();
              
              // RÃ©initialiser les boutons
              addBtn.disabled = false;
              addBtn.classList.remove("opacity-50", "cursor-not-allowed");
              addBtn.classList.add("hover:bg-blue-700");
              addOtherBtn.classList.add("hidden");
              resetBtn.classList.add("hidden");
              document.getElementById("plusvalue-comparaison").classList.add("hidden");
              
              // RÃ©initialiser le formulaire principal
              document.getElementById("plusvalue-form").reset();
              document.getElementById("results").classList.add("invisible");
              closeModal();
            });

            // Bouton Calculer et ajouter (dans le modal)
            modalForm.addEventListener("submit", function(e) {
              e.preventDefault();

              // RÃ©cupÃ©rer les valeurs du modal
              const prixVente = parseFloat(document.getElementById("modal-prixVente").value) || 0;
              const prixAchat = parseFloat(document.getElementById("modal-prixAchat").value) || 0;
              const fraisAchat = parseFloat(document.getElementById("modal-fraisAchat").value) || 0;
              const travaux = parseFloat(document.getElementById("modal-travaux").value) || 0;
              const dateAchat = new Date(document.getElementById("modal-dateAchat").value);
              const dateVente = new Date(document.getElementById("modal-dateVente").value);
              const typeBien = document.getElementById("modal-typeBien").value;

              if (!prixVente || !prixAchat || !dateAchat || !dateVente) {
                alert("Veuillez remplir tous les champs obligatoires");
                return;
              }

              // MÃªme logique de calcul que le formulaire principal
              const dureeMs = dateVente - dateAchat;
              const dureeAnnes = dureeMs / (1000 * 60 * 60 * 24 * 365.25);

              let prixRevient = prixAchat + fraisAchat + travaux;
              if (dureeAnnes > 5) {
                const abattementForfait = prixAchat * 0.15;
                if (abattementForfait > travaux) {
                  prixRevient = prixAchat + fraisAchat + abattementForfait;
                }
              }

              const plusValueBrute = prixVente - prixRevient;

              if (plusValueBrute <= 0 || typeBien === "principale") {
                alert("Ce bien n'est pas taxable ou gÃ©nÃ¨re une moins-value. Veuillez vÃ©rifier les donnÃ©es.");
                return;
              }

              // Calcul des abattements
              let abattementIR = 0;
              let abattementPS = 0;

              if (dureeAnnes >= 22) {
                abattementIR = 100;
              } else if (dureeAnnes >= 6) {
                abattementIR = (Math.floor(dureeAnnes) - 5) * 6;
              }

              if (dureeAnnes >= 30) {
                abattementPS = 100;
              } else if (dureeAnnes >= 23) {
                abattementPS = 28 + (Math.floor(dureeAnnes) - 22) * 9;
              } else if (Math.floor(dureeAnnes) === 22) {
                abattementPS = 28;
              } else if (dureeAnnes >= 6) {
                abattementPS = (Math.floor(dureeAnnes) - 5) * 1.65;
              }

              // Calcul des impÃ´ts
              const plusValueIR = Math.max(0, plusValueBrute * (1 - abattementIR / 100));
              const plusValuePS = Math.max(0, plusValueBrute * (1 - abattementPS / 100));
              const impotIR = plusValueIR * 0.19;
              const impotPS = plusValuePS * 0.172;

              let surtaxe = 0;
              if (plusValueBrute > 50000) {
                const tranche = Math.min(plusValueBrute - 50000, 350000);
                surtaxe += tranche * 0.02;
                if (plusValueBrute > 400000) {
                  const tranche2 = Math.min(plusValueBrute - 400000, 300000);
                  surtaxe += tranche2 * 0.03;
                }
                if (plusValueBrute > 700000) {
                  const tranche3 = Math.min(plusValueBrute - 700000, 200000);
                  surtaxe += tranche3 * 0.04;
                }
                if (plusValueBrute > 900000) {
                  const tranche4 = Math.min(plusValueBrute - 900000, 200000);
                  surtaxe += tranche4 * 0.05;
                }
                if (plusValueBrute > 1100000) {
                  surtaxe += (plusValueBrute - 1100000) * 0.06;
                }
              }

              const impotTotal = impotIR + impotPS + surtaxe;
              const plusValueNette = plusValueBrute - impotTotal;

              // Stocker les donnÃ©es
              const modalData = {
                prixVente,
                prixAchat,
                fraisAchat,
                travaux,
                dateAchat,
                dateVente,
                typeBien,
                dureeDetention: dureeAnnes,
                prixRevient,
                plusValueBrute,
                abattementIR,
                abattementPS,
                plusValueIR,
                plusValuePS,
                impotIR,
                impotPS,
                surtaxe,
                impotTotal,
                plusValueNette
              };

              // Ajouter Ã  la comparaison
              PlusValueComparison.addComparison(modalData);
              document.getElementById("plusvalue-comparaison").scrollIntoView({ behavior: "smooth" });

              // Fermer le modal et rÃ©initialiser
              closeModal();
            });
          }
        });
      });
    </script>
    
    <!-- Auto-initialisation des exports PDF/CSV (importe pdfExport.js automatiquement) -->
    <script type="module">
  const __lcLoadAutoExport = () => import("../utils/autoExportInit.js");
  if ("requestIdleCallback" in window) {
    window.requestIdleCallback(__lcLoadAutoExport, { timeout: 4000 });
  } else {
    window.setTimeout(__lcLoadAutoExport, 2000);
  }
</script>
  <nav class="internal-links" aria-label="Navigation interne"><ul><li><a href="/simulateurs">Tous nos simulateurs</a></li><li><a href="/">Accueil</a></li></ul></nav>
</body>
</html>




