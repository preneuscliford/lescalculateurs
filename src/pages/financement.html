<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulateur Financement Personnel 2026 - Calcul Gratuit</title>
    <meta
      name="description"
      content="üöó Calculez votre capacit√© de financement personnel 2026. D√©couvrez combien vous pouvez emprunter pour une voiture, des travaux ou un cr√©dit conso selon votre salaire. R√©sultat imm√©diat !"
    />
    <meta
      name="keywords"
      content="capacit√© financement personnel, combien emprunter voiture, salaire pour emprunter 20000 euros, capacit√© cr√©dit auto, emprunter 15000 euros, cr√©dit travaux capacit√©"
    />
    <meta name="google-adsense-account" content="ca-pub-2209781252231399" />

    <!-- SEO & Social -->
    <link
      rel="canonical"
      href="https://www.lescalculateurs.fr/pages/financement"
    />
    <meta
      property="og:url"
      content="https://www.lescalculateurs.fr/pages/financement"
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Simulateur financement personnel 2026 : Calcul cr√©dit conso gratuit"
    />
    <meta
      property="og:description"
      content="üöó Calculez votre capacit√© de financement personnel 2026. D√©couvrez combien vous pouvez emprunter pour une voiture, des travaux ou un cr√©dit conso. R√©sultat imm√©diat !"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Simulateur financement personnel 2026 : Calcul cr√©dit conso gratuit"
    />
    <meta
      name="twitter:description"
      content="üöó Calculez votre capacit√© de financement personnel 2026. D√©couvrez combien vous pouvez emprunter pour une voiture, des travaux ou un cr√©dit conso. R√©sultat imm√©diat !"
    />

    <!-- JSON-LD: BreadcrumbList -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Accueil",
            "item": "https://www.lescalculateurs.fr/index"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Capacit√© de financement personnel",
            "item": "https://www.lescalculateurs.fr/pages/financement"
          }
        ]
      }
    </script>

    <!-- FAQ Schema.org -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "Quel salaire pour emprunter 20 000 ‚Ç¨ pour une voiture ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Pour emprunter 20 000 ‚Ç¨ sur 48 mois √† 4,5%, la mensualit√© est d'environ 456 ‚Ç¨. Avec un taux d'endettement de 33%, il faut g√©n√©ralement un revenu net mensuel d'environ 1 800 ‚Ç¨ sans autres charges, ou 2 500 ‚Ç¨ avec des charges existantes de 300 ‚Ç¨/mois."
            }
          },
          {
            "@type": "Question",
            "name": "Quelle est la capacit√© de financement avec 1 500 ‚Ç¨ net par mois ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Avec 1 500 ‚Ç¨ nets mensuels et sans autre cr√©dit, votre capacit√© de financement se situe autour de 12 000 ‚Ç¨ sur 48 mois pour un cr√©dit auto (taux 4,5%)."
            }
          },
          {
            "@type": "Question",
            "name": "Quel est le taux d'endettement maximum pour un cr√©dit conso ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Pour les cr√©dits √† la consommation, les banques recommandent de ne pas d√©passer 33% d'endettement total. Certains √©tablissements peuvent monter jusqu'√† 40% pour des profils tr√®s solvables."
            }
          }
        ]
      }
    </script>

    <!-- Schema.org SoftwareApplication -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Simulateur de capacit√© de financement personnel",
        "operatingSystem": "Web",
        "applicationCategory": "FinanceApplication",
        "description": "Calculateur de capacit√© de financement pour cr√©dit √† la consommation (auto, travaux, conso).",
        "url": "https://www.lescalculateurs.fr/pages/financement",
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "EUR" }
      }
    </script>

    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../assets/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../assets/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../assets/favicon-16x16.png"
    />
    <link rel="manifest" href="../assets/site.webmanifest" />
    <link rel="shortcut icon" href="../assets/favicon.ico" />

    <script defer src="/third-party-loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      .indicateur-reste {
        height: 12px;
        border-radius: 6px;
        transition: all 0.3s ease;
      }
      .table-capacite th {
        background: #f3f4f6;
        font-weight: 600;
      }
      .table-capacite td {
        border-bottom: 1px solid #e5e7eb;
      }
      .table-capacite tr:hover td {
        background: #f9fafb;
      }
      .badge-statut {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
      }
      .badge-confortable {
        background: #d1fae5;
        color: #065f46;
      }
      .badge-serre {
        background: #fef3c7;
        color: #92400e;
      }
      .badge-fragile {
        background: #fee2e2;
        color: #991b1b;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div
      class="sticky-ymyl"
      role="alert"
      style="
        position: sticky;
        top: 0;
        z-index: 9999;
        background: #fff3cd;
        border: 1px solid #ffc107;
        padding: 12px 16px;
        text-align: center;
        font-size: 14px;
      "
    >
      <strong>‚ö†Ô∏è Estimation indicative.</strong> Montant d√©finitif sur
      <a
        href="https://www.banque-france.fr/fr/les-taux-monetaires-directeurs"
        target="_blank"
        rel="noopener"
        style="color: #856404; text-decoration: underline; font-weight: bold"
        >Banque de France</a
      >.
    </div>

    <header
      class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-14">
          <a href="/" class="flex items-center space-x-2">
            <img
              src="/assets/lescalculateurs-new-logo.png"
              alt="LesCalculateurs"
              class="h-8 w-auto"
            />
            <span class="font-bold text-gray-900 hidden sm:block"
              >Les Calculateurs</span
            >
          </a>
          <nav class="hidden md:flex items-center space-x-4 text-sm">
            <a href="/" class="text-gray-600 hover:text-blue-600">üè† Accueil</a>
            <a
              href="/pages/simulateurs.html"
              class="text-gray-600 hover:text-blue-600"
              >üéØ Outils</a
            >
            <a
              href="/pages/methodologie.html"
              class="hidden lg:block text-gray-600 hover:text-blue-600"
              >üìö M√©thodo</a
            >
          </nav>
          <button id="mobile-menu-btn" class="md:hidden text-gray-600">
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
          </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden py-2 border-t">
          <nav class="flex flex-col space-y-2 text-sm">
            <a href="/" class="text-gray-600 hover:text-blue-600 py-1"
              >üè† Accueil</a
            >
            <a
              href="/pages/simulateurs.html"
              class="text-gray-600 hover:text-blue-600 py-1"
              >üéØ Simulateurs</a
            >
          </nav>
        </div>
      </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- H1 et Introduction -->
      <div class="flex flex-col items-center mt-6 mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 text-center">
          Capacit√© de financement personnel 2026 ‚Äì Combien puis-je emprunter ?
        </h1>
        <p class="text-sm text-gray-600 mt-2 text-center max-w-2xl">
          Calculez votre <strong>capacit√© de financement</strong> pour un cr√©dit
          auto, des travaux ou tout projet personnel. D√©couvrez quel montant
          vous pouvez emprunter selon vos revenus et votre taux d'endettement.
        </p>
        <button
          id="financement-scroll-to-form"
          class="mt-6 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-xl text-lg transition-colors shadow-lg"
        >
          üü¢ Calculer ma capacit√© de financement
        </button>
      </div>

      <!-- Simulateur -->
      <div
        id="financement-form-container"
        class="bg-white rounded-lg shadow-lg p-8 mb-8"
      >
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          üßÆ Simulateur de capacit√© de financement
        </h2>

        <form id="financement-form" class="space-y-8">
          <!-- Revenus -->
          <div class="bg-blue-50 p-6 rounded-lg">
            <h3 class="text-lg font-semibold text-blue-900 mb-4">
              üíº Vos revenus mensuels nets
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Salaire net mensuel *</label
                >
                <input
                  type="number"
                  id="salaire"
                  placeholder="2000"
                  min="0"
                  max="50000"
                  step="50"
                  required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
                <span class="text-xs text-gray-500">En euros nets</span>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Autres revenus</label
                >
                <input
                  type="number"
                  id="autresRevenus"
                  placeholder="300"
                  min="0"
                  max="10000"
                  step="10"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
                <span class="text-xs text-gray-500"
                  >Allocations, freelance...</span
                >
              </div>
            </div>
          </div>

          <!-- Charges -->
          <div class="bg-red-50 p-6 rounded-lg">
            <h3 class="text-lg font-semibold text-red-900 mb-4">
              üßæ Vos charges mensuelles
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Loyer / pr√™t immobilier</label
                >
                <input
                  type="number"
                  id="loyerPret"
                  placeholder="800"
                  min="0"
                  max="5000"
                  step="10"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Autres cr√©dits en cours</label
                >
                <input
                  type="number"
                  id="autresCredits"
                  placeholder="150"
                  min="0"
                  max="2000"
                  step="10"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Assurances</label
                >
                <input
                  type="number"
                  id="assurances"
                  placeholder="120"
                  min="0"
                  max="500"
                  step="5"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Charges fixes diverses</label
                >
                <input
                  type="number"
                  id="chargesFixes"
                  placeholder="200"
                  min="0"
                  max="1000"
                  step="10"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>
            </div>
          </div>

          <!-- Param√®tres -->
          <div class="bg-green-50 p-6 rounded-lg">
            <h3 class="text-lg font-semibold text-green-900 mb-4">
              üìÖ Param√®tres du cr√©dit
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Type de projet</label
                >
                <select
                  id="typeAchat"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                >
                  <option value="voiture">üöó Voiture</option>
                  <option value="travaux">üî® Travaux</option>
                  <option value="electromenager">üì∫ √âlectrom√©nager</option>
                  <option value="mobilier">üõãÔ∏è Mobilier</option>
                  <option value="voyage">‚úàÔ∏è Voyage</option>
                  <option value="autre">üì¶ Autre</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Dur√©e de cr√©dit</label
                >
                <select
                  id="dureeCredit"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                >
                  <option value="12">12 mois</option>
                  <option value="24">24 mois</option>
                  <option value="36" selected>36 mois</option>
                  <option value="48">48 mois</option>
                  <option value="60">60 mois</option>
                  <option value="72">72 mois</option>
                  <option value="84">84 mois</option>
                </select>
              </div>
            </div>
          </div>

          <button
            type="submit"
            class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-6 rounded-lg transition-colors duration-200 text-lg"
          >
            üßÆ Calculer ma capacit√© de financement
          </button>
        </form>

        <!-- R√©sultats -->
        <div id="results" class="invisible mt-8 min-h-[220px]"></div>
      </div>

      <!-- Features avanc√©es (cach√©es jusqu'au calcul) -->
      <div id="resultats-avances-financement" class="hidden space-y-8">
        <!-- PHASE 2 : Indicateur visuel d'endettement (dynamique) -->
        <div class="bg-white rounded-lg shadow-lg p-6" id="bloc-endettement">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üìä Taux d'endettement
          </h2>
          <div class="mb-4">
            <div class="flex justify-between mb-2">
              <span class="text-sm font-medium text-gray-700"
                >Votre endettement actuel</span
              >
              <span id="taux-endettement-valeur" class="text-lg font-bold"
                >--%</span
              >
            </div>
            <div class="relative h-8 bg-gray-200 rounded-lg overflow-hidden">
              <div
                class="absolute inset-0"
                style="
                  background: linear-gradient(
                    to right,
                    #10b981 0%,
                    #10b981 60%,
                    #f59e0b 60%,
                    #f59e0b 70%,
                    #ef4444 70%,
                    #ef4444 100%
                  );
                "
              ></div>
              <div
                id="indicateur-position"
                class="absolute top-0 bottom-0 w-1 bg-black border-2 border-white rounded transition-all duration-500"
                style="left: 0%"
              ></div>
            </div>
            <!-- L√©gende dynamique (une seule zone active) -->
            <div
              id="legende-endettement"
              class="mt-2 text-sm font-semibold text-center"
            >
              <span class="text-gray-500"
                >Calculez pour voir votre position</span
              >
            </div>
          </div>
          <div id="endettement-message" class="p-4 rounded-lg bg-gray-50">
            <p class="text-sm text-gray-700">
              Calculez votre capacit√© pour voir l'√©valuation de votre
              endettement.
            </p>
          </div>
        </div>

        <!-- PHASE 2 : Bloc "Comment d√©bloquer la situation" (affich√© si cr√©dit impossible) -->
        <div
          id="bloc-debloquage"
          class="hidden bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg shadow-lg p-6 border border-orange-200"
        >
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üí° Comment d√©bloquer votre situation
          </h2>
          <p class="text-sm text-gray-700 mb-4">
            Votre endettement actuel d√©passe les limites autoris√©es. Voici les
            solutions pour obtenir un cr√©dit :
          </p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold text-gray-800 mb-2">
                üéØ R√©duire vos charges
              </h3>
              <p class="text-sm text-gray-600">
                Remboursez vos cr√©dits en cours ou ren√©gociez-les pour lib√©rer
                de la capacit√© d'endettement.
              </p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold text-gray-800 mb-2">
                ‚è±Ô∏è Allonger la dur√©e
              </h3>
              <p class="text-sm text-gray-600">
                Une dur√©e plus longue r√©duit la mensualit√©... mais attention au
                co√ªt total du cr√©dit.
              </p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold text-gray-800 mb-2">
                üí∞ Augmenter vos revenus
              </h3>
              <p class="text-sm text-gray-600">
                Revenus compl√©mentaires, prime, ou augmentation de salaire pour
                am√©liorer votre ratio.
              </p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold text-gray-800 mb-2">
                üë• Ajouter un co-emprunteur
              </h3>
              <p class="text-sm text-gray-600">
                Un conjoint ou membre de la famille peut renforcer votre dossier
                bancaire.
              </p>
            </div>
          </div>
        </div>

        <!-- PHASE 2 : Analyse bancaire avanc√©e -->
        <div
          class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg shadow-lg p-6 border border-blue-200"
        >
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üè¶ Analyse de votre profil bancaire
          </h2>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="text-left border-b-2 border-blue-200">
                  <th class="p-3">Indicateur</th>
                  <th class="p-3">Valeur estim√©e</th>
                  <th class="p-3">Interpr√©tation</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-blue-100">
                  <td class="p-3 font-medium">Taux d'endettement</td>
                  <td class="p-3 font-bold text-blue-700" id="ana-taux">--%</td>
                  <td class="p-3" id="ana-taux-interp">--</td>
                </tr>
                <tr class="border-b border-blue-100">
                  <td class="p-3 font-medium">Reste √† vivre</td>
                  <td class="p-3 font-bold text-blue-700" id="ana-reste">--</td>
                  <td class="p-3" id="ana-reste-interp">--</td>
                </tr>
                <tr class="border-b border-blue-100">
                  <td class="p-3 font-medium">Capacit√© max projet</td>
                  <td class="p-3 font-bold text-blue-700" id="ana-capacite">
                    --
                  </td>
                  <td class="p-3 text-green-700" id="ana-capacite-interp">
                    üü¢ Adapt√©e √† votre profil
                  </td>
                </tr>
                <tr>
                  <td class="p-3 font-medium">Dur√©e optimale</td>
                  <td class="p-3 font-bold text-blue-700" id="ana-duree">--</td>
                  <td class="p-3 text-blue-700" id="ana-duree-interp">
                    ‚öñÔ∏è √âquilibr√©e
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- PHASE 2 : Indicateur risque bancaire -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üìä Risque bancaire estim√©
          </h2>
          <div class="mb-4">
            <div class="flex justify-between mb-2">
              <span class="text-sm font-medium text-gray-700"
                >Score de solvabilit√©</span
              >
              <span id="risque-score" class="text-lg font-bold">--</span>
            </div>
            <div class="relative h-10 bg-gray-200 rounded-lg overflow-hidden">
              <div
                class="absolute inset-0"
                style="
                  background: linear-gradient(
                    to right,
                    #10b981 0%,
                    #10b981 40%,
                    #f59e0b 40%,
                    #f59e0b 70%,
                    #ef4444 70%,
                    #ef4444 100%
                  );
                "
              ></div>
              <div
                id="risque-position"
                class="absolute top-0 bottom-0 w-2 bg-black border-2 border-white rounded transition-all duration-500"
                style="left: 0%"
              ></div>
            </div>
            <div class="flex justify-between mt-2 text-xs">
              <span class="text-green-600 font-semibold">üü¢ Profil solide</span>
              <span class="text-yellow-600 font-semibold">üü° √Ä optimiser</span>
              <span class="text-red-600 font-semibold">üî¥ Profil fragile</span>
            </div>
          </div>
          <div id="risque-message" class="p-4 rounded-lg bg-gray-50">
            <p class="text-sm text-gray-700">
              Calculez votre capacit√© pour voir l'√©valuation de votre profil.
            </p>
          </div>
        </div>

        <!-- Indicateur reste √† vivre -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üí∞ Votre reste √† vivre apr√®s cr√©dit
          </h2>
          <div class="flex items-center gap-4 mb-4">
            <div class="flex-1">
              <div class="flex justify-between mb-2">
                <span class="text-sm text-gray-600">Reste √† vivre estim√©</span>
                <span
                  id="reste-a-vivre-valeur"
                  class="text-2xl font-bold text-purple-600"
                  >-- ‚Ç¨</span
                >
              </div>
              <div class="h-4 bg-gray-200 rounded-full overflow-hidden">
                <div
                  id="barre-reste"
                  class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 transition-all duration-500"
                  style="width: 0%"
                ></div>
              </div>
            </div>
            <div id="badge-statut" class="badge-statut badge-confortable">
              --
            </div>
          </div>
          <p id="message-reste" class="text-sm text-gray-600">
            Calculez votre capacit√© pour voir votre reste √† vivre estim√©.
          </p>
        </div>

        <!-- Tableau Quel salaire pour... -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-2">
            üöó Quel salaire pour un cr√©dit auto ? Tableau comparatif
          </h2>
          <div
            class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded-r-lg"
          >
            <p class="text-sm text-blue-800">
              <strong>Comment lire ce tableau :</strong> Pour emprunter un
              montant donn√© (colonne de gauche), sur une dur√©e sp√©cifique, avec
              un endettement maximal de 33%, vous avez besoin du revenu net
              mensuel indiqu√©. Ces estimations sont bas√©es sur un taux indicatif
              de 4,5% pour un cr√©dit auto.
            </p>
          </div>
          <p class="text-sm text-gray-600 mb-4">
            D√©couvrez le revenu mensuel n√©cessaire pour emprunter diff√©rents
            montants pour votre projet auto.
          </p>
          <div class="overflow-x-auto">
            <table class="w-full text-sm table-capacite">
              <thead>
                <tr class="text-left">
                  <th class="p-3 rounded-tl-lg">Montant cr√©dit</th>
                  <th class="p-3">36 mois</th>
                  <th class="p-3">48 mois</th>
                  <th class="p-3 rounded-tr-lg">60 mois</th>
                </tr>
              </thead>
              <tbody id="tableau-salaire-conso">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
          <div class="mt-4 p-4 bg-gray-50 rounded-lg">
            <h3 class="font-semibold text-gray-800 mb-2">üìå Exemple concret</h3>
            <p class="text-sm text-gray-600">
              Pour emprunter <strong>15 000 ‚Ç¨ sur 48 mois</strong> √† 4,5%, avec
              un endettement maximal de 33%, un revenu net mensuel d'environ
              <strong>1 036 ‚Ç¨</strong> est recommand√© sans autres charges. Avec
              300 ‚Ç¨ de charges mensuelles, ce montant passe √†
              <strong>1 600 ‚Ç¨</strong>.
            </p>
          </div>
          <p class="text-xs text-gray-500 mt-3">
            * Estimation bas√©e sur un taux de 4,5% (cr√©dit auto) et un
            endettement de 33%. Hors assurance et charges existantes.
          </p>
        </div>

        <!-- Graphique dur√©e vs mensualit√© -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-2">
            üìà Impact de la dur√©e sur la mensualit√©
          </h2>
          <p class="text-sm text-gray-600 mb-4">
            Visualisez comment la dur√©e influence votre mensualit√© pour un
            cr√©dit de 15 000 ‚Ç¨.
          </p>
          <div class="h-64 md:h-80">
            <canvas id="graphique-mensualite"></canvas>
          </div>
        </div>

        <!-- PHASE 2 : Simulation multi-dur√©e automatique -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-2">
            üìä Comparaison automatique multi-dur√©es
          </h2>
          <p class="text-sm text-gray-600 mb-4">
            Pour le m√™me projet, voici comment √©voluent vos mensualit√©s et le
            co√ªt total selon la dur√©e choisie.
          </p>
          <div class="overflow-x-auto">
            <table class="w-full text-sm table-capacite">
              <thead>
                <tr class="text-left bg-gray-100">
                  <th class="p-3 rounded-tl-lg">Dur√©e</th>
                  <th class="p-3">Mensualit√© estim√©e</th>
                  <th class="p-3">Co√ªt total du cr√©dit</th>
                  <th class="p-3">Int√©r√™ts totaux</th>
                  <th class="p-3 rounded-tr-lg">Capacit√© max</th>
                </tr>
              </thead>
              <tbody id="tableau-multi-duree">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- PHASE 2 : Simulation apport -->
        <div
          class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg shadow-lg p-6 border border-green-200"
        >
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üí∞ Et si vous augmentiez votre apport ?
          </h2>
          <p class="text-sm text-gray-600 mb-4">
            D√©couvrez l'impact d'un apport suppl√©mentaire sur votre mensualit√©
            et votre co√ªt total. M√™me un petit apport peut faire une grande
            diff√©rence.
          </p>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <button
              onclick="simulerApportConso(0)"
              class="p-4 bg-white rounded-lg shadow border-2 border-transparent hover:border-green-500 transition-all text-center"
              id="btn-apport-0"
            >
              <p class="text-sm text-gray-600">Sans apport</p>
              <p class="text-lg font-bold text-gray-900 mt-1">0 ‚Ç¨</p>
            </button>
            <button
              onclick="simulerApportConso(1000)"
              class="p-4 bg-white rounded-lg shadow border-2 border-transparent hover:border-green-500 transition-all text-center"
              id="btn-apport-1k"
            >
              <p class="text-sm text-gray-600">Apport de</p>
              <p class="text-lg font-bold text-green-700 mt-1">1 000 ‚Ç¨</p>
            </button>
            <button
              onclick="simulerApportConso(2000)"
              class="p-4 bg-white rounded-lg shadow border-2 border-transparent hover:border-green-500 transition-all text-center"
              id="btn-apport-2k"
            >
              <p class="text-sm text-gray-600">Apport de</p>
              <p class="text-lg font-bold text-green-700 mt-1">2 000 ‚Ç¨</p>
            </button>
          </div>
          <div
            id="resultat-apport-conso"
            class="hidden p-4 bg-white rounded-lg"
          >
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
              <div>
                <p class="text-sm text-gray-600">Mensualit√© r√©duite de</p>
                <p
                  class="text-xl font-bold text-green-700"
                  id="apport-economie-mensualite"
                >
                  --
                </p>
              </div>
              <div>
                <p class="text-sm text-gray-600">√âconomie totale</p>
                <p
                  class="text-xl font-bold text-green-700"
                  id="apport-economie-totale"
                >
                  --
                </p>
              </div>
              <div>
                <p class="text-sm text-gray-600">Nouvelle capacit√©</p>
                <p
                  class="text-xl font-bold text-blue-700"
                  id="apport-nouvelle-capacite"
                >
                  --
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Boutons comparaison -->
      <div class="mt-6 flex justify-center gap-3">
        <button
          id="financement-add-to-compare"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold shadow-md transition-colors"
        >
          ‚ûï Comparer mes sc√©narios
        </button>
        <button
          id="financement-reset-compare"
          class="px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 font-semibold shadow-md transition-colors hidden"
        >
          üîÑ R√©initialiser
        </button>
      </div>
      <div id="financement-comparaison" class="hidden mt-8"></div>

      <!-- Blocs longue tra√Æne -->
      <section class="mt-16 space-y-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-8">
          üìä Guide capacit√© de financement personnel
        </h2>

        <div class="bg-white rounded-lg shadow-lg p-8">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üöó Quel salaire pour emprunter 20 000 ‚Ç¨ pour une voiture ?
          </h2>
          <p class="text-gray-600 mb-4">
            Pour emprunter <strong>20 000 ‚Ç¨ sur 48 mois</strong> √† 4,5%, la
            mensualit√© est d'environ <strong>456 ‚Ç¨</strong>.
          </p>
          <div class="bg-gray-50 rounded-lg p-4">
            <ul class="text-gray-700 space-y-2 text-sm">
              <li>
                ‚Ä¢ <strong>Sans charges :</strong> Revenu net d'environ
                <strong>1 800 ‚Ç¨</strong>
              </li>
              <li>
                ‚Ä¢ <strong>Avec charges 300 ‚Ç¨/mois :</strong> Revenu net
                d'environ <strong>2 500 ‚Ç¨</strong>
              </li>
              <li>
                ‚Ä¢ <strong>Sur 60 mois :</strong> Mensualit√© ~375 ‚Ç¨ ‚Üí Revenu ~1
                500 ‚Ç¨ sans charges
              </li>
            </ul>
          </div>
        </div>

        <!-- H2 d√©di√©s par montant pour SEO longue tra√Æne -->
        <div class="mt-12 space-y-8">
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-3">
              üí∂ Quel salaire pour emprunter 10 000 ‚Ç¨ ?
            </h2>
            <p class="text-gray-600 mb-4">
              Pour un cr√©dit de <strong>10 000 ‚Ç¨</strong>, la mensualit√© varie
              selon la dur√©e. √Ä 4,5% sur 36 mois, comptez environ
              <strong>297 ‚Ç¨/mois</strong>. Avec un endettement maximal de 33%,
              il vous faut un revenu net mensuel d'environ
              <strong>1 200 ‚Ç¨</strong> sans autres charges, ou
              <strong>1 800 ‚Ç¨</strong> avec 200 ‚Ç¨ de charges existantes.
            </p>
            <div class="bg-purple-50 rounded-lg p-4">
              <p class="text-sm text-gray-700">
                <strong>Capacit√© indicative :</strong> Avec 1 500 ‚Ç¨/mois ‚Üí ~9
                500 ‚Ç¨ sur 36 mois | ~12 000 ‚Ç¨ sur 48 mois | ~15 000 ‚Ç¨ sur 60
                mois
              </p>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-3">
              üí∂ Quel salaire pour emprunter 15 000 ‚Ç¨ ?
            </h2>
            <p class="text-gray-600 mb-4">
              Pour emprunter <strong>15 000 ‚Ç¨ sur 48 mois</strong> √† 4,5%, la
              mensualit√© est d'environ <strong>342 ‚Ç¨</strong>. Le revenu net
              mensuel recommand√© est d'environ <strong>1 500 ‚Ç¨</strong> sans
              charges, ou <strong>2 100 ‚Ç¨</strong> avec 300 ‚Ç¨ de charges
              mensuelles. C'est le montant id√©al pour l'achat d'une voiture
              d'occasion ou des travaux de r√©novation.
            </p>
            <div class="bg-blue-50 rounded-lg p-4">
              <p class="text-sm text-gray-700">
                <strong>Conseil :</strong> Sur 60 mois, la mensualit√© descend √†
                ~277 ‚Ç¨, ce qui r√©duit le salaire n√©cessaire √† environ 1 200 ‚Ç¨
                (sans charges).
              </p>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-3">
              üí∂ Quel salaire pour emprunter 20 000 ‚Ç¨ ?
            </h2>
            <p class="text-gray-600 mb-4">
              Pour un cr√©dit auto de <strong>20 000 ‚Ç¨ sur 48 mois</strong> √†
              4,5%, pr√©voyez une mensualit√© d'environ <strong>456 ‚Ç¨</strong>. Le
              revenu net mensuel n√©cessaire est d'environ
              <strong>1 800 ‚Ç¨</strong> sans charges existantes, ou
              <strong>2 500 ‚Ç¨</strong> avec 300 ‚Ç¨ de charges. Ce montant
              correspond g√©n√©ralement √† l'achat d'une voiture neuve ou d'un
              v√©hicule √©lectrique.
            </p>
            <div class="bg-green-50 rounded-lg p-4">
              <p class="text-sm text-gray-700">
                <strong>Optimisation :</strong> En passant sur 60 mois, la
                mensualit√© baisse √† ~370 ‚Ç¨, r√©duisant le salaire n√©cessaire √† ~1
                500 ‚Ç¨ (sans charges).
              </p>
            </div>
          </div>
        </div>

        <!-- Bloc diff√©renciation : Cr√©dit auto vs travaux -->
        <div
          class="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-lg shadow-lg p-6 border border-indigo-200 mt-8"
        >
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üîé Cr√©dit auto vs travaux : quelles diff√©rences ?
          </h2>
          <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3
                class="font-semibold text-indigo-800 mb-2 flex items-center gap-2"
              >
                <span>üöó</span> Cr√©dit auto
              </h3>
              <ul class="text-sm text-gray-700 space-y-1">
                <li>‚Ä¢ Taux g√©n√©ralement plus bas (4-5%)</li>
                <li>‚Ä¢ Dur√©e : 12 √† 72 mois</li>
                <li>‚Ä¢ Le v√©hicule peut servir de garantie</li>
                <li>‚Ä¢ Acceptation plus facile (s√©curis√©)</li>
              </ul>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3
                class="font-semibold text-indigo-800 mb-2 flex items-center gap-2"
              >
                <span>üî®</span> Cr√©dit travaux
              </h3>
              <ul class="text-sm text-gray-700 space-y-1">
                <li>‚Ä¢ Taux l√©g√®rement plus √©lev√© (5-6%)</li>
                <li>‚Ä¢ Dur√©e : 12 √† 84 mois</li>
                <li>‚Ä¢ Sans garantie mat√©rielle</li>
                <li>‚Ä¢ Analyse du dossier plus stricte</li>
              </ul>
            </div>
          </div>
          <div class="mt-4 bg-white rounded-lg p-4">
            <h3 class="font-semibold text-gray-800 mb-2">
              üß† Pourquoi les banques sont plus strictes en cr√©dit conso ?
            </h3>
            <p class="text-sm text-gray-700">
              Contrairement au cr√©dit immobilier, le cr√©dit √† la consommation ne
              cr√©√© pas de patrimoine. C'est un cr√©dit "√† d√©pense" qui r√©duit
              votre reste √† vivre sans apporter de valeur future. Les banques
              appliquent donc un
              <strong>plafond d'endettement plus strict (33% vs 35%)</strong> et
              analysent davantage votre stabilit√© professionnelle et votre
              historique bancaire.
            </p>
          </div>
        </div>

        <!-- Tableau comparatif visuel -->
        <div class="grid md:grid-cols-3 gap-6 mt-8">
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-3">
              üíµ Avec 1 500 ‚Ç¨/mois
            </h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between p-2 bg-purple-50 rounded">
                <span>36 mois</span><span class="font-bold">~9 500 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-purple-50 rounded">
                <span>48 mois</span><span class="font-bold">~12 000 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-purple-50 rounded">
                <span>60 mois</span><span class="font-bold">~15 000 ‚Ç¨</span>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-3">
              üíµ Avec 2 000 ‚Ç¨/mois
            </h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between p-2 bg-green-50 rounded">
                <span>36 mois</span><span class="font-bold">~13 000 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-green-50 rounded">
                <span>48 mois</span><span class="font-bold">~17 000 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-green-50 rounded">
                <span>60 mois</span><span class="font-bold">~20 000 ‚Ç¨</span>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-3">
              üíµ Avec 2 500 ‚Ç¨/mois
            </h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between p-2 bg-blue-50 rounded">
                <span>36 mois</span><span class="font-bold">~17 000 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-blue-50 rounded">
                <span>48 mois</span><span class="font-bold">~21 000 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-blue-50 rounded">
                <span>60 mois</span><span class="font-bold">~26 000 ‚Ç¨</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- FAQ -->
      <section class="mt-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          ‚ùì Questions fr√©quentes
        </h2>
        <div class="space-y-4">
          <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">
              Quel salaire pour emprunter 20 000 ‚Ç¨ pour une voiture ?
            </h3>
            <p class="text-gray-600">
              Pour emprunter 20 000 ‚Ç¨ sur 48 mois √† 4,5%, il faut g√©n√©ralement
              un <strong>revenu net mensuel d'environ 1 800 ‚Ç¨</strong> sans
              autres charges.
            </p>
          </div>
          <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">
              Quelle est la capacit√© avec 1 500 ‚Ç¨ net par mois ?
            </h3>
            <p class="text-gray-600">
              Avec 1 500 ‚Ç¨ nets mensuels et sans autre cr√©dit, votre capacit√© se
              situe autour de <strong>12 000 ‚Ç¨ sur 48 mois</strong> pour un
              cr√©dit auto.
            </p>
          </div>
        </div>
      </section>

      <!-- Maillage interne -->
      <section class="mt-16">
        <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-3">üîó Voir aussi</h3>
          <div class="flex flex-wrap gap-3">
            <a
              href="/pages/pret.html"
              class="inline-block bg-green-50 border border-green-200 rounded px-3 py-2 text-sm text-green-700 hover:bg-green-100"
              >üè† Capacit√© immobilier</a
            >
            <a
              href="/pages/salaire.html"
              class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
              >üíº Calculateur salaire</a
            >
          </div>
        </div>
      </section>
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-16">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <p class="text-gray-300">
          ¬© 2026 Les Calculateurs - Capacit√© financement personnel
        </p>
      </div>
    </footer>

    <script type="module" src="../main.ts"></script>
    <script type="module">
      // Scroll to form
      document
        .getElementById("financement-scroll-to-form")
        ?.addEventListener("click", () => {
          document
            .getElementById("financement-form")
            .scrollIntoView({ behavior: "smooth" });
        });

      let chartInstance = null;

      // Taux par type
      const TAUX_PAR_TYPE = {
        voiture: 4.5,
        travaux: 5.0,
        electromenager: 6.0,
        mobilier: 5.5,
        voyage: 6.5,
        autre: 6.0,
      };

      function formatCurrency(amount) {
        return new Intl.NumberFormat("fr-FR", {
          style: "currency",
          currency: "EUR",
        }).format(amount);
      }

      // Calcul du formulaire
      document
        .getElementById("financement-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const salaire =
            parseFloat(document.getElementById("salaire").value) || 0;
          const autresRevenus =
            parseFloat(document.getElementById("autresRevenus").value) || 0;
          const loyerPret =
            parseFloat(document.getElementById("loyerPret").value) || 0;
          const autresCredits =
            parseFloat(document.getElementById("autresCredits").value) || 0;
          const assurances =
            parseFloat(document.getElementById("assurances").value) || 0;
          const chargesFixes =
            parseFloat(document.getElementById("chargesFixes").value) || 0;
          const typeAchat = document.getElementById("typeAchat").value;
          const dureeCredit = parseInt(
            document.getElementById("dureeCredit").value,
          );

          if (!salaire) {
            alert("Veuillez saisir votre salaire net mensuel");
            return;
          }

          const revenuTotal = salaire + autresRevenus;
          const chargesActuelles =
            loyerPret + autresCredits + assurances + chargesFixes;
          const taux = TAUX_PAR_TYPE[typeAchat] || 6.0;
          const tauxMensuel = taux / 100 / 12;

          // Calcul capacit√© (33% endettement)
          const tauxEndettementMax = 33;
          const mensualiteMax = Math.max(
            0,
            (revenuTotal * tauxEndettementMax) / 100 - chargesActuelles,
          );

          let capaciteEmprunt = 0;
          if (tauxMensuel > 0) {
            capaciteEmprunt =
              (mensualiteMax * (1 - Math.pow(1 + tauxMensuel, -dureeCredit))) /
              tauxMensuel;
          } else {
            capaciteEmprunt = mensualiteMax * dureeCredit;
          }

          const resteAVivre = revenuTotal - chargesActuelles - mensualiteMax;
          // Calcul des ratios pour analyse
          const ratioEndettementActuel = (chargesActuelles / revenuTotal) * 100;
          const ratioEndettementAvecCredit =
            ((mensualiteMax + chargesActuelles) / revenuTotal) * 100;
          const ratioEndettement = ratioEndettementAvecCredit; // Pour compatibilite

          // Detecter si les charges existantes bloquent le credit
          const chargesTropElevees = chargesActuelles >= revenuTotal * 0.33;

          // Afficher r√©sultats
          document
            .getElementById("resultats-avances-financement")
            .classList.remove("hidden");

          // Indicateur reste √† vivre
          document.getElementById("reste-a-vivre-valeur").textContent =
            formatCurrency(resteAVivre);

          // Barre de progression (0 √† 1500‚Ç¨ = 0-100%)
          const pourcentageBarre = Math.min(
            Math.max((resteAVivre / 1500) * 100, 0),
            100,
          );
          document.getElementById("barre-reste").style.width =
            pourcentageBarre + "%";

          // Badge statut
          const badge = document.getElementById("badge-statut");
          const message = document.getElementById("message-reste");

          if (chargesTropElevees) {
            badge.className = "badge-statut badge-fragile";
            badge.textContent = "üî¥ Endettement excessif";
            message.textContent =
              "Vos charges actuelles d√©passent la limite autoris√©e (33%). Voir les solutions ci-dessus.";
          } else if (resteAVivre > 800) {
            badge.className = "badge-statut badge-confortable";
            badge.textContent = "üü¢ Confortable";
            message.textContent =
              "Votre reste √† vivre est confortable. Vous pouvez envisager ce cr√©dit sereinement.";
          } else if (resteAVivre > 400) {
            badge.className = "badge-statut badge-serre";
            badge.textContent = "üü° Serr√©";
            message.textContent =
              "Votre reste √† vivre sera serr√©. Envisagez une dur√©e plus longue ou un apport.";
          } else {
            badge.className = "badge-statut badge-fragile";
            badge.textContent = "üî¥ Fragile";
            message.textContent =
              "Attention : votre reste √† vivre sera tr√®s faible. Le cr√©dit pourrait √™tre refus√©.";
          }

          // G√©n√©rer tableau
          genererTableau(tauxMensuel);

          // G√©n√©rer graphique
          genererGraphique(tauxMensuel);

          // PHASE 2 : Analyse bancaire avanc√©e
          genererAnalyseBancaire(
            revenuTotal,
            chargesActuelles,
            capaciteEmprunt,
            mensualiteMax,
            resteAVivre,
            ratioEndettement,
            dureeCredit,
            taux,
            chargesTropElevees,
          );

          // PHASE 2 : Tableau multi-dur√©e d√©taill√© (cach√© si cr√©dit impossible)
          const sectionMultiDuree = document
            .getElementById("tableau-multi-duree")
            ?.closest(".bg-white.rounded-lg.shadow-lg.p-6");
          if (sectionMultiDuree) {
            if (chargesTropElevees) {
              sectionMultiDuree.style.display = "none";
            } else {
              sectionMultiDuree.style.display = "block";
              genererTableauMultiDuree(
                tauxMensuel,
                capaciteEmprunt,
                mensualiteMax,
              );
            }
          }

          // PHASE 2 : Indicateur risque bancaire
          genererIndicateurRisque(
            ratioEndettement,
            resteAVivre,
            chargesTropElevees,
          );

          // PHASE 2 : Configuration simulation apport (cach√©e si cr√©dit impossible)
          const sectionApport = document
            .getElementById("btn-apport-0")
            ?.closest(".bg-gradient-to-br");
          if (sectionApport) {
            sectionApport.style.display = chargesTropElevees ? "none" : "block";
          }
          if (!chargesTropElevees) {
            configurerSimulationApport(
              capaciteEmprunt,
              mensualiteMax,
              tauxMensuel,
              dureeCredit,
              typeAchat,
            );
          }

          // R√©sultat principal
          document.getElementById("results").innerHTML = `
          <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 border border-purple-200">
            <h3 class="text-xl font-bold text-purple-900 mb-4">üéØ Votre capacit√© de financement</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-white rounded-lg p-4 text-center shadow-sm">
                <p class="text-sm text-gray-600 mb-1">Capacit√© maximale (${typeAchat})</p>
                <p class="text-3xl font-bold text-purple-700">${formatCurrency(capaciteEmprunt)}</p>
                <p class="text-xs text-gray-500 mt-1">sur ${dureeCredit} mois √† ${taux}%</p>
              </div>
              <div class="bg-white rounded-lg p-4 text-center shadow-sm">
                <p class="text-sm text-gray-600 mb-1">Mensualit√© maximale</p>
                <p class="text-2xl font-bold text-blue-700">${formatCurrency(mensualiteMax)}</p>
                <p class="text-xs text-gray-500 mt-1">endettement ${tauxEndettementMax}%</p>
              </div>
            </div>
            <div class="mt-4 bg-white rounded p-3 text-sm text-gray-600">
              Revenus : ${formatCurrency(revenuTotal)} ‚Ä¢ Charges : ${formatCurrency(chargesActuelles)} ‚Ä¢ Reste √† vivre : ${formatCurrency(resteAVivre)}
            </div>
          </div>
        `;
          document.getElementById("results").classList.remove("invisible");
        });

      function genererTableau(tauxMensuel) {
        const montants = [10000, 15000, 20000];
        const durees = [36, 48, 60];
        const tbody = document.getElementById("tableau-salaire-conso");

        let html = "";
        montants.forEach((montant) => {
          html += "<tr>";
          html += `<td class="p-3 font-medium">${formatCurrency(montant)}</td>`;

          durees.forEach((duree) => {
            const mensualite =
              montant * (tauxMensuel / (1 - Math.pow(1 + tauxMensuel, -duree)));
            const salaireNecessaire = mensualite / 0.33;
            html += `<td class="p-3">~${formatCurrency(salaireNecessaire)}</td>`;
          });

          html += "</tr>";
        });

        tbody.innerHTML = html;
      }

      function genererGraphique(tauxMensuel) {
        const canvas = document.getElementById("graphique-mensualite");
        if (!canvas || typeof Chart === "undefined") {
          console.warn("Chart.js non disponible");
          return;
        }
        const ctx = canvas.getContext("2d");
        const montant = 15000;
        const durees = [24, 36, 48, 60, 72];
        const mensualites = durees.map((duree) => {
          return (
            montant * (tauxMensuel / (1 - Math.pow(1 + tauxMensuel, -duree)))
          );
        });

        if (chartInstance) {
          chartInstance.destroy();
        }

        chartInstance = new Chart(ctx, {
          type: "line",
          data: {
            labels: durees.map((d) => d + " mois"),
            datasets: [
              {
                label: "Mensualit√© estim√©e",
                data: mensualites,
                borderColor: "#7c3aed",
                backgroundColor: "rgba(124, 58, 237, 0.1)",
                fill: true,
                tension: 0.4,
                pointRadius: 5,
                pointBackgroundColor: "#7c3aed",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return formatCurrency(context.raw);
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value + " ‚Ç¨";
                  },
                },
              },
            },
          },
        });
      }

      // PHASE 2 : Analyse bancaire avanc√©e
      function genererAnalyseBancaire(
        revenuTotal,
        chargesActuelles,
        capaciteEmprunt,
        mensualiteMax,
        resteAVivre,
        ratioEndettement,
        dureeCredit,
        taux,
        chargesTropElevees,
      ) {
        const resteParPersonne = resteAVivre / 1.5; // Approximation 1.5 personne par foyer

        // Interpr√©tation taux endettement
        let interpEndettement, couleurEndettement;
        if (chargesTropElevees) {
          interpEndettement = "üî¥ Charges excessives";
          couleurEndettement = "text-red-600";
        } else if (ratioEndettement < 25) {
          interpEndettement = "üü¢ Excellent";
          couleurEndettement = "text-green-600";
        } else if (ratioEndettement < 30) {
          interpEndettement = "üü¢ Correct";
          couleurEndettement = "text-green-600";
        } else if (ratioEndettement <= 33) {
          interpEndettement = "üü° Zone limite";
          couleurEndettement = "text-yellow-600";
        } else {
          interpEndettement = "üî¥ Trop √©lev√©";
          couleurEndettement = "text-red-600";
        }

        // Interpr√©tation reste √† vivre
        let interpReste;
        if (resteAVivre >= 800) interpReste = "üü¢ Confortable";
        else if (resteAVivre >= 500) interpReste = "üü° Serr√©";
        else interpReste = "üî¥ Fragile";

        // Interpr√©tation capacit√©
        let interpCapacite;
        if (capaciteEmprunt > 20000) interpCapacite = "üü¢ Tr√®s bonne";
        else if (capaciteEmprunt > 10000) interpCapacite = "üü¢ Correcte";
        else if (capaciteEmprunt > 5000) interpCapacite = "üü° Limit√©e";
        else interpCapacite = "üî¥ Faible";

        // Interpr√©tation dur√©e
        let interpDuree;
        if (dureeCredit <= 36) interpDuree = "‚ö° Rapide (mensualit√©s √©lev√©es)";
        else if (dureeCredit <= 60) interpDuree = "‚öñÔ∏è √âquilibr√©e";
        else interpDuree = "üê¢ Allong√©e (co√ªt plus √©lev√©)";

        // Mise √† jour du DOM
        document.getElementById("taux-endettement-valeur").textContent =
          ratioEndettement.toFixed(1) + "%";
        document.getElementById("indicateur-position").style.left =
          Math.min(Math.max(ratioEndettement * 2, 0), 100) + "%";

        let messageEndettement = "";
        let couleurMessage = "";
        if (chargesTropElevees) {
          messageEndettement =
            "üî¥ <strong>Charges excessives</strong> : Vos charges actuelles (" +
            formatCurrency(chargesActuelles) +
            ") d√©passent d√©j√† 33% de vos revenus. Impossible d'obtenir un nouveau cr√©dit sans r√©duire vos charges ou augmenter vos revenus.";
          couleurMessage = "bg-red-50 border-red-200";
        } else if (ratioEndettement < 30) {
          messageEndettement =
            "üü¢ <strong>Endettement confortable</strong> : Votre situation est saine pour ce type de cr√©dit.";
          couleurMessage = "bg-green-50 border-green-200";
        } else if (ratioEndettement < 33) {
          messageEndettement =
            "üü° <strong>Endettement dans la limite</strong> : Vous √™tes dans les normes, mais surveillez votre budget.";
          couleurMessage = "bg-yellow-50 border-yellow-200";
        } else {
          messageEndettement =
            "üî¥ <strong>Endettement √©lev√©</strong> : Votre dossier pourrait √™tre refus√© ou n√©cessiter une dur√©e plus longue.";
          couleurMessage = "bg-red-50 border-red-200";
        }
        document.getElementById("endettement-message").className =
          "p-4 rounded-lg border " + couleurMessage;
        document.getElementById("endettement-message").innerHTML =
          '<p class="text-sm">' + messageEndettement + "</p>";

        // Mise √† jour de la l√©gende dynamique (une seule zone active)
        const legendeEl = document.getElementById("legende-endettement");
        if (chargesTropElevees || ratioEndettement > 33) {
          legendeEl.innerHTML =
            '<span class="text-red-600 font-semibold">üî¥ Zone critique (&gt;33%)</span>';
        } else if (ratioEndettement > 30) {
          legendeEl.innerHTML =
            '<span class="text-yellow-600 font-semibold">üü° Zone limite (30-33%)</span>';
        } else {
          legendeEl.innerHTML =
            '<span class="text-green-600 font-semibold">üü¢ Zone s√©curis√©e (&lt;30%)</span>';
        }

        // Afficher/masquer le bloc de d√©blocage
        const blocDebloquage = document.getElementById("bloc-debloquage");
        if (blocDebloquage) {
          blocDebloquage.style.display = chargesTropElevees ? "block" : "none";
        }

        document.getElementById("ana-taux").textContent =
          ratioEndettement.toFixed(1) + "%";
        document.getElementById("ana-taux-interp").innerHTML =
          '<span class="' +
          couleurEndettement +
          '">' +
          interpEndettement +
          "</span>";
        document.getElementById("ana-reste").textContent =
          formatCurrency(resteAVivre);
        document.getElementById("ana-reste-interp").textContent =
          interpReste + " (" + formatCurrency(resteParPersonne) + "/pers)";
        document.getElementById("ana-capacite").textContent =
          formatCurrency(capaciteEmprunt);
        document.getElementById("ana-capacite-interp").textContent =
          interpCapacite;
        document.getElementById("ana-duree").textContent =
          dureeCredit + " mois";
        document.getElementById("ana-duree-interp").textContent = interpDuree;
      }

      // PHASE 2 : Tableau multi-dur√©e d√©taill√©
      function genererTableauMultiDuree(
        tauxMensuel,
        capaciteBase,
        mensualiteBase,
      ) {
        const durees = [36, 48, 60];
        const tbody = document.getElementById("tableau-multi-duree");

        let html = "";
        durees.forEach((duree) => {
          // Calcul pour cette dur√©e avec la m√™me mensualit√© max
          let capacite = 0;
          if (tauxMensuel > 0) {
            capacite =
              (mensualiteBase * (1 - Math.pow(1 + tauxMensuel, -duree))) /
              tauxMensuel;
          } else {
            capacite = mensualiteBase * duree;
          }

          const mensualite =
            capacite * (tauxMensuel / (1 - Math.pow(1 + tauxMensuel, -duree)));
          const coutTotal = mensualite * duree;
          const interets = coutTotal - capacite;

          html += '<tr class="hover:bg-gray-50">';
          html += '<td class="p-3 font-medium">' + duree + " mois</td>";
          html +=
            '<td class="p-3 font-bold text-purple-700">' +
            formatCurrency(mensualite) +
            "</td>";
          html +=
            '<td class="p-3 text-orange-600">' +
            formatCurrency(coutTotal) +
            "</td>";
          html +=
            '<td class="p-3 text-red-500">' +
            formatCurrency(interets) +
            "</td>";
          html +=
            '<td class="p-3 text-green-700 font-medium">' +
            formatCurrency(capacite) +
            "</td>";
          html += "</tr>";
        });

        tbody.innerHTML = html;
      }

      // PHASE 2 : Indicateur risque bancaire
      function genererIndicateurRisque(
        ratioEndettement,
        resteAVivre,
        chargesTropElevees,
      ) {
        // Score de solvabilit√© (0-100, 100 = excellent)
        let score = 50;

        if (chargesTropElevees) {
          score = 20; // Score tr√®s bas si charges d√©j√† excessives
        } else {
          if (ratioEndettement < 25) score += 25;
          else if (ratioEndettement > 33) score -= 25;
          else if (ratioEndettement > 30) score -= 10;

          if (resteAVivre > 800) score += 20;
          else if (resteAVivre < 400) score -= 20;
          else if (resteAVivre < 600) score -= 10;
        }

        score = Math.max(0, Math.min(100, score));

        document.getElementById("risque-score").textContent = score + "/100";
        document.getElementById("risque-position").style.left = score + "%";

        let message, couleurClass;
        if (chargesTropElevees) {
          message =
            "Vos charges actuelles d√©passent le plafond d'endettement autoris√©. Reportez-vous aux solutions ci-dessus pour d√©bloquer votre situation.";
          couleurClass = "bg-red-50 text-red-800";
        } else if (score >= 70) {
          message =
            "<strong>Profil solide</strong> : Votre dossier devrait √™tre bien re√ßu. Vous avez une bonne marge de man≈ìuvre.";
          couleurClass = "bg-green-50 text-green-800";
        } else if (score >= 50) {
          message =
            "<strong>Profil √† optimiser</strong> : Votre dossier est recevable mais pourrait √™tre am√©lior√© avec un apport.";
          couleurClass = "bg-yellow-50 text-yellow-800";
        } else {
          message =
            "<strong>Profil fragile</strong> : Votre dossier pourrait √™tre difficile √† financer. Envisagez d'augmenter votre apport ou de r√©duire le montant.";
          couleurClass = "bg-red-50 text-red-800";
        }

        // Si cr√©dit impossible, on masque la barre de score et on garde juste le message
        const scoreContainer =
          document.getElementById("risque-score")?.parentElement?.parentElement;
        if (scoreContainer && chargesTropElevees) {
          // On garde le titre mais on masque la barre de progression
          scoreContainer
            .querySelector(".relative.h-10")
            ?.classList.add("hidden");
          scoreContainer
            .querySelector(".flex.justify-between.mt-2")
            ?.classList.add("hidden");
          document.getElementById("risque-score").textContent = "";
        } else if (scoreContainer) {
          scoreContainer
            .querySelector(".relative.h-10")
            ?.classList.remove("hidden");
          scoreContainer
            .querySelector(".flex.justify-between.mt-2")
            ?.classList.remove("hidden");
        }

        document.getElementById("risque-message").className =
          "p-4 rounded-lg " + couleurClass;
        document.getElementById("risque-message").innerHTML =
          '<p class="text-sm">' + message + "</p>";
      }

      // PHASE 2 : Configuration simulation apport
      let simulationDataConso = null;

      function configurerSimulationApport(
        capacite,
        mensualite,
        tauxMensuel,
        duree,
        type,
      ) {
        simulationDataConso = {
          capaciteBase: capacite,
          mensualiteBase: mensualite,
          tauxMensuel: tauxMensuel,
          duree: duree,
          type: type,
        };
      }

      // PHASE 2 : Simulation apport (expos√©e globalement)
      window.simulerApportConso = function (montantApport) {
        if (!simulationDataConso) return;

        const data = simulationDataConso;

        // Reset boutons
        document
          .getElementById("btn-apport-0")
          .classList.remove("ring-2", "ring-green-500");
        document
          .getElementById("btn-apport-1k")
          .classList.remove("ring-2", "ring-green-500");
        document
          .getElementById("btn-apport-2k")
          .classList.remove("ring-2", "ring-green-500");

        // Activer le bon bouton
        const btnId =
          montantApport === 0
            ? "btn-apport-0"
            : montantApport === 1000
              ? "btn-apport-1k"
              : "btn-apport-2k";
        document
          .getElementById(btnId)
          .classList.add("ring-2", "ring-green-500");

        // Afficher r√©sultat
        document
          .getElementById("resultat-apport-conso")
          .classList.remove("hidden");

        if (montantApport === 0) {
          document.getElementById("apport-economie-mensualite").textContent =
            "0 ‚Ç¨";
          document.getElementById("apport-economie-totale").textContent = "0 ‚Ç¨";
          document.getElementById("apport-nouvelle-capacite").textContent =
            formatCurrency(data.capaciteBase);
          return;
        }

        // Calcul √©conomie
        // R√©duction de la mensualit√© si on emprunte le m√™me montant moins l'apport
        const nouveauMontant = Math.max(0, data.capaciteBase - montantApport);
        let nouvelleMensualite = 0;
        if (data.tauxMensuel > 0) {
          nouvelleMensualite =
            nouveauMontant *
            (data.tauxMensuel /
              (1 - Math.pow(1 + data.tauxMensuel, -data.duree)));
        } else {
          nouvelleMensualite = nouveauMontant / data.duree;
        }

        const economieMensualite = data.mensualiteBase - nouvelleMensualite;
        const economieTotale = economieMensualite * data.duree;
        const nouvelleCapacite = data.capaciteBase; // La capacit√© reste la m√™me, c'est le projet qui change

        document.getElementById("apport-economie-mensualite").textContent =
          "-" + formatCurrency(economieMensualite) + "/mois";
        document.getElementById("apport-economie-totale").textContent =
          formatCurrency(economieTotale);
        document.getElementById("apport-nouvelle-capacite").textContent =
          formatCurrency(nouvelleCapacite) + " (apport inclus)";
      };

      // Mobile menu
      document
        .getElementById("mobile-menu-btn")
        ?.addEventListener("click", function () {
          document.getElementById("mobile-menu")?.classList.toggle("hidden");
        });
    </script>
  </body>
</html>
