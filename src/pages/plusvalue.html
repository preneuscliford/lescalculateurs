<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-adsense-account" content="ca-pub-2209781252231399">

    <!-- SEO & Social -->
    <title>
      💸 Plus-value Immobilière 2026 — Impôt, abattements, exonérations
    </title>
    <meta
      name="description"
      content="Calculez automatiquement l’impôt sur la plus-value immobilière 2026. Abattements, graphiques, comparaison et export PDF/PNG — gratuit et immédiat."
    />
    <meta
      name="keywords"
      content="plus-value immobilière 2026, calcul impôt plus-value, abattement durée détention, exonération plus-value, taux impôt immobilier, vente maison appartement, calculateur plus-value gratuit, barèmes fiscaux, CGI, résidence principale"
    />

    <!-- SEO & Social -->
    <link rel="canonical" href="https://www.lescalculateurs.fr/pages/plusvalue" />
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {"@type": "ListItem", "position": 1, "name": "Accueil", "item": "https://www.lescalculateurs.fr/index"},
        {"@type": "ListItem", "position": 2, "name": "Plus-value immobilière", "item": "https://www.lescalculateurs.fr/pages/plusvalue"}
      ]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Plus‑value immobilière",
      "url": "https://www.lescalculateurs.fr/pages/plusvalue",
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {"@type": "ListItem", "position": 1, "name": "Accueil", "item": "https://www.lescalculateurs.fr/index"},
          {"@type": "ListItem", "position": 2, "name": "Plus‑value immobilière", "item": "https://www.lescalculateurs.fr/pages/plusvalue"}
        ]
      }
    }
    </script>
    <meta property="og:url" content="https://www.lescalculateurs.fr/pages/plusvalue" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Calculateur Plus-Value Immobilière 2026 - LesCalculateurs.fr" />
    <meta property="og:description" content="Calculez l'impôt sur votre plus-value immobilière avec abattements 2025, visualisez des graphiques et comparez plusieurs scénarios, export PDF/PNG." />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Calculateur Plus-Value Immobilière 2026" />
    <meta name="twitter:description" content="Impôt, abattements, graphiques, comparaison multi-scenarii et export PDF/PNG" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicon-16x16.png">
    <link rel="manifest" href="../assets/site.webmanifest">
    <link rel="shortcut icon" href="../assets/favicon.ico">

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2209781252231399"
         crossorigin="anonymous"></script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TPFZCGX5');</script>
    <!-- End Google Tag Manager -->

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2HNTGCYQ1X"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-2HNTGCYQ1X');
    </script>

    <!-- WebApplication Schema.org -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Calculateur Plus-Value Immobilière 2025",
        "description": "Calculez l'impôt sur la plus-value immobilière avec abattements, graphiques, comparaison et export PDF/PNG.",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Web Browser",
        "url": "https://www.lescalculateurs.fr/pages/plusvalue",
        "isBasedOn": [
          "https://www.lescalculateurs.fr/pages/methodologie",
          "https://www.lescalculateurs.fr/pages/sources",
          "https://www.lescalculateurs.fr/pages/comment-calculer-plus-value"
        ],
        "citation": [
          {
            "@type": "CreativeWork",
            "name": "Legifrance.fr – Articles L13 et L14",
            "url": "https://www.legifrance.gouv.fr"
          },
          {
            "@type": "Organization",
            "name": "Direction Générale des Finances Publiques",
            "url": "https://www.impots.gouv.fr"
          },
          {
            "@type": "CreativeWork",
            "name": "Service-public.fr – Plus-values immobilières",
            "url": "https://www.service-public.fr/particuliers/vosdroits/F16623"
          }
        ]
      }
    </script>

    <!-- Sources Meta Tag for AI -->
    <meta name="source" content="legifrance.fr, impots.gouv.fr, service-public.fr">

    <!-- FAQ Schema.org (JSON-LD) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "Quels sont les abattements pour durée de détention ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Impôt sur le revenu : 6% par an dès la 6ème année, exonération totale après 22 ans. Prélèvements sociaux : 1,65% par an de la 6ème à la 21ème année, puis 9% par an, exonération après 30 ans."
            }
          },
          {
            "@type": "Question",
            "name": "Quels frais puis-je déduire ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Frais d'acquisition (notaire, droits), travaux d'amélioration avec factures, ou forfait de 15% du prix d'achat si détention > 5 ans. Les frais d'entretien ne sont pas déductibles."
            }
          },
          {
            "@type": "Question",
            "name": "La résidence principale est-elle taxée ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Non, la vente de la résidence principale est exonérée de plus-value immobilière. L'exonération s'applique même si vous êtes propriétaire de plusieurs biens."
            }
          },
          {
            "@type": "Question",
            "name": "Existe-t-il des exonérations ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Oui : résidence principale, petits propriétaires (< 15000 € de gain), plus-values inférieures à 1000 €, et diverses situations professionnelles. Vérifiez votre éligibilité."
            }
          },
          {
            "@type": "Question",
            "name": "Quels frais puis-je déduire ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Frais d'acquisition (notaire, droits), travaux d'amélioration avec factures, ou forfait de 15% du prix d'achat si détention > 5 ans. Les frais d'entretien ne sont pas déductibles."
            }
          }
        ]
      }
    </script>
    
    <!-- JSON-LD Calculator Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Calculator",
      "name": "Calculateur Plus-value Immobilière 2025",
      "description": "Calculez l'impôt sur votre plus-value immobilière avec abattements et exonérations 2025 - CGI compliant",
      "url": "https://www.lescalculateurs.fr/pages/plusvalue",
      "applicationCategory": "FinanceApplication",
      "screenshot": "https://www.lescalculateurs.fr/pages/plusvalue"
    }
    </script>
  </head>
  <body class="bg-gray-50">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TPFZCGX5"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
          <!-- Logo & Navigation -->
          <div class="flex items-center space-x-6">
            <img src="../assets/logo.svg" alt="LesCalculateurs.fr" class="w-6 h-6">
            <a href="../index.html" class="flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
              </svg>
              <span>← Accueil</span>
            </a>
            <div class="hidden sm:block">
              <span class="text-gray-400">|</span>
            </div>
            <div class="hidden sm:flex items-center space-x-2">
              <div class="bg-purple-100 text-purple-700 rounded-lg p-1.5">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                </svg>
              </div>
              <span class="text-sm font-medium text-gray-700">Plus-value</span>
            </div>
          </div>

          <!-- Title & Status -->
          <div class="flex items-center space-x-3">
            <h1 class="text-xl sm:text-2xl font-bold text-gray-900">
              💰 Plus-value Immobilière 2026 — impôt, abattements, exonérations
            </h1>
            <span class="hidden sm:inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
              ✨ Nouveau
            </span>
          </div>

          <!-- Actions -->
          <div class="flex items-center space-x-2">
            <div class="hidden md:block">
              <span class="text-xs text-gray-500">Abattements 2026</span>
            </div>
          </div>
        </div>
      </div>
      </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Intro SEO -->
      <section class="mb-12">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">
          💰 Plus-value Immobilière 2026
        </h2>

        <!-- AI Section: Question explicite -->
        <section class="ai-intro mb-6">
          <h2 class="text-xl font-bold text-gray-900 mb-2">❓ Comment calculer la plus-value immobilière en France ?</h2>
          <p class="ai-response text-gray-700">
            Plus-value = (Prix vente - Prix achat - Frais) × Taux impôt. Abattement: 6% par an dès année 6 (exonération après 22 ans). Prélèvements sociaux: 1,65% par an de l'année 6–21, puis 9% par an (exonération après 30 ans).
          </p>
        </section>

        <!-- AI Section: Résumé rapide -->
        <section class="ai-summary mb-6">
          <h3 class="text-lg font-bold text-gray-900 mb-3">📌 Résumé rapide</h3>
          <ul class="space-y-2 text-gray-700">
            <li><strong>Source:</strong> Code Général des Impôts (CGI) + Direction Générale des Finances Publiques</li>
            <li><strong>Calcul:</strong> (Vente - Achat - Frais) appliqué barème progressif + abattements durée</li>
            <li><strong>Particularité:</strong> Résidence principale exonérée | Abattements importants après 6 ans</li>
            <li><strong>Outil:</strong> Simulation gratuite, barèmes 2025 à jour</li>
          </ul>
        </section>

        <p class="text-lg text-gray-600 leading-relaxed mb-4">
          Calculez précisément l'impôt sur votre plus-value immobilière 2025 !
          Notre outil intègre tous les abattements pour durée de détention, les
          exonérations possibles et les taux en vigueur. Résidence principale,
          secondaire ou investissement locatif : découvrez ce que vous devrez
          réellement payer au fisc.
        </p>
        <p class="text-lg text-gray-600 leading-relaxed">
          Abattements progressifs sur l'impôt sur le revenu (6% par an dès la
          6ème année) et sur les prélèvements sociaux (1,65% dès la 6ème année,
          puis 9% dès la 22ème). Exonération totale après 30 ans de détention.
          Calculs conformes à la réglementation fiscale 2025 avec prise en
          compte des frais d'acquisition et travaux déductibles. Pour plus de
          détails, consultez
          <a href="https://www.legifrance.gouv.fr" target="_blank" rel="noopener" class="text-blue-600 hover:underline">legifrance.gouv.fr</a>.
        </p>
      </section>

      <!-- Feature Cards -->
      <section class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-8 mb-12">
        <div class="space-y-4">
          <div class="grid md:grid-cols-3 gap-4">
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">📈</div>
              <h3 class="font-bold text-gray-900 mb-1">
                Calcul exact de plus-value
              </h3>
              <p class="text-sm text-gray-600">
                Déduction automatique des frais d'acquisition, travaux et
                améliorations avec justificatifs
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">📊</div>
              <h3 class="font-bold text-gray-900 mb-1">Abattements 2026</h3>
              <p class="text-sm text-gray-600">
                Application automatique des abattements pour durée de détention
                et type de bien
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">✅</div>
              <h3 class="font-bold text-gray-900 mb-1">Exonérations</h3>
              <p class="text-sm text-gray-600">
                Détection des exonérations possibles (résidence principale,
                durée de détention, etc.)
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">📥</div>
              <h3 class="font-bold text-gray-900 mb-1">Comparaison & Export</h3>
              <p class="text-sm text-gray-600">
                Comparez plusieurs scénarios, visualisez les graphiques et exportez en PDF/PNG.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- HowTo JSON-LD: Calculer la plus-value immobilière -->
      <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "HowTo",
          "name": "Calculer votre plus-value immobilière",
          "description": "Étapes pour estimer la plus-value et les impôts avec abattements 2025",
          "step": [
            {"@type": "HowToStep", "name": "Saisir les montants", "text": "Indiquez prix de vente, prix d'achat, frais et travaux."},
            {"@type": "HowToStep", "name": "Renseigner les dates", "text": "Sélectionnez dates d'achat et de vente pour calculer la durée de détention."},
            {"@type": "HowToStep", "name": "Choisir le type de bien", "text": "Résidence principale, secondaire, investissement ou terrain."},
            {"@type": "HowToStep", "name": "Calculer", "text": "Obtenez plus-value brute, abattements (IR/PS), impôts et plus-value nette."},
            {"@type": "HowToStep", "name": "Comparer et exporter", "text": "Ajoutez des scénarios, comparez les impôts et exportez en PDF/PNG."}
          ]
        }
      </script>

      <!-- Calculateur -->
      <div class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          🧮 Calcul de votre plus-value immobilière — barèmes 2026
        </h2>

        <form id="plusvalue-form" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Prix de vente (€)
              </label>
              <input
                type="number"
                id="prixVente"
                placeholder="400000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Prix d'acquisition (€)
              </label>
              <input
                type="number"
                id="prixAchat"
                placeholder="250000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Frais d'acquisition (€)
              </label>
              <input
                type="number"
                id="fraisAchat"
                placeholder="25000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
              <p class="text-xs text-gray-500 mt-1">
                Frais de notaire, droits d'enregistrement...
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Travaux et améliorations (€)
              </label>
              <input
                type="number"
                id="travaux"
                placeholder="30000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
              <p class="text-xs text-gray-500 mt-1">
                Travaux déductibles avec factures
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Date d'acquisition
              </label>
              <input
                type="date"
                id="dateAchat"
                max="2025-12-31"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Date de vente
              </label>
              <input
                type="date"
                id="dateVente"
                max="2025-12-31"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Type de bien
            </label>
            <select
              id="typeBien"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
              <option value="principale">Résidence principale</option>
              <option value="secondaire">Résidence secondaire</option>
              <option value="investissement">Investissement locatif</option>
              <option value="terrain">Terrain à bâtir</option>
            </select>
          </div>

          <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors duration-200"
          >
            💰 Calculer la plus-value et l'impôt
          </button>
        </form>

        <!-- Résultats avec graphiques -->
        <div id="results" class="hidden mt-8">
          <!-- Les graphiques seront insérés ici dynamiquement -->
        </div>
      </div>

      <!-- Boutons de comparaison -->
      <div class="mt-6 flex justify-center gap-3">
        <button
          id="plusvalue-add-to-compare"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold shadow-md transition-colors"
        >
          ➕ Ajouter à la comparaison
        </button>
        <button
          id="plusvalue-add-other"
          class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold shadow-md transition-colors hidden"
        >
          ➕ Ajouter un autre bien
        </button>
        <button
          id="plusvalue-reset-compare"
          class="px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 font-semibold shadow-md transition-colors hidden"
        >
          🔄 Réinitialiser
        </button>
      </div>

      <!-- Modal pour ajouter un autre bien -->
      <div id="modal-add-bien" class="hidden fixed inset-0 bg-black bg-opacity-50 justify-center items-center z-50" style="display: none;">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900">➕ Ajouter un autre bien à la comparaison</h2>
            <button
              id="modal-close"
              class="text-gray-500 hover:text-gray-700 font-bold text-2xl"
            >
              ✕
            </button>
          </div>

          <form id="modal-form" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Prix de vente (€) *
                </label>
                <input
                  type="number"
                  id="modal-prixVente"
                  placeholder="400000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Prix d'acquisition (€) *
                </label>
                <input
                  type="number"
                  id="modal-prixAchat"
                  placeholder="250000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Frais d'acquisition (€)
                </label>
                <input
                  type="number"
                  id="modal-fraisAchat"
                  placeholder="25000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Travaux (€)
                </label>
                <input
                  type="number"
                  id="modal-travaux"
                  placeholder="30000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Date d'acquisition *
                </label>
                <input
                  type="date"
                  id="modal-dateAchat"
                  max="2025-12-31"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Date de vente *
                </label>
                <input
                  type="date"
                  id="modal-dateVente"
                  max="2025-12-31"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                Type de bien *
              </label>
              <select
                id="modal-typeBien"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                required
              >
                <option value="principale">Résidence principale</option>
                <option value="secondaire">Résidence secondaire</option>
                <option value="investissement">Investissement locatif</option>
                <option value="terrain">Terrain à bâtir</option>
              </select>
            </div>

            <div class="flex gap-3 justify-end mt-6">
              <button
                type="button"
                id="modal-cancel"
                class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-semibold"
              >
                Annuler
              </button>
              <button
                type="submit"
                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"
              >
                ✅ Calculer et ajouter
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Comparaison (masquée par défaut) -->
      <div id="plusvalue-comparaison" class="hidden mt-8"></div>

      <!-- FAQ Schema.org -->
      <section class="mt-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          ❓ Questions fréquentes
        </h2>

        <div class="space-y-4">
          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              Quels sont les abattements pour durée de détention ?
            </h3>
            <div>
              <p class="text-gray-600">
                Impôt sur le revenu : 6% par an dès la 6ème année, exonération
                totale après 22 ans. Prélèvements sociaux : 1,65% par an de la
                6ème à la 21ème année, puis 9% par an, exonération après 30 ans.
              </p>
            </div>
          </div>

          <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">
              Quels frais puis-je déduire ?
            </h3>
            <div>
              <p class="text-gray-600">
                Frais d'acquisition (notaire, droits), travaux d'amélioration
                avec factures, ou forfait de 15% du prix d'achat si détention
                &gt; 5 ans. Les frais d'entretien ne sont pas déductibles.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              La résidence principale est-elle taxée ?
            </h3>
            <div>
              <p class="text-gray-600">
                Non, la vente de la résidence principale est exonérée de
                plus-value immobilière. L'exonération s'applique même si vous
                êtes propriétaire de plusieurs biens.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              Comment est calculé le taux d'imposition ?
            </h3>
            <div>
              <p class="text-gray-600">
                Impôt sur le revenu : 19% (+ surtaxe si plus-value &gt; 50
                000€). Prélèvements sociaux : 17,2%. Total : 36,2% avant
                abattements pour durée de détention.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              Existe-t-il des exonérations particulières ?
            </h3>
            <div>
              <p class="text-gray-600">
                Oui : première vente (sous conditions), vente &lt; 15 000€,
                retraités/invalides sous plafond de revenus, ou réinvestissement
                dans la résidence principale dans les 24 mois.
              </p>
            </div>
          </div>
        </div>
      </section>

      </section>    </main>

    <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
      <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
        <h3 class="text-xl font-bold text-gray-900 mb-3">🔗 Voir aussi</h3>
        <div class="flex flex-wrap gap-3">
          <a href="/pages/notaire.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Frais de notaire</a>
          <a href="/pages/pret.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Mensualité de prêt</a>
          <a href="/pages/charges.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Charges de copropriété</a>
          <a href="/pages/taxe.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Taxe foncière</a>
          <a href="/pages/ik.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Frais kilométriques</a>
          <a href="/pages/travail.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Temps de travail</a>
          <a href="/pages/blog/frais-notaire-departements.html" class="inline-block bg-blue-600 text-white rounded px-4 py-2 text-sm font-semibold shadow hover:bg-blue-700">Tous les départements</a>
          <a href="/pages/blog.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Blog</a>
        </div>
      </div>
    </section>

    <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
      <div class="mt-12 bg-gray-100 rounded-lg p-6">
        <h3 class="font-bold text-gray-900 mb-3">📚 Sources et références officielles</h3>
        <ul class="text-sm text-gray-700 space-y-2">
          <li>
            • Plus-value immobilière (règles 2025):
            <a href="https://www.service-public.fr/particuliers/vosdroits/F10864" target="_blank" rel="noopener" class="text-blue-600 hover:underline">service-public.fr</a>
          </li>
          <li>
            • Informations officielles et démarches:
            <a href="https://www.impots.gouv.fr/particulier/questions/je-vends-mon-bien-immobilier-vais-je-payer-de-la-plus-value-immobiliere" target="_blank" rel="noopener" class="text-blue-600 hover:underline">impots.gouv.fr</a>
          </li>
        </ul>
      </div>
    </section>

    <footer class="bg-gray-800 text-white py-8 mt-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col items-center space-y-4">
          <p class="text-gray-300">
            © 2025 Les Calculateurs - Plus-value immobilière selon barèmes officiels
          </p>
          <div class="flex gap-4 text-sm">
            <a href="/pages/methodologie" class="text-gray-300 hover:text-white transition-colors">📚 Notre Méthodologie</a>
            <span class="text-gray-500">|</span>
            <a href="/pages/sources" class="text-gray-300 hover:text-white transition-colors">🏛️ Sources Officielles</a>
          </div>
        </div>
      </div>
    </footer>

    <script type="module" src="../main.ts"></script>
    <script type="module">
      document
        .getElementById("plusvalue-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const prixVente =
            parseFloat(document.getElementById("prixVente").value) || 0;
          const prixAchat =
            parseFloat(document.getElementById("prixAchat").value) || 0;
          const fraisAchat =
            parseFloat(document.getElementById("fraisAchat").value) || 0;
          const travaux =
            parseFloat(document.getElementById("travaux").value) || 0;
          const dateAchat = new Date(
            document.getElementById("dateAchat").value
          );
          const dateVente = new Date(
            document.getElementById("dateVente").value
          );
          const typeBien = document.getElementById("typeBien").value;

          if (!prixVente || !prixAchat || !dateAchat || !dateVente) {
            alert("Veuillez remplir tous les champs obligatoires");
            return;
          }

          // Calcul de la durée de détention
          const dureeMs = dateVente - dateAchat;
          const dureeAnnes = dureeMs / (1000 * 60 * 60 * 24 * 365.25);
          const dureeAnneesEntier = Math.floor(dureeAnnes);

          // Prix de revient
          let prixRevient = prixAchat + fraisAchat + travaux;

          // Abattement forfaitaire de 15% si détention > 5 ans (optionnel)
          if (dureeAnnes > 5) {
            const abattementForfait = prixAchat * 0.15;
            if (abattementForfait > travaux) {
              prixRevient = prixAchat + fraisAchat + abattementForfait;
            }
          }

          // Plus-value brute
          const plusValueBrute = prixVente - prixRevient;

          if (plusValueBrute <= 0) {
            document.getElementById("results").innerHTML = `
            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-blue-900 mb-4">✅ Aucun impôt à payer</h3>
              <p class="text-gray-700">Vous n'avez pas de plus-value imposable. La vente génère une moins-value de <strong>${Math.abs(
                plusValueBrute
              ).toLocaleString("fr-FR")} €</strong>.</p>
            </div>
          `;
            document.getElementById("results").classList.remove("hidden");
            return;
          }

          if (typeBien === "principale") {
            document.getElementById("results").innerHTML = `
            <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-green-900 mb-4">✅ Exonération résidence principale</h3>
              <p class="text-gray-700">La plus-value sur la vente de votre résidence principale est exonérée d'impôt (IR et prélèvements sociaux). Aucune imposition n'est due.</p>
            </div>
            `;
            document.getElementById("results").classList.remove("hidden");
            return;
          }

          // Calcul des abattements selon la durée
          let abattementIR = 0; // Impôt sur le revenu
          let abattementPS = 0; // Prélèvements sociaux

          if (dureeAnnes >= 22) {
            abattementIR = 100; // Exonération totale
          } else if (dureeAnnes >= 6) {
            abattementIR = (dureeAnneesEntier - 5) * 6;
          }

          if (dureeAnneesEntier >= 30) {
            abattementPS = 100;
          } else if (dureeAnneesEntier >= 23) {
            abattementPS = 28 + (dureeAnneesEntier - 22) * 9;
          } else if (dureeAnneesEntier === 22) {
            abattementPS = 28;
          } else if (dureeAnneesEntier >= 6) {
            abattementPS = (dureeAnneesEntier - 5) * 1.65;
          }

          // Application des abattements
          const plusValueIR = plusValueBrute * (1 - abattementIR / 100);
          const plusValuePS = plusValueBrute * (1 - abattementPS / 100);

          // Calcul de l'impôt
          const tauxIR = 0.19; // 19%
          const tauxPS = 0.172; // 17,2%

          let impotIR = plusValueIR * tauxIR;
          const impotPS = plusValuePS * tauxPS;

          // Surtaxe si plus-value IR > 50 000€
          let surtaxe = 0;
          if (plusValueIR > 50000) {
            const tranche = plusValueIR - 50000;
            if (tranche <= 10000) surtaxe = tranche * 0.02;
            else if (tranche <= 20000) surtaxe = 200 + (tranche - 10000) * 0.03;
            else if (tranche <= 30000) surtaxe = 500 + (tranche - 20000) * 0.04;
            else if (tranche <= 40000) surtaxe = 900 + (tranche - 30000) * 0.05;
            else surtaxe = 1400 + (tranche - 40000) * 0.06;
          }

          const impotTotal = impotIR + surtaxe + impotPS;
          const plusValueNette = plusValueBrute - impotTotal;

          function formatCurrency(amount) {
            return new Intl.NumberFormat("fr-FR", {
              style: "currency",
              currency: "EUR",
            }).format(amount);
          }

          // Créer un ID unique pour les graphiques
          const chartTimestamp = Date.now() + Math.random();
          
          const results = `
          <div class="space-y-6">
            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-blue-900 mb-4">📊 Détail du calcul</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <p class="text-sm text-gray-600">Durée de détention</p>
                  <p class="text-lg font-semibold text-gray-900">${dureeAnneesEntier} ans ${Math.round(
            (dureeAnnes - dureeAnneesEntier) * 12
          )} mois</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Prix de revient</p>
                  <p class="text-lg font-semibold text-gray-900">${formatCurrency(
                    prixRevient
                  )}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Plus-value brute</p>
                  <p class="text-lg font-semibold text-gray-900">${formatCurrency(
                    plusValueBrute
                  )}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Type de bien</p>
                  <p class="text-lg font-semibold text-gray-900">${
                    typeBien === "principale"
                      ? "Résidence principale"
                      : typeBien === "secondaire"
                      ? "Résidence secondaire"
                      : typeBien === "investissement"
                      ? "Investissement locatif"
                      : "Terrain à bâtir"
                  }</p>
                </div>
              </div>
            </div>

            <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-green-900 mb-4">💰 Abattements appliqués</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600">Abattement impôt sur le revenu :</span>
                  <span class="font-semibold text-green-700">${abattementIR.toFixed(
                    1
                  )}%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Abattement prélèvements sociaux :</span>
                  <span class="font-semibold text-green-700">${abattementPS.toFixed(
                    1
                  )}%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Plus-value taxable (IR) :</span>
                  <span class="font-semibold">${formatCurrency(
                    plusValueIR
                  )}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Plus-value taxable (PS) :</span>
                  <span class="font-semibold">${formatCurrency(
                    plusValuePS
                  )}</span>
                </div>
              </div>
            </div>

            <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-red-900 mb-4">💸 Impôts à payer</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600">Impôt sur le revenu (19%) :</span>
                  <span class="font-semibold">${formatCurrency(impotIR)}</span>
                </div>
                ${
                  surtaxe > 0
                    ? `
                <div class="flex justify-between">
                  <span class="text-gray-600">Surtaxe (plus-value &gt; 50k€) :</span>
                  <span class="font-semibold">${formatCurrency(surtaxe)}</span>
                </div>
                `
                    : ""
                }
                <div class="flex justify-between">
                  <span class="text-gray-600">Prélèvements sociaux (17,2%) :</span>
                  <span class="font-semibold">${formatCurrency(impotPS)}</span>
                </div>
                <div class="border-t pt-2 flex justify-between text-lg">
                  <span class="font-bold text-gray-900">Total des impôts :</span>
                  <span class="font-bold text-red-700">${formatCurrency(
                    impotTotal
                  )}</span>
                </div>
              </div>
            </div>

            <div class="bg-purple-50 border-l-4 border-purple-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-purple-900 mb-4">🎯 Résultat final</h3>
              <div class="space-y-3">
                <div class="flex justify-between text-lg">
                  <span class="font-bold text-gray-900">Plus-value nette (après impôts) :</span>
                  <span class="font-bold text-purple-700">${formatCurrency(
                    plusValueNette
                  )}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Taux d'imposition effectif :</span>
                  <span class="font-semibold">${(
                    (impotTotal / plusValueBrute) *
                    100
                  ).toFixed(1)}%</span>
                </div>
              </div>
            </div>

            <div class="text-sm text-gray-500 bg-gray-50 p-4 rounded">
              <p><strong>💡 Bon à savoir :</strong></p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li>Exonération totale après 30 ans de détention</li>
                <li>La résidence principale est toujours exonérée</li>
                <li>Possibilité d'abattement forfaitaire de 15% si détention > 5 ans</li>
                <li>Ces calculs sont indicatifs, consultez un fiscaliste</li>
              </ul>
            </div>

            <!-- Graphiques (affichés seulement s'il y a des impôts) -->
            ${impotTotal && impotTotal > 0 ? `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
              <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-900 mb-4">📊 Ventilation des impôts</h3>
                <div style="position: relative; height: 300px; width: 100%;">
                  <canvas id="chart-impots-${chartTimestamp}"></canvas>
                </div>
              </div>
              <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-900 mb-4">📈 Abattements selon durée</h3>
                <div style="position: relative; height: 300px; width: 100%;">
                  <canvas id="chart-abattements-${chartTimestamp}"></canvas>
                </div>
              </div>
            </div>
            ` : ''}
          </div>
        `;

          // Stockage des données pour l'export PDF
          window.plusValueData = {
            prixVente,
            prixAchat,
            fraisAchat,
            travaux,
            dateAchat,
            dateVente,
            typeBien,
            dureeDetention: dureeAnnes,
            prixRevient: prixRevient,
            plusValueBrute,
            abattementIR,
            abattementPS,
            plusValueIR,
            plusValuePS,
            impotIR,
            impotPS,
            surtaxe,
            impotTotal,
            plusValueNette
          };

          document.getElementById("results").innerHTML = results;
          document.getElementById("results").classList.remove("hidden");
          
          // Ne pas masquer le bouton "Ajouter à la comparaison" - on peut ajouter plusieurs fois
          document.getElementById("plusvalue-add-to-compare")?.classList.remove("hidden");
          
          // Générer les graphiques après un court délai pour que les canvas soient dans le DOM
          // Uniquement si ce ne sont pas des cas d'exonération (résidence principale ou moins-value)
          if (impotTotal && impotTotal > 0) {
            setTimeout(() => {
              // Trouver les canvas générés avec les IDs spécifiques
              const chartImpotsId = `chart-impots-${chartTimestamp}`;
              const chartAbattementsId = `chart-abattements-${chartTimestamp}`;
              
              const chartImpotsCanvas = document.getElementById(chartImpotsId);
              const chartAbattementsCanvas = document.getElementById(chartAbattementsId);
              
              console.log("🔍 Canvas trouvés:");
              console.log("  - chart-impots:", chartImpotsId, chartImpotsCanvas ? "✅" : "❌");
              console.log("  - chart-abattements:", chartAbattementsId, chartAbattementsCanvas ? "✅" : "❌");

              // Graphique 1: Ventilation des impôts
              if (chartImpotsCanvas && window.Chart) {
                const ctxImpots = chartImpotsCanvas.getContext('2d');
                if (ctxImpots) {
                  new window.Chart(ctxImpots, {
                    type: 'doughnut',
                    data: {
                      labels: ['Impôt sur revenu', 'Surtaxe', 'Prélèvements sociaux'],
                      datasets: [{
                        data: [impotIR, surtaxe, impotPS],
                        backgroundColor: ['#ef4444', '#f59e0b', '#8b5cf6'],
                        borderColor: '#fff',
                        borderWidth: 2
                      }]
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                          callbacks: {
                            label: function(context) {
                              const amount = context.parsed;
                              return formatCurrency(amount) + ' (' + ((amount / impotTotal) * 100).toFixed(1) + '%)';
                            }
                          }
                        }
                      }
                    }
                  });
                }
              }

              // Graphique 2: Évolution des abattements
              if (chartAbattementsCanvas && window.Chart) {
                console.log("📈 Création du graphique 'Abattements selon durée'");
                const ctxAbattements = chartAbattementsCanvas.getContext('2d');
                console.log("📈 Context obtenu?", !!ctxAbattements);
                if (ctxAbattements) {
                  const yearsData = [];
                  const abattementIRData = [];
                  const abattementPSData = [];

                  for (let year = 0; year <= 30; year++) {
                    yearsData.push(year);
                    
                    let irAbat = 0;
                    if (year >= 22) irAbat = 100;
                    else if (year >= 6) irAbat = (year - 5) * 6;
                    
                    let psAbat = 0;
                    if (year >= 30) psAbat = 100;
                    else if (year >= 23) psAbat = 28 + (year - 22) * 9;
                    else if (year === 22) psAbat = 28;
                    else if (year >= 6) psAbat = (year - 5) * 1.65;
                    
                    abattementIRData.push(irAbat);
                    abattementPSData.push(psAbat);
                  }

                  new window.Chart(ctxAbattements, {
                    type: 'line',
                    data: {
                      labels: yearsData,
                      datasets: [
                        {
                          label: 'Abattement IR',
                          data: abattementIRData,
                          borderColor: '#ef4444',
                          backgroundColor: 'rgba(239, 68, 68, 0.1)',
                          borderWidth: 2,
                          fill: true,
                          pointRadius: 2
                        },
                        {
                          label: 'Abattement PS',
                          data: abattementPSData,
                          borderColor: '#8b5cf6',
                          backgroundColor: 'rgba(139, 92, 246, 0.1)',
                          borderWidth: 2,
                          fill: true,
                          pointRadius: 2
                        }
                      ]
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                          callbacks: {
                            label: function(context) {
                              return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                            }
                          }
                        }
                      },
                      scales: {
                        y: {
                          beginAtZero: true,
                          max: 100,
                          ticks: { callback: function(v) { return v + '%'; } }
                        },
                        x: {
                          title: { display: true, text: 'Années de détention' }
                        }
                      }
                    }
                  });
                  console.log("✅ Graphique 'Abattements selon durée' créé");
                } else {
                  console.warn("⚠️ Context invalide pour 'Abattements selon durée'");
                }
              } else {
                console.warn("⚠️ Canvas ou Chart.js non disponible pour 'Abattements selon durée'", {
                  hasCanvas: !!chartAbattementsCanvas,
                  hasChart: !!window.Chart
                });
              }
            }, 200);
          }

          document
            .getElementById("results")
            .scrollIntoView({ behavior: "smooth" });
        });

      // Initialiser les dates par défaut
      document.addEventListener("DOMContentLoaded", () => {
        const today = new Date();
        const fiveYearsAgo = new Date();
        fiveYearsAgo.setFullYear(today.getFullYear() - 5);

        document.getElementById("dateVente").value = today
          .toISOString()
          .split("T")[0];
        document.getElementById("dateAchat").value = fiveYearsAgo
          .toISOString()
          .split("T")[0];

        // Initialiser les dates du modal aussi
        document.getElementById("modal-dateVente").value = today
          .toISOString()
          .split("T")[0];
        document.getElementById("modal-dateAchat").value = fiveYearsAgo
          .toISOString()
          .split("T")[0];

        // Event listeners pour comparaison
        import("../components/PlusValueComparison.ts").then(({ PlusValueComparison }) => {
          // Initialiser le conteneur de comparaison
          PlusValueComparison.initialize("plusvalue-comparaison");

          const addBtn = document.getElementById("plusvalue-add-to-compare");
          const addOtherBtn = document.getElementById("plusvalue-add-other");
          const resetBtn = document.getElementById("plusvalue-reset-compare");
          const modal = document.getElementById("modal-add-bien");
          const modalForm = document.getElementById("modal-form");
          const modalClose = document.getElementById("modal-close");
          const modalCancel = document.getElementById("modal-cancel");

          // Ouvrir/fermer le modal
          function openModal() {
            modal.style.display = "flex";
          }

          function closeModal() {
            modal.style.display = "none";
            modalForm.reset();
          }

          // Fermer le modal en cliquant sur le X ou Annuler
          modalClose.addEventListener("click", closeModal);
          modalCancel.addEventListener("click", closeModal);

          // Fermer le modal en cliquant en dehors
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              closeModal();
            }
          });

          if (addBtn && resetBtn && addOtherBtn) {
            // Bouton Ajouter à la comparaison (premier bien)
            addBtn.addEventListener("click", () => {
              if (window.plusValueData && window.plusValueData.impotTotal !== undefined) {
                PlusValueComparison.addComparison(window.plusValueData);
                
                // DÉSACTIVER le bouton Ajouter
                addBtn.disabled = true;
                addBtn.classList.add("opacity-50", "cursor-not-allowed");
                addBtn.classList.remove("hover:bg-blue-700");
                
                // AFFICHER le bouton Ajouter un autre bien
                addOtherBtn.classList.remove("hidden");
                
                // Afficher le bouton réinitialiser et la section comparaison
                resetBtn.classList.remove("hidden");
                document.getElementById("plusvalue-comparaison").classList.remove("hidden");
                document.getElementById("plusvalue-comparaison").scrollIntoView({ behavior: "smooth" });
              } else {
                alert("Veuillez d'abord effectuer un calcul");
              }
            });

            // Bouton Ajouter un autre bien (ouvre le modal)
            addOtherBtn.addEventListener("click", () => {
              openModal();
            });

            // Bouton Réinitialiser
            resetBtn.addEventListener("click", () => {
              PlusValueComparison.clearAll();
              
              // Réinitialiser les boutons
              addBtn.disabled = false;
              addBtn.classList.remove("opacity-50", "cursor-not-allowed");
              addBtn.classList.add("hover:bg-blue-700");
              addOtherBtn.classList.add("hidden");
              resetBtn.classList.add("hidden");
              document.getElementById("plusvalue-comparaison").classList.add("hidden");
              
              // Réinitialiser le formulaire principal
              document.getElementById("plusvalue-form").reset();
              document.getElementById("results").classList.add("hidden");
              closeModal();
            });

            // Bouton Calculer et ajouter (dans le modal)
            modalForm.addEventListener("submit", function(e) {
              e.preventDefault();

              // Récupérer les valeurs du modal
              const prixVente = parseFloat(document.getElementById("modal-prixVente").value) || 0;
              const prixAchat = parseFloat(document.getElementById("modal-prixAchat").value) || 0;
              const fraisAchat = parseFloat(document.getElementById("modal-fraisAchat").value) || 0;
              const travaux = parseFloat(document.getElementById("modal-travaux").value) || 0;
              const dateAchat = new Date(document.getElementById("modal-dateAchat").value);
              const dateVente = new Date(document.getElementById("modal-dateVente").value);
              const typeBien = document.getElementById("modal-typeBien").value;

              if (!prixVente || !prixAchat || !dateAchat || !dateVente) {
                alert("Veuillez remplir tous les champs obligatoires");
                return;
              }

              // Même logique de calcul que le formulaire principal
              const dureeMs = dateVente - dateAchat;
              const dureeAnnes = dureeMs / (1000 * 60 * 60 * 24 * 365.25);

              let prixRevient = prixAchat + fraisAchat + travaux;
              if (dureeAnnes > 5) {
                const abattementForfait = prixAchat * 0.15;
                if (abattementForfait > travaux) {
                  prixRevient = prixAchat + fraisAchat + abattementForfait;
                }
              }

              const plusValueBrute = prixVente - prixRevient;

              if (plusValueBrute <= 0 || typeBien === "principale") {
                alert("Ce bien n'est pas taxable ou génère une moins-value. Veuillez vérifier les données.");
                return;
              }

              // Calcul des abattements
              let abattementIR = 0;
              let abattementPS = 0;

              if (dureeAnnes >= 22) {
                abattementIR = 100;
              } else if (dureeAnnes >= 6) {
                abattementIR = (Math.floor(dureeAnnes) - 5) * 6;
              }

              if (dureeAnnes >= 30) {
                abattementPS = 100;
              } else if (dureeAnnes >= 23) {
                abattementPS = 28 + (Math.floor(dureeAnnes) - 22) * 9;
              } else if (Math.floor(dureeAnnes) === 22) {
                abattementPS = 28;
              } else if (dureeAnnes >= 6) {
                abattementPS = (Math.floor(dureeAnnes) - 5) * 1.65;
              }

              // Calcul des impôts
              const plusValueIR = Math.max(0, plusValueBrute * (1 - abattementIR / 100));
              const plusValuePS = Math.max(0, plusValueBrute * (1 - abattementPS / 100));
              const impotIR = plusValueIR * 0.19;
              const impotPS = plusValuePS * 0.172;

              let surtaxe = 0;
              if (plusValueBrute > 50000) {
                const tranche = Math.min(plusValueBrute - 50000, 350000);
                surtaxe += tranche * 0.02;
                if (plusValueBrute > 400000) {
                  const tranche2 = Math.min(plusValueBrute - 400000, 300000);
                  surtaxe += tranche2 * 0.03;
                }
                if (plusValueBrute > 700000) {
                  const tranche3 = Math.min(plusValueBrute - 700000, 200000);
                  surtaxe += tranche3 * 0.04;
                }
                if (plusValueBrute > 900000) {
                  const tranche4 = Math.min(plusValueBrute - 900000, 200000);
                  surtaxe += tranche4 * 0.05;
                }
                if (plusValueBrute > 1100000) {
                  surtaxe += (plusValueBrute - 1100000) * 0.06;
                }
              }

              const impotTotal = impotIR + impotPS + surtaxe;
              const plusValueNette = plusValueBrute - impotTotal;

              // Stocker les données
              const modalData = {
                prixVente,
                prixAchat,
                fraisAchat,
                travaux,
                dateAchat,
                dateVente,
                typeBien,
                dureeDetention: dureeAnnes,
                prixRevient,
                plusValueBrute,
                abattementIR,
                abattementPS,
                plusValueIR,
                plusValuePS,
                impotIR,
                impotPS,
                surtaxe,
                impotTotal,
                plusValueNette
              };

              // Ajouter à la comparaison
              PlusValueComparison.addComparison(modalData);
              document.getElementById("plusvalue-comparaison").scrollIntoView({ behavior: "smooth" });

              // Fermer le modal et réinitialiser
              closeModal();
            });
          }
        });
      });
    </script>
    
    <!-- Import Chart.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Auto-initialisation des exports PDF/CSV (importe pdfExport.js automatiquement) -->
    <script type="module" src="../utils/autoExportInit.js"></script>
  </body>
</html>



