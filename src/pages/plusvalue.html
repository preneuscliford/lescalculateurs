<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-adsense-account" content="ca-pub-2209781252231399">

    <!-- SEO & Social -->
    <title>Simulateur plus-value immobili√®re 2026 ‚Äì Calcul imp√¥t</title>
    <meta name="description" content="calculez l‚Äôimp√¥t sur votre plus-value immobili√®re en 2026. Abattements, exon√©rations et estimation gratuite." />
    <meta
      name="keywords"
      content="plus-value immobili√®re 2026, calcul imp√¥t plus-value, abattement dur√©e d√©tention, exon√©ration plus-value, taux imp√¥t immobilier, vente maison appartement, calculateur plus-value gratuit, bar√®mes fiscaux, CGI, r√©sidence principale"
    />

    <!-- SEO & Social -->
    <link rel="canonical" href="https://www.lescalculateurs.fr/pages/plusvalue" />
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {"@type": "ListItem", "position": 1, "name": "Accueil", "item": "https://www.lescalculateurs.fr/index"},
        {"@type": "ListItem", "position": 2, "name": "Plus-value immobili√®re", "item": "https://www.lescalculateurs.fr/pages/plusvalue"}
      ]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Plus‚Äëvalue immobili√®re",
      "url": "https://www.lescalculateurs.fr/pages/plusvalue",
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {"@type": "ListItem", "position": 1, "name": "Accueil", "item": "https://www.lescalculateurs.fr/index"},
          {"@type": "ListItem", "position": 2, "name": "Plus‚Äëvalue immobili√®re", "item": "https://www.lescalculateurs.fr/pages/plusvalue"}
        ]
      }
    }
    </script>
    <meta property="og:url" content="https://www.lescalculateurs.fr/pages/plusvalue" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Simulateur plus-value immobili√®re 2026 ‚Äì Calcul imp√¥t" />
    <meta property="og:description" content="calculez l‚Äôimp√¥t sur votre plus-value immobili√®re en 2026. Abattements, exon√©rations et estimation gratuite." />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Simulateur plus-value immobili√®re 2026 ‚Äì Calcul imp√¥t" />
    <meta name="twitter:description" content="calculez l‚Äôimp√¥t sur votre plus-value immobili√®re en 2026. Abattements, exon√©rations et estimation gratuite." />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicon-16x16.png">
    <link rel="manifest" href="../assets/site.webmanifest">
    <link rel="shortcut icon" href="../assets/favicon.ico">

    <script defer src="/third-party-loader.js"></script>

    <!-- WebApplication Schema.org -->
    <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Calculateur Plus-Value Immobili√®re 2026",
  "description": "calculez l'imp√¥t sur la plus-value immobili√®re avec abattements, graphiques, comparaison et export PDF/PNG.",
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "Web Browser",
  "url": "https://www.lescalculateurs.fr/pages/plusvalue",
  "isBasedOn": [
    "https://www.lescalculateurs.fr/pages/methodologie",
    "https://www.lescalculateurs.fr/pages/sources",
    "https://www.lescalculateurs.fr/pages/comment-calcul√©r-plus-value"
  ],
  "citation": [
    {
      "@type": "CreativeWork",
      "name": "Legifrance.fr ‚Äì Articles L13 et L14",
      "url": "https://www.legifrance.gouv.fr"
    },
    {
      "@type": "Organization",
      "name": "Direction G√©n√©rale des Finances Publiques",
      "url": "https://www.impots.gouv.fr"
    },
    {
      "@type": "CreativeWork",
      "name": "Service-public.fr ‚Äì Plus-values immobili√®res",
      "url": "https://www.service-public.fr/particuliers/vosdroits/F16623"
    }
  ]
}</script>

    <!-- Sources Meta Tag for AI -->
    <meta name="source" content="legifrance.fr, impots.gouv.fr, service-public.fr">

    <!-- FAQ Schema.org (JSON-LD) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "Quels sont les abattements pour dur√©e de d√©tention ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Imp√¥t sur le revenu : 6% par an d√®s la 6√®me ann√©e, exon√©ration totale apr√®s 22 ans. Pr√©l√®vements sociaux : 1,65% par an de la 6√®me √† la 21√®me ann√©e, puis 9% par an, exon√©ration apr√®s 30 ans."
            }
          },
          {
            "@type": "Question",
            "name": "Quels frais puis-je d√©duire ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Frais d'acquisition (notaire, droits), travaux d'am√©lioration avec factures, ou forfait de 15% du prix d'achat si d√©tention > 5 ans. Les frais d'entretien ne sont pas d√©ductibles."
            }
          },
          {
            "@type": "Question",
            "name": "La r√©sidence principale est-elle tax√©e ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Non, la vente de la r√©sidence principale est exon√©r√©e de plus-value immobili√®re. L'exon√©ration s'applique m√™me si vous √™tes propri√©taire de plusieurs biens."
            }
          },
          {
            "@type": "Question",
            "name": "Existe-t-il des exon√©rations ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Oui : r√©sidence principale, petits propri√©taires (< 15000 ‚Ç¨ de gain), plus-values inf√©rieures √† 1000 ‚Ç¨, et diverses situations professionnelles. V√©rifiez votre √©ligibilit√©."
            }
          },
          {
            "@type": "Question",
            "name": "Quels frais puis-je d√©duire ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Frais d'acquisition (notaire, droits), travaux d'am√©lioration avec factures, ou forfait de 15% du prix d'achat si d√©tention > 5 ans. Les frais d'entretien ne sont pas d√©ductibles."
            }
          }
        ]
      }
    </script>
    
    <!-- JSON-LD Calculator Schema -->
    <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Calculator",
  "name": "Calculateur Plus-value Immobili√®re 2026",
  "description": "calculez l'imp√¥t sur votre plus-value immobili√®re avec abattements et exon√©rations 2026 - CGI compliant",
  "url": "https://www.lescalculateurs.fr/pages/plusvalue",
  "applicationCategory": "FinanceApplication",
  "screenshot": "https://www.lescalculateurs.fr/pages/plusvalue"
}</script>
    <!-- Schema.org SoftwareApplication -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Simulateur de plus-value immobili√®re",
        "operatingSystem": "Web",
        "applicationCategory": "FinanceApplication",
        "description": "Calculateur permettant d'estimer l'imposition sur la plus-value immobili√®re avec abattements l√©gaux.",
        "url": "https://www.lescalculateurs.fr/pages/plus-value-immobiliere",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "EUR"
        }
      }
    </script>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "Comment conna√Ætre le montant estim√© des frais de notaire ?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Consultez un notaire ou utilisez les outils officiels des Notaires de France pour une estimation pr√©cise."
      }
    }
  ]
}
</script>
</head>
  <body class="bg-gray-50">
<div class="sticky-ymyl" role="alert" style="position:sticky;top:0;z-index:9999;background:#fff3cd;border:1px solid #ffc107;padding:12px 16px;text-align:center;font-size:14px;"><strong>‚ö†Ô∏è Estimation indicative.</strong> Montant d√©finitif sur <a href="https://www.notaires.fr" target="_blank" rel="noopener" style="color:#856404;text-decoration:underline;font-weight:bold;">notaires.fr</a> ou <a href="/simulateur" target="_blank" rel="noopener" style="color:#856404;text-decoration:underline;">estimateur gratuit</a>.</div>

    <header class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col items-center py-4">
          <!-- Logo & Navigation centr√©s -->
          <img src="/assets/lescalculateurs-new-logo.png" alt="LesCalculateurs.fr" class="h-10 w-auto mb-2">
          <div class="flex items-center justify-center space-x-3 mb-2">
            <a href="../index.html" class="flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
              </svg>
              <span>‚Üê Accueil</span>
            </a>
            <span class="text-gray-400">|</span>
            <span class="text-sm font-medium text-gray-700">Plus-value</span>
            <span class="text-xs text-gray-500 ml-2">Abattements 2026</span>
          </div>
        </div>
      </div>
      </div>
    </header>

<div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-center"><p class="text-sm text-gray-800 m-0">Les calculs reposent sur les bar√®mes r√©glement√©s en vigueur et les taux d√©partementaux connus √† date. Ils constituent une estimation indicative et non contractuelle.</p></div>

<!-- Bloc titre d√©plac√© ici -->
<div class="mb-6 text-center">
  <h1 class="text-2xl sm:text-4xl font-bold text-gray-900">
    Simulateur plus-value immobili√®re : estimation de l‚Äôimp√¥t
  </h1>
  <p class="text-base sm:text-lg text-gray-600 mt-2">
    Estimez l‚Äôimp√¥t sur votre plus-value immobili√®re selon le prix d‚Äôachat, la dur√©e de d√©tention et les abattements applicables.
  </p>
  <button
    data-scroll-target="#plusvalue-calculator"
    data-scroll-focus="input, select, textarea"
    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-colors shadow-md mt-6 mx-auto block"
  >
    üü¢ Lancer la simulation
  </button>
</div>


    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg mb-8">
        <p class="text-blue-800 text-sm mb-2">
          <strong>üìå Simulation √† titre indicatif :</strong> Cette estimation ne constitue pas un conseil fiscal. Elle correspond aux r√®gles en vigueur au 1er janvier 2026. V√©rifiez votre situation exacte (exon√©rations, surtaxe, justificatifs) avant d√©claration.
        </p>
        <p class="text-blue-800 text-sm m-0">
          R√©sultat affich√© : imp√¥t sur le revenu (19 %) + pr√©l√®vements sociaux (17,2 %) apr√®s abattements 2026.
        </p>
      </div>

      <section class="mb-8 bg-white border border-gray-200 rounded-xl p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">üìå R√©sum√© rapide</h2>
        <div class="space-y-2 text-gray-700 text-sm">
          <p>üèõÔ∏è <strong>Source</strong> : impots.gouv.fr, service-public.fr, legifrance.gouv.fr</p>
          <p>üìê <strong>Logique</strong> : calcul bas√© sur prix d‚Äôachat/vente, frais, travaux, dur√©e, type de bien</p>
          <p>üìÖ <strong>Ann√©e</strong> : param√®tres 2026</p>
          <p>‚ö†Ô∏è <strong>Important</strong> : r√©sultat non contractuel</p>
        </div>
      </section>

      <section class="mb-8 bg-indigo-50 border border-indigo-100 rounded-xl p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">üßæ Ce que permet ce simulateur</h2>
        <ul class="list-disc list-inside space-y-2 text-gray-700">
          <li>Obtenir un <strong>montant indicatif</strong> d‚Äôimp√¥t sur la plus‚Äëvalue</li>
          <li>Comprendre l‚Äôimpact de vos param√®tres</li>
          <li>Comparer plusieurs sc√©narios</li>
          <li>Croiser avec d‚Äôautres outils (notaire, imp√¥t, etc.)</li>
        </ul>
      </section>

      <section class="mb-8 bg-white border border-gray-200 rounded-xl p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">üß≠ Guide rapide (avant de calcul√©r)</h2>

        <h3 class="text-lg font-semibold text-gray-900 mb-2">üîπ Comment utiliser ce simulateur</h3>
        <ol class="list-decimal list-inside space-y-2 text-gray-700 text-sm mb-6">
          <li>Renseignez les informations demand√©es</li>
          <li>Indiquez vos montants ou param√®tres principaux</li>
          <li>Lancez la simulation</li>
          <li>Consultez le r√©sultat estimatif</li>
        </ol>

        <h3 class="text-lg font-semibold text-gray-900 mb-2">üîπ Comment lire les r√©sultats</h3>
        <ul class="list-disc list-inside space-y-2 text-gray-700 text-sm mb-6">
          <li><strong>Montant estim√©</strong> : ordre de grandeur</li>
          <li><strong>D√©tail</strong> : param√®tres pris en compte</li>
          <li><strong>Avertissement</strong> : d√©pend de votre situation r√©elle</li>
        </ul>

        <h3 class="text-lg font-semibold text-gray-900 mb-2">üîπ Pourquoi le r√©sultat peut √™tre nul / faible / diff√©rent</h3>
        <ul class="list-disc list-inside space-y-2 text-gray-700 text-sm">
          <li>D√©passement de seuils r√©glementaires</li>
          <li>Param√®tres non pris en compte dans une simulation simplifi√©e</li>
          <li>R√®gles sp√©cifiques propres √† votre dossier</li>
        </ul>
      </section>

      <section class="mb-8 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 rounded-lg p-6">
        <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:gap-6">
          <div class="text-4xl leading-none">üìä</div>
          <div class="flex-1">
            <h2 class="text-xl font-bold text-gray-900 mb-2">
              Comparez plusieurs biens et visualisez les √©carts (facultatif)
            </h2>
            <p class="text-gray-700 mb-4">
              Faites un calcul pour un bien, puis ajoutez une variante (prix, travaux, dur√©e de d√©tention)
              pour visualiser les √©carts et garder une trace de vos r√©sultats.
            </p>
            <div class="grid sm:grid-cols-3 gap-4">
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-bold text-gray-900 mb-1">üó∫Ô∏è Comparaison</h3>
                <p class="text-sm text-gray-600">
                  Comparez plusieurs biens c√¥te √† c√¥te.
                </p>
              </div>
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-bold text-gray-900 mb-1">üìà Graphiques</h3>
                <p class="text-sm text-gray-600">
                  Visualisez instantan√©ment les √©carts entre sc√©narios.
                </p>
              </div>
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <h3 class="font-bold text-gray-900 mb-1">üßæ D√©tail</h3>
                <p class="text-sm text-gray-600">
                  Lisez l‚ÄôIR, les pr√©l√®vements sociaux et les abattements.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Calculateur -->
      <div id="plusvalue-calculator" class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          üßÆ Calcul de votre plus-value immobili√®re ‚Äî bar√®mes 2026
        </h2>

        <form id="plusvalue-form" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Prix de vente (‚Ç¨)
              </label>
              <input
                type="number"
                id="prixVente"
                placeholder="400000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Prix d'acquisition (‚Ç¨)
              </label>
              <input
                type="number"
                id="prixAchat"
                placeholder="250000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Frais d'acquisition (‚Ç¨)
              </label>
              <input
                type="number"
                id="fraisAchat"
                placeholder="25000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
              <p class="text-xs text-gray-500 mt-1">
                Frais de notaire, droits d'enregistrement...
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Travaux et am√©liorations (‚Ç¨)
              </label>
              <input
                type="number"
                id="travaux"
                placeholder="30000"
                min="0"
                step="1000"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
              <p class="text-xs text-gray-500 mt-1">
                Travaux d√©ductibles avec factures
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Date d'acquisition
              </label>
              <input
                type="date"
                id="dateAchat"
                max="2026-12-31"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Date de vente
              </label>
              <input
                type="date"
                id="dateVente"
                max="2026-12-31"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Type de bien
            </label>
            <select
              id="typeBien"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
              <option value="principale">R√©sidence principale</option>
              <option value="secondaire">R√©sidence secondaire</option>
              <option value="investissement">Investissement locatif</option>
              <option value="terrain">Terrain √† b√¢tir</option>
            </select>
          </div>

          <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-colors duration-200"
          >
            üí∞ calcul√©r la plus-value et l'imp√¥t
          </button>
        </form>

        <!-- R√©sultats avec graphiques -->
        <div id="results" class="invisible mt-8 min-h-[220px]">
          <!-- Les graphiques seront ins√©r√©s ici dynamiquement -->
        </div>
      </div>

      <!-- Boutons de comparaison -->
      <div class="mt-6 flex justify-center gap-3">
        <button
          id="plusvalue-add-to-compare"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold shadow-md transition-colors"
        >
          ‚ûï Ajouter √† la comparaison
        </button>
        <button
          id="plusvalue-add-other"
          class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold shadow-md transition-colors hidden"
        >
          ‚ûï Ajouter un autre bien
        </button>
        <button
          id="plusvalue-reset-compare"
          class="px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 font-semibold shadow-md transition-colors hidden"
        >
          üîÑ R√©initialiser
        </button>
      </div>

      <!-- Modal pour ajouter un autre bien -->
      <div id="modal-add-bien" class="hidden fixed inset-0 bg-black bg-opacity-50 justify-center items-center z-50" style="display: none;">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900">‚ûï Ajouter un autre bien √† la comparaison</h2>
            <button
              id="modal-close"
              class="text-gray-500 hover:text-gray-700 font-bold text-2xl"
            >
              ‚úï
            </button>
          </div>

          <form id="modal-form" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Prix de vente (‚Ç¨) *
                </label>
                <input
                  type="number"
                  id="modal-prixVente"
                  placeholder="400000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Prix d'acquisition (‚Ç¨) *
                </label>
                <input
                  type="number"
                  id="modal-prixAchat"
                  placeholder="250000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Frais d'acquisition (‚Ç¨)
                </label>
                <input
                  type="number"
                  id="modal-fraisAchat"
                  placeholder="25000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Travaux (‚Ç¨)
                </label>
                <input
                  type="number"
                  id="modal-travaux"
                  placeholder="30000"
                  min="0"
                  step="1000"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Date d'acquisition *
                </label>
                <input
                  type="date"
                  id="modal-dateAchat"
                  max="2026-12-31"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Date de vente *
                </label>
                <input
                  type="date"
                  id="modal-dateVente"
                  max="2026-12-31"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required
                />
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                Type de bien *
              </label>
              <select
                id="modal-typeBien"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                required
              >
                <option value="principale">R√©sidence principale</option>
                <option value="secondaire">R√©sidence secondaire</option>
                <option value="investissement">Investissement locatif</option>
                <option value="terrain">Terrain √† b√¢tir</option>
              </select>
            </div>

            <div class="flex gap-3 justify-end mt-6">
              <button
                type="button"
                id="modal-cancel"
                class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-semibold"
              >
                Annuler
              </button>
              <button
                type="submit"
                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"
              >
                ‚úÖ calcul√©r et ajouter
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Comparaison (masqu√©e par d√©faut) -->
      <div id="plusvalue-comparaison" class="hidden mt-8"></div>

      <!-- Contenu √©ditorial (apr√®s l'outil) -->
      <section class="mt-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          üìò Comprendre le calcul de la plus-value (bar√®mes 2026)
        </h2>

        <div class="bg-white rounded-lg p-6 shadow-sm mb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">
            ‚ùì Comment calcul√©r la plus-value immobili√®re en France ?
          </h3>
          <p class="text-gray-700">
            Plus-value brute = Prix de vente ‚àí Prix de revient (prix d‚Äôachat + frais d‚Äôacquisition + travaux d√©ductibles). Puis, on applique des abattements pour dur√©e de d√©tention (diff√©rents pour l‚Äôimp√¥t sur le revenu et les pr√©l√®vements sociaux) avant de calcul√©r l‚Äôimp√¥t.
          </p>
        </div>

        <div class="bg-white rounded-lg p-6 shadow-sm mb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-3">üìå R√©sum√© rapide</h3>
          <ul class="space-y-2 text-gray-700">
            <li><strong>Sources :</strong> CGI (Legifrance) + DGFiP (impots.gouv.fr) + Service-public</li>
            <li><strong>Taux :</strong> 19 % (IR) + 17,2 % (pr√©l√®vements sociaux), avant surtaxe √©ventuelle</li>
            <li><strong>Exon√©ration fr√©quente :</strong> r√©sidence principale</li>
            <li><strong>Abattements :</strong> progressifs √† partir de la 6e ann√©e (exon√©ration IR apr√®s 22 ans, PS apr√®s 30 ans)</li>
          </ul>
        </div>

        <section class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-8">
          <div class="grid md:grid-cols-2 gap-4">
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">üìà</div>
              <h3 class="font-bold text-gray-900 mb-1">Base de calcul</h3>
              <p class="text-sm text-gray-600">
                Prix de vente, prix d‚Äôachat, frais d‚Äôacquisition et travaux d√©ductibles.
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">üìä</div>
              <h3 class="font-bold text-gray-900 mb-1">Abattements 2026</h3>
              <p class="text-sm text-gray-600">
                Abattements distincts IR / pr√©l√®vements sociaux selon la dur√©e de d√©tention.
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">‚úÖ</div>
              <h3 class="font-bold text-gray-900 mb-1">Exon√©rations</h3>
              <p class="text-sm text-gray-600">
                R√©sidence principale, dur√©e de d√©tention, cas particuliers sous conditions.
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">üßæ</div>
              <h3 class="font-bold text-gray-900 mb-1">R√©sultat lisible</h3>
              <p class="text-sm text-gray-600">
                D√©tail chiffr√© (base, abattements, IR, pr√©l√®vements sociaux) + plus-value nette.
              </p>
            </div>
          </div>
        </section>

        <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "calcul√©r votre plus-value immobili√®re",
  "description": "√âtapes pour estimer la plus-value et les imp√¥ts avec abattements 2026",
  "step": [
    {
      "@type": "HowToStep",
      "name": "Saisir les montants",
      "text": "Indiquez prix de vente, prix d'achat, frais et travaux."
    },
    {
      "@type": "HowToStep",
      "name": "Renseigner les dates",
      "text": "S√©lectionnez dates d'achat et de vente pour calcul√©r la dur√©e de d√©tention."
    },
    {
      "@type": "HowToStep",
      "name": "Choisir le type de bien",
      "text": "R√©sidence principale, secondaire, investissement ou terrain."
    },
    {
      "@type": "HowToStep",
      "name": "calcul√©r",
      "text": "Obtenez plus-value brute, abattements (IR/PS), imp√¥ts et plus-value nette."
    },
    {
      "@type": "HowToStep",
      "name": "Comparer et exporter",
      "text": "Ajoutez des sc√©narios, comparez les imp√¥ts et exportez en PDF/PNG."
    }
  ]
}</script>
      </section>

      <!-- FAQ Schema.org -->
      <section class="mt-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          ‚ùì Questions fr√©quentes
        </h2>

        <div class="space-y-4">
          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              Quels sont les abattements pour dur√©e de d√©tention ?
            </h3>
            <div>
              <p class="text-gray-600">
                Imp√¥t sur le revenu : 6% par an d√®s la 6√®me ann√©e, exon√©ration
                totale apr√®s 22 ans. Pr√©l√®vements sociaux : 1,65% par an de la
                6√®me √† la 21√®me ann√©e, puis 9% par an, exon√©ration apr√®s 30 ans.
              </p>
            </div>
          </div>

          <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">
              Quels frais puis-je d√©duire ?
            </h3>
            <div>
              <p class="text-gray-600">
                Frais d'acquisition (notaire, droits), travaux d'am√©lioration
                avec factures, ou forfait de 15% du prix d'achat si d√©tention
                &gt; 5 ans. Les frais d'entretien ne sont pas d√©ductibles.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              La r√©sidence principale est-elle tax√©e ?
            </h3>
            <div>
              <p class="text-gray-600">
                Non, la vente de la r√©sidence principale est exon√©r√©e de
                plus-value immobili√®re. L'exon√©ration s'applique m√™me si vous
                √™tes propri√©taire de plusieurs biens.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              Comment est calcul√© le taux d'imposition ?
            </h3>
            <div>
              <p class="text-gray-600">
                Imp√¥t sur le revenu : 19% (+ surtaxe si plus-value &gt; 50
                000‚Ç¨). Pr√©l√®vements sociaux : 17,2%. Total : 36,2% avant
                abattements pour dur√©e de d√©tention.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
            >
              Existe-t-il des exon√©rations particuli√®res ?
            </h3>
            <div>
              <p class="text-gray-600">
                Oui : premi√®re vente (sous conditions), vente &lt; 15 000‚Ç¨,
                retrait√©s/invalides sous plafond de revenus, ou r√©investissement
                dans la r√©sidence principale dans les 24 mois.
              </p>
            </div>
          </div>
        </div>
      </section>

      <section class="mt-16 bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          üí° Exemples chiffr√©s (indicatifs)
        </h2>
        <p class="text-gray-600 mb-8">
          Les montants ci-dessous sont des ordres de grandeur. Pour un r√©sultat estim√©, renseignez vos chiffres dans le
          <a href="#plusvalue-calculator" class="text-blue-600 underline font-semibold">simulateur</a>.
        </p>

        <div class="space-y-6">
          <div class="border-l-4 border-blue-500 pl-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-3">
              Exemple 1 : R√©sidence secondaire, d√©tention 10 ans
            </h3>
            <div class="bg-gray-50 p-4 rounded-lg text-sm space-y-2 mb-3">
              <div><span class="text-gray-700">Vente :</span> <span class="font-medium">400 000 ‚Ç¨</span></div>
              <div><span class="text-gray-700">Achat :</span> <span class="font-medium">250 000 ‚Ç¨</span></div>
              <div><span class="text-gray-700">Frais :</span> <span class="font-medium">25 000 ‚Ç¨</span></div>
              <div><span class="text-gray-700">Travaux :</span> <span class="font-medium">30 000 ‚Ç¨</span></div>
            </div>
            <div class="bg-blue-50 p-4 rounded-lg">
              <p class="text-blue-900 m-0">
                <strong>Ordre de grandeur :</strong> imp√¥ts ‚âà <span class="text-xl font-bold text-blue-700">28 000 ‚Ç¨</span> ‚Üí plus-value nette ‚âà <span class="text-xl font-bold text-blue-700">67 000 ‚Ç¨</span>.
              </p>
            </div>
          </div>

          <div class="border-l-4 border-green-500 pl-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-3">
              Exemple 2 : D√©tention 25 ans (IR exon√©r√©, PS encore dus)
            </h3>
            <div class="bg-gray-50 p-4 rounded-lg text-sm space-y-2 mb-3">
              <div><span class="text-gray-700">Plus-value brute :</span> <span class="font-medium">100 000 ‚Ç¨</span></div>
              <div><span class="text-gray-700">Abattement IR :</span> <span class="font-medium">100 %</span></div>
              <div><span class="text-gray-700">Abattement PS :</span> <span class="font-medium">‚âà 55 %</span></div>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
              <p class="text-green-900 m-0">
                <strong>Ordre de grandeur :</strong> pr√©l√®vements sociaux ‚âà <span class="text-xl font-bold text-green-700">7 700 ‚Ç¨</span>.
              </p>
            </div>
          </div>

          <div class="border-l-4 border-purple-500 pl-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-3">
              Exemple 3 : D√©tention 30 ans (exon√©ration totale)
            </h3>
            <div class="bg-purple-50 p-4 rounded-lg">
              <p class="text-purple-900 m-0">
                <strong>R√©sultat :</strong> imp√¥ts = <span class="text-xl font-bold text-purple-700">0 ‚Ç¨</span>.
              </p>
            </div>
          </div>
        </div>
      </section>

    </main>

    <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
      <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
        <h3 class="text-xl font-bold text-gray-900 mb-3">üîó Voir aussi</h3>
        <p class="text-sm text-gray-600 mb-3">
          Parcours fiscal immobilier :
          <a href="/pages/pret.html" class="text-blue-700 hover:underline">Pr√™t</a>
          ‚Üí
          <a href="/pages/plusvalue.html" class="text-blue-700 hover:underline">Plus‚Äëvalue</a>
          ‚Üí
          <a href="/pages/impot.html" class="text-blue-700 hover:underline">Imp√¥t</a>
        </p>
        <div class="flex flex-wrap gap-3">
          <a href="/pages/apl.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">APL 2026</a>
          <a href="/pages/notaire.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Frais de notaire</a>
          <a href="/pages/pret.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Mensualit√© de pr√™t</a>
          <a href="/pages/charges.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Charges de copropri√©t√©</a>
          <a href="/pages/taxe.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Taxe fonci√®re</a>
          <a href="/pages/impot.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Imp√¥t sur le revenu</a>
          <a href="/pages/ik.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Indemnit√©s kilom√©triques (IK)</a>
          <a href="/pages/travail.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Temps de travail</a>
          <a href="/pages/blog/frais-notaire-departements.html" class="inline-block bg-blue-600 text-white rounded px-4 py-2 text-sm font-semibold shadow hover:bg-blue-700">Tous les d√©partements</a>
          <a href="/pages/blog.html" class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50">Blog</a>
        </div>
      </div>
    </section>

    <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
      <div class="mt-12 bg-blue-50 rounded-lg p-6 border border-blue-200">
        <h3 class="font-bold text-blue-900 mb-3">üìö Sources 2026</h3>
        <ul class="text-sm text-gray-700 space-y-2">
          <li>
            ‚Ä¢ Plus-value immobili√®re (r√®gles 2026):
            <a href="https://www.service-public.fr/particuliers/vosdroits/F10864" target="_blank" rel="noopener" class="text-blue-600 hover:underline">service-public.fr</a>
          </li>
          <li>
            ‚Ä¢ Informations officielles et d√©marches:
            <a href="https://www.impots.gouv.fr/particulier/je-calcule-mes-impots/questions/je-vends-mon-bien-immobilier-vais-je-payer-de-la-plus-value-immobiliere" target="_blank" rel="noopener" class="text-blue-600 hover:underline">impots.gouv.fr</a>
          </li>
        </ul>
      </div>
    </section>

    <footer class="bg-gray-800 text-white py-8 mt-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col items-center space-y-4">
          <p class="text-gray-300">
            ¬© 2026 Les Calculateurs - Plus-value immobili√®re selon bar√®mes en vigueur
          </p>
          <div class="flex gap-4 text-sm">
            <a href="/pages/methodologie" class="text-gray-300 hover:text-white transition-colors">üìö Notre M√©thodologie</a>
            <span class="text-gray-500">|</span>
            <a href="/pages/sources" class="text-gray-300 hover:text-white transition-colors">üèõÔ∏è Sources Officielles</a>
          </div>
        </div>
      </div>
    </footer>

    <script type="module" src="../main.ts"></script>
    <script type="module">
      let __lcChartPromise;
      function __lcLoadChart() {
        if (__lcChartPromise) return __lcChartPromise;
        __lcChartPromise = import("chart.js/auto").then((mod) => {
          return mod.Chart || mod.default || mod;
        });
        return __lcChartPromise;
      }

      document
        .getElementById("plusvalue-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const prixVente =
            parseFloat(document.getElementById("prixVente").value) || 0;
          const prixAchat =
            parseFloat(document.getElementById("prixAchat").value) || 0;
          const fraisAchat =
            parseFloat(document.getElementById("fraisAchat").value) || 0;
          const travaux =
            parseFloat(document.getElementById("travaux").value) || 0;
          const dateAchat = new Date(
            document.getElementById("dateAchat").value
          );
          const dateVente = new Date(
            document.getElementById("dateVente").value
          );
          const typeBien = document.getElementById("typeBien").value;

          if (!prixVente || !prixAchat || !dateAchat || !dateVente) {
            alert("Veuillez remplir tous les champs obligatoires");
            return;
          }

          // Calcul de la dur√©e de d√©tention
          const dureeMs = dateVente - dateAchat;
          const dureeAnnes = dureeMs / (1000 * 60 * 60 * 24 * 365.25);
          const dureeAnneesEntier = Math.floor(dureeAnnes);

          // Prix de revient
          let prixRevient = prixAchat + fraisAchat + travaux;

          // Abattement forfaitaire de 15% si d√©tention > 5 ans (optionnel)
          if (dureeAnnes > 5) {
            const abattementForfait = prixAchat * 0.15;
            if (abattementForfait > travaux) {
              prixRevient = prixAchat + fraisAchat + abattementForfait;
            }
          }

          // Plus-value brute
          const plusValueBrute = prixVente - prixRevient;

          const typeBienLabel =
            typeBien === "principale"
              ? "R√©sidence principale"
              : typeBien === "secondaire"
              ? "R√©sidence secondaire"
              : typeBien === "investissement"
              ? "Investissement locatif"
              : "Terrain √† b√¢tir";

          const forfaitTravauxApplique =
            dureeAnnes > 5 && prixAchat * 0.15 > travaux;

          if (plusValueBrute <= 0) {
            window.plusValueData = {
              prixVente,
              prixAchat,
              fraisAchat,
              travaux,
              dateAchat,
              dateVente,
              typeBien,
              dureeDetention: dureeAnnes,
              prixRevient: prixRevient,
              plusValueBrute,
              abattementIR: 0,
              abattementPS: 0,
              plusValueIR: 0,
              plusValuePS: 0,
              impotIR: 0,
              impotPS: 0,
              surtaxe: 0,
              impotTotal: 0,
              plusValueNette: plusValueBrute,
            };

            document.getElementById("results").innerHTML = `
            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-blue-900 mb-4">‚úÖ Aucun imp√¥t √† payer</h3>
              <p class="text-gray-700">Vous n'avez pas de plus-value imposable. La vente g√©n√®re une moins-value de <strong>${Math.abs(
                plusValueBrute
              ).toLocaleString("fr-FR")} ‚Ç¨</strong>.</p>
              <div class="mt-4 bg-white border border-blue-200 rounded-lg p-4">
                <h4 class="font-semibold text-gray-900 mb-2">Pourquoi 0 ‚Ç¨ ?</h4>
                <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                  <li>Le prix de vente est inf√©rieur (ou proche) du prix de revient (achat + frais + travaux retenus).</li>
                  <li>Une moins-value n‚Äôest pas imposable au titre de la plus-value immobili√®re.</li>
                  <li>V√©rifiez que les frais/travaux saisis correspondent bien √† des montants d√©ductibles.</li>
                </ul>
              </div>
            </div>
          `;
            document.getElementById("results").classList.remove("invisible");
            return;
          }

          if (typeBien === "principale") {
            window.plusValueData = {
              prixVente,
              prixAchat,
              fraisAchat,
              travaux,
              dateAchat,
              dateVente,
              typeBien,
              dureeDetention: dureeAnnes,
              prixRevient: prixRevient,
              plusValueBrute,
              abattementIR: 100,
              abattementPS: 100,
              plusValueIR: 0,
              plusValuePS: 0,
              impotIR: 0,
              impotPS: 0,
              surtaxe: 0,
              impotTotal: 0,
              plusValueNette: plusValueBrute,
            };

            document.getElementById("results").innerHTML = `
            <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-green-900 mb-4">‚úÖ Exon√©ration r√©sidence principale</h3>
              <p class="text-gray-700">La plus-value sur la vente de votre r√©sidence principale est exon√©r√©e d'imp√¥t (IR et pr√©l√®vements sociaux). Aucune imposition n'est due.</p>
              <div class="mt-4 bg-white border border-green-200 rounded-lg p-4">
                <h4 class="font-semibold text-gray-900 mb-2">Pourquoi 0 ‚Ç¨ ?</h4>
                <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                  <li>La cession de la r√©sidence principale est exon√©r√©e (sous conditions).</li>
                  <li>Les autres biens (secondaire/locatif/terrain) restent en principe imposables.</li>
                  <li>En cas de doute (occupation, d√©pendances, d√©lais), v√©rifiez la doctrine officielle.</li>
                </ul>
              </div>
            </div>
            `;
            document.getElementById("results").classList.remove("invisible");
            return;
          }

          // Calcul des abattements selon la dur√©e
          let abattementIR = 0; // Imp√¥t sur le revenu
          let abattementPS = 0; // Pr√©l√®vements sociaux

          if (dureeAnnes >= 22) {
            abattementIR = 100; // Exon√©ration totale
          } else if (dureeAnnes >= 6) {
            abattementIR = (dureeAnneesEntier - 5) * 6;
          }

          if (dureeAnneesEntier >= 30) {
            abattementPS = 100;
          } else if (dureeAnneesEntier >= 23) {
            abattementPS = 28 + (dureeAnneesEntier - 22) * 9;
          } else if (dureeAnneesEntier === 22) {
            abattementPS = 28;
          } else if (dureeAnneesEntier >= 6) {
            abattementPS = (dureeAnneesEntier - 5) * 1.65;
          }

          // Application des abattements
          const plusValueIR = plusValueBrute * (1 - abattementIR / 100);
          const plusValuePS = plusValueBrute * (1 - abattementPS / 100);

          // Calcul de l'imp√¥t
          const tauxIR = 0.19; // 19%
          const tauxPS = 0.172; // 17,2%

          let impotIR = plusValueIR * tauxIR;
          const impotPS = plusValuePS * tauxPS;

          // Surtaxe si plus-value IR > 50 000‚Ç¨
          let surtaxe = 0;
          if (plusValueIR > 50000) {
            const tranche = plusValueIR - 50000;
            if (tranche <= 10000) surtaxe = tranche * 0.02;
            else if (tranche <= 20000) surtaxe = 200 + (tranche - 10000) * 0.03;
            else if (tranche <= 30000) surtaxe = 500 + (tranche - 20000) * 0.04;
            else if (tranche <= 40000) surtaxe = 900 + (tranche - 30000) * 0.05;
            else surtaxe = 1400 + (tranche - 40000) * 0.06;
          }

          const impotTotal = impotIR + surtaxe + impotPS;
          const plusValueNette = plusValueBrute - impotTotal;

          function formatCurrency(amount) {
            return new Intl.NumberFormat("fr-FR", {
              style: "currency",
              currency: "EUR",
            }).format(amount);
          }

          if (dureeAnneesEntier >= 30) {
            window.plusValueData = {
              prixVente,
              prixAchat,
              fraisAchat,
              travaux,
              dateAchat,
              dateVente,
              typeBien,
              dureeDetention: dureeAnnes,
              prixRevient: prixRevient,
              plusValueBrute,
              abattementIR,
              abattementPS,
              plusValueIR,
              plusValuePS,
              impotIR: 0,
              impotPS: 0,
              surtaxe: 0,
              impotTotal: 0,
              plusValueNette: plusValueBrute,
            };

            document.getElementById("results").innerHTML = `
              <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
                <h3 class="text-xl font-bold text-green-900 mb-4">‚úÖ Exon√©ration li√©e √† la dur√©e de d√©tention</h3>
                <p class="text-gray-700">
                  Apr√®s <strong>30 ans</strong> de d√©tention, la plus-value est exon√©r√©e de pr√©l√®vements sociaux, et l'IR l‚Äôest d√©j√† apr√®s 22 ans. Aucune imposition n'est due.
                </p>
                <div class="mt-4 bg-white border border-green-200 rounded-lg p-4">
                  <h4 class="font-semibold text-gray-900 mb-2">D√©tail</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                    <div><span class="text-gray-600">Plus-value brute :</span> <strong>${formatCurrency(plusValueBrute)}</strong></div>
                    <div><span class="text-gray-600">Dur√©e :</span> <strong>${dureeAnneesEntier} ans</strong></div>
                    <div><span class="text-gray-600">Abattement IR :</span> <strong>${abattementIR.toFixed(1)}%</strong></div>
                    <div><span class="text-gray-600">Abattement PS :</span> <strong>${abattementPS.toFixed(1)}%</strong></div>
                  </div>
                </div>
              </div>
            `;
            document.getElementById("results").classList.remove("invisible");
            document.getElementById("plusvalue-add-to-compare")?.classList.remove("hidden");
            return;
          }

          // Cr√©er un ID unique pour les graphiques
          const chartTimestamp = Date.now() + Math.random();
          
          const results = `
          <div class="space-y-6">
            <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
              <h3 class="text-xl font-bold text-gray-900 mb-4">üéØ R√©sultat principal</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                  <p class="text-sm text-gray-600">Total des imp√¥ts</p>
                  <p class="text-2xl font-bold text-red-700">${formatCurrency(impotTotal)}</p>
                </div>
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                  <p class="text-sm text-gray-600">Plus-value nette</p>
                  <p class="text-2xl font-bold text-purple-700">${formatCurrency(plusValueNette)}</p>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <p class="text-sm text-gray-600">Taux effectif</p>
                  <p class="text-2xl font-bold text-blue-700">${(
                    (impotTotal / plusValueBrute) *
                    100
                  ).toFixed(1)}%</p>
                </div>
              </div>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-blue-900 mb-3">üß† Logique de calcul (simplifi√©e)</h3>
              <ul class="text-sm text-gray-700 list-disc list-inside space-y-1">
                <li>Plus-value brute = Prix de vente ‚àí (Prix d‚Äôachat + frais + travaux retenus)</li>
                <li>Plus-value taxable IR = Plus-value brute √ó (1 ‚àí abattement IR)</li>
                <li>Plus-value taxable PS = Plus-value brute √ó (1 ‚àí abattement PS)</li>
                <li>Imp√¥t = (IR 19 % + pr√©l√®vements sociaux 17,2 % + surtaxe √©ventuelle) appliqu√©s aux bases taxables</li>
              </ul>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-blue-900 mb-4">üìä D√©tail chiffr√© (√©tape par √©tape)</h3>
              <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-200 rounded-lg text-sm">
                  <tbody>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Prix de vente</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(prixVente)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Prix d'achat</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(prixAchat)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Frais d'acquisition</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(fraisAchat)}</td></tr>
                    <tr class="border-b">
                      <td class="px-4 py-3 text-gray-600">Travaux retenus</td>
                      <td class="px-4 py-3 font-semibold text-gray-900 text-right">
                        ${formatCurrency(forfaitTravauxApplique ? prixAchat * 0.15 : travaux)}
                        ${forfaitTravauxApplique ? '<span class="text-xs text-gray-500">(forfait 15% &gt; travaux saisis)</span>' : ''}
                      </td>
                    </tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Prix de revient</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(prixRevient)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Plus-value brute</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(plusValueBrute)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Dur√©e de d√©tention</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${dureeAnneesEntier} ans ${Math.round((dureeAnnes - dureeAnneesEntier) * 12)} mois</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Abattement IR</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${abattementIR.toFixed(1)}%</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Abattement PS</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${abattementPS.toFixed(1)}%</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Base taxable IR</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(plusValueIR)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Base taxable PS</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(plusValuePS)}</td></tr>
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Imp√¥t sur le revenu (19%)</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(impotIR)}</td></tr>
                    ${surtaxe > 0 ? `<tr class="border-b"><td class="px-4 py-3 text-gray-600">Surtaxe</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(surtaxe)}</td></tr>` : ''}
                    <tr class="border-b"><td class="px-4 py-3 text-gray-600">Pr√©l√®vements sociaux (17,2%)</td><td class="px-4 py-3 font-semibold text-gray-900 text-right">${formatCurrency(impotPS)}</td></tr>
                    <tr class="bg-gray-50"><td class="px-4 py-3 font-bold text-gray-900">Total imp√¥ts</td><td class="px-4 py-3 font-bold text-red-700 text-right">${formatCurrency(impotTotal)}</td></tr>
                    <tr class="bg-gray-50"><td class="px-4 py-3 font-bold text-gray-900">Plus-value nette</td><td class="px-4 py-3 font-bold text-purple-700 text-right">${formatCurrency(plusValueNette)}</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <p class="text-sm text-gray-600">Dur√©e de d√©tention</p>
                  <p class="text-lg font-semibold text-gray-900">${dureeAnneesEntier} ans ${Math.round(
            (dureeAnnes - dureeAnneesEntier) * 12
          )} mois</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Prix de revient</p>
                  <p class="text-lg font-semibold text-gray-900">${formatCurrency(
                    prixRevient
                  )}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Plus-value brute</p>
                  <p class="text-lg font-semibold text-gray-900">${formatCurrency(
                    plusValueBrute
                  )}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Type de bien</p>
                  <p class="text-lg font-semibold text-gray-900">${typeBienLabel}</p>
                </div>
              </div>
            </div>

            <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-green-900 mb-4">üí∞ Abattements appliqu√©s</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600">Abattement imp√¥t sur le revenu :</span>
                  <span class="font-semibold text-green-700">${abattementIR.toFixed(
                    1
                  )}%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Abattement pr√©l√®vements sociaux :</span>
                  <span class="font-semibold text-green-700">${abattementPS.toFixed(
                    1
                  )}%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Plus-value taxable (IR) :</span>
                  <span class="font-semibold">${formatCurrency(
                    plusValueIR
                  )}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Plus-value taxable (PS) :</span>
                  <span class="font-semibold">${formatCurrency(
                    plusValuePS
                  )}</span>
                </div>
              </div>
            </div>

            <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-red-900 mb-4">üí∏ Imp√¥ts √† payer</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-600">Imp√¥t sur le revenu (19%) :</span>
                  <span class="font-semibold">${formatCurrency(impotIR)}</span>
                </div>
                ${
                  surtaxe > 0
                    ? `
                <div class="flex justify-between">
                  <span class="text-gray-600">Surtaxe (plus-value &gt; 50k‚Ç¨) :</span>
                  <span class="font-semibold">${formatCurrency(surtaxe)}</span>
                </div>
                `
                    : ""
                }
                <div class="flex justify-between">
                  <span class="text-gray-600">Pr√©l√®vements sociaux (17,2%) :</span>
                  <span class="font-semibold">${formatCurrency(impotPS)}</span>
                </div>
                <div class="border-t pt-2 flex justify-between text-lg">
                  <span class="font-bold text-gray-900">Total des imp√¥ts :</span>
                  <span class="font-bold text-red-700">${formatCurrency(
                    impotTotal
                  )}</span>
                </div>
              </div>
            </div>

            <div class="bg-purple-50 border-l-4 border-purple-500 p-6 rounded-r-lg">
              <h3 class="text-xl font-bold text-purple-900 mb-4">üéØ R√©sultat final</h3>
              <div class="space-y-3">
                <div class="flex justify-between text-lg">
                  <span class="font-bold text-gray-900">Plus-value nette (apr√®s imp√¥ts) :</span>
                  <span class="font-bold text-purple-700">${formatCurrency(
                    plusValueNette
                  )}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Taux d'imposition effectif :</span>
                  <span class="font-semibold">${(
                    (impotTotal / plusValueBrute) *
                    100
                  ).toFixed(1)}%</span>
                </div>
              </div>
            </div>

            <div class="text-sm text-gray-500 bg-gray-50 p-4 rounded">
              <p><strong>üí° Bon √† savoir :</strong></p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li>Exon√©ration totale apr√®s 30 ans de d√©tention</li>
                <li>La r√©sidence principale est toujours exon√©r√©e</li>
                <li>Possibilit√© d'abattement forfaitaire de 15% si d√©tention > 5 ans</li>
                <li>Ces calculs sont indicatifs, consultez un fiscaliste</li>
              </ul>
            </div>

            <!-- Graphiques (affich√©s seulement s'il y a des imp√¥ts) -->
            ${impotTotal && impotTotal > 0 ? `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
              <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-900 mb-4">üìä Ventilation des imp√¥ts</h3>
                <div style="position: relative; height: 300px; width: 100%;">
                  <canvas id="chart-impots-${chartTimestamp}"></canvas>
                </div>
              </div>
              <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-900 mb-4">üìà Abattements selon dur√©e</h3>
                <div style="position: relative; height: 300px; width: 100%;">
                  <canvas id="chart-abattements-${chartTimestamp}"></canvas>
                </div>
              </div>
            </div>
            ` : ''}
          </div>
        `;

          window.plusValueData = {
            prixVente,
            prixAchat,
            fraisAchat,
            travaux,
            dateAchat,
            dateVente,
            typeBien,
            dureeDetention: dureeAnnes,
            prixRevient: prixRevient,
            plusValueBrute,
            abattementIR,
            abattementPS,
            plusValueIR,
            plusValuePS,
            impotIR,
            impotPS,
            surtaxe,
            impotTotal,
            plusValueNette
          };

          document.getElementById("results").innerHTML = results;
          document.getElementById("results").classList.remove("invisible");
          
          // Ne pas masquer le bouton "Ajouter √† la comparaison" - on peut ajouter plusieurs fois
          document.getElementById("plusvalue-add-to-compare")?.classList.remove("hidden");
          
          // G√©n√©rer les graphiques apr√®s un court d√©lai pour que les canvas soient dans le DOM
          // Uniquement si ce ne sont pas des cas d'exon√©ration (r√©sidence principale ou moins-value)
          if (impotTotal && impotTotal > 0) {
            setTimeout(async () => {
              const Chart = await __lcLoadChart();
              // Trouver les canvas g√©n√©r√©s avec les IDs sp√©cifiques
              const chartImpotsId = `chart-impots-${chartTimestamp}`;
              const chartAbattementsId = `chart-abattements-${chartTimestamp}`;
              
              const chartImpotsCanvas = document.getElementById(chartImpotsId);
              const chartAbattementsCanvas = document.getElementById(chartAbattementsId);

              // Graphique 1: Ventilation des imp√¥ts
              if (chartImpotsCanvas) {
                const ctxImpots = chartImpotsCanvas.getContext('2d');
                if (ctxImpots) {
                  new Chart(ctxImpots, {
                    type: 'doughnut',
                    data: {
                      labels: ['Imp√¥t sur revenu', 'Surtaxe', 'Pr√©l√®vements sociaux'],
                      datasets: [{
                        data: [impotIR, surtaxe, impotPS],
                        backgroundColor: ['#ef4444', '#f59e0b', '#8b5cf6'],
                        borderColor: '#fff',
                        borderWidth: 2
                      }]
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                          callbacks: {
                            label: function(context) {
                              const amount = context.parsed;
                              return formatCurrency(amount) + ' (' + ((amount / impotTotal) * 100).toFixed(1) + '%)';
                            }
                          }
                        }
                      }
                    }
                  });
                }
              }

              // Graphique 2: √âvolution des abattements
              if (chartAbattementsCanvas) {
                const ctxAbattements = chartAbattementsCanvas.getContext('2d');
                if (ctxAbattements) {
                  const yearsData = [];
                  const abattementIRData = [];
                  const abattementPSData = [];

                  for (let year = 0; year <= 30; year++) {
                    yearsData.push(year);
                    
                    let irAbat = 0;
                    if (year >= 22) irAbat = 100;
                    else if (year >= 6) irAbat = (year - 5) * 6;
                    
                    let psAbat = 0;
                    if (year >= 30) psAbat = 100;
                    else if (year >= 23) psAbat = 28 + (year - 22) * 9;
                    else if (year === 22) psAbat = 28;
                    else if (year >= 6) psAbat = (year - 5) * 1.65;
                    
                    abattementIRData.push(irAbat);
                    abattementPSData.push(psAbat);
                  }

                  new Chart(ctxAbattements, {
                    type: 'line',
                    data: {
                      labels: yearsData,
                      datasets: [
                        {
                          label: 'Abattement IR',
                          data: abattementIRData,
                          borderColor: '#ef4444',
                          backgroundColor: 'rgba(239, 68, 68, 0.1)',
                          borderWidth: 2,
                          fill: true,
                          pointRadius: 2
                        },
                        {
                          label: 'Abattement PS',
                          data: abattementPSData,
                          borderColor: '#8b5cf6',
                          backgroundColor: 'rgba(139, 92, 246, 0.1)',
                          borderWidth: 2,
                          fill: true,
                          pointRadius: 2
                        }
                      ]
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                          callbacks: {
                            label: function(context) {
                              return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                            }
                          }
                        }
                      },
                      scales: {
                        y: {
                          beginAtZero: true,
                          max: 100,
                          ticks: { callback: function(v) { return v + '%'; } }
                        },
                        x: {
                          title: { display: true, text: 'Ann√©es de d√©tention' }
                        }
                      }
                    }
                  });
                }
              }
            }, 200);
          }

          document
            .getElementById("results")
            .scrollIntoView({ behavior: "smooth" });
        });

      // Initialiser les dates par d√©faut
      document.addEventListener("DOMContentLoaded", () => {
        const today = new Date();
        const fiveYearsAgo = new Date();
        fiveYearsAgo.setFullYear(today.getFullYear() - 5);

        document.getElementById("dateVente").value = today
          .toISOString()
          .split("T")[0];
        document.getElementById("dateAchat").value = fiveYearsAgo
          .toISOString()
          .split("T")[0];

        // Initialiser les dates du modal aussi
        document.getElementById("modal-dateVente").value = today
          .toISOString()
          .split("T")[0];
        document.getElementById("modal-dateAchat").value = fiveYearsAgo
          .toISOString()
          .split("T")[0];

        // Event listeners pour comparaison
        import("../components/PlusValueComparison.ts").then(({ PlusValueComparison }) => {
          // Initialiser le conteneur de comparaison
          PlusValueComparison.initialize("plusvalue-comparaison");

          const addBtn = document.getElementById("plusvalue-add-to-compare");
          const addOtherBtn = document.getElementById("plusvalue-add-other");
          const resetBtn = document.getElementById("plusvalue-reset-compare");
          const modal = document.getElementById("modal-add-bien");
          const modalForm = document.getElementById("modal-form");
          const modalClose = document.getElementById("modal-close");
          const modalCancel = document.getElementById("modal-cancel");

          // Ouvrir/fermer le modal
          function openModal() {
            modal.style.display = "flex";
          }

          function closeModal() {
            modal.style.display = "none";
            modalForm.reset();
          }

          // Fermer le modal en cliquant sur le X ou Annuler
          modalClose.addEventListener("click", closeModal);
          modalCancel.addEventListener("click", closeModal);

          // Fermer le modal en cliquant en dehors
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              closeModal();
            }
          });

          if (addBtn && resetBtn && addOtherBtn) {
            // Bouton Ajouter √† la comparaison (premier bien)
            addBtn.addEventListener("click", () => {
              if (window.plusValueData && window.plusValueData.impotTotal !== undefined) {
                PlusValueComparison.addComparison(window.plusValueData);
                
                // D√âSACTIVER le bouton Ajouter
                addBtn.disabled = true;
                addBtn.classList.add("opacity-50", "cursor-not-allowed");
                addBtn.classList.remove("hover:bg-blue-700");
                
                // AFFICHER le bouton Ajouter un autre bien
                addOtherBtn.classList.remove("hidden");
                
                // Afficher le bouton r√©initialiser et la section comparaison
                resetBtn.classList.remove("hidden");
                document.getElementById("plusvalue-comparaison").classList.remove("hidden");
                document.getElementById("plusvalue-comparaison").scrollIntoView({ behavior: "smooth" });
              } else {
                alert("Veuillez d'abord effectuer un calcul");
              }
            });

            // Bouton Ajouter un autre bien (ouvre le modal)
            addOtherBtn.addEventListener("click", () => {
              openModal();
            });

            // Bouton R√©initialiser
            resetBtn.addEventListener("click", () => {
              PlusValueComparison.clearAll();
              
              // R√©initialiser les boutons
              addBtn.disabled = false;
              addBtn.classList.remove("opacity-50", "cursor-not-allowed");
              addBtn.classList.add("hover:bg-blue-700");
              addOtherBtn.classList.add("hidden");
              resetBtn.classList.add("hidden");
              document.getElementById("plusvalue-comparaison").classList.add("hidden");
              
              // R√©initialiser le formulaire principal
              document.getElementById("plusvalue-form").reset();
              document.getElementById("results").classList.add("invisible");
              closeModal();
            });

            // Bouton calcul√©r et ajouter (dans le modal)
            modalForm.addEventListener("submit", function(e) {
              e.preventDefault();

              // R√©cup√©rer les valeurs du modal
              const prixVente = parseFloat(document.getElementById("modal-prixVente").value) || 0;
              const prixAchat = parseFloat(document.getElementById("modal-prixAchat").value) || 0;
              const fraisAchat = parseFloat(document.getElementById("modal-fraisAchat").value) || 0;
              const travaux = parseFloat(document.getElementById("modal-travaux").value) || 0;
              const dateAchat = new Date(document.getElementById("modal-dateAchat").value);
              const dateVente = new Date(document.getElementById("modal-dateVente").value);
              const typeBien = document.getElementById("modal-typeBien").value;

              if (!prixVente || !prixAchat || !dateAchat || !dateVente) {
                alert("Veuillez remplir tous les champs obligatoires");
                return;
              }

              // M√™me logique de calcul que le formulaire principal
              const dureeMs = dateVente - dateAchat;
              const dureeAnnes = dureeMs / (1000 * 60 * 60 * 24 * 365.25);

              let prixRevient = prixAchat + fraisAchat + travaux;
              if (dureeAnnes > 5) {
                const abattementForfait = prixAchat * 0.15;
                if (abattementForfait > travaux) {
                  prixRevient = prixAchat + fraisAchat + abattementForfait;
                }
              }

              const plusValueBrute = prixVente - prixRevient;

              if (plusValueBrute <= 0 || typeBien === "principale") {
                alert("Ce bien n'est pas taxable ou g√©n√®re une moins-value. Veuillez v√©rifier les donn√©es.");
                return;
              }

              // Calcul des abattements
              let abattementIR = 0;
              let abattementPS = 0;

              if (dureeAnnes >= 22) {
                abattementIR = 100;
              } else if (dureeAnnes >= 6) {
                abattementIR = (Math.floor(dureeAnnes) - 5) * 6;
              }

              if (dureeAnnes >= 30) {
                abattementPS = 100;
              } else if (dureeAnnes >= 23) {
                abattementPS = 28 + (Math.floor(dureeAnnes) - 22) * 9;
              } else if (Math.floor(dureeAnnes) === 22) {
                abattementPS = 28;
              } else if (dureeAnnes >= 6) {
                abattementPS = (Math.floor(dureeAnnes) - 5) * 1.65;
              }

              // Calcul des imp√¥ts
              const plusValueIR = Math.max(0, plusValueBrute * (1 - abattementIR / 100));
              const plusValuePS = Math.max(0, plusValueBrute * (1 - abattementPS / 100));
              const impotIR = plusValueIR * 0.19;
              const impotPS = plusValuePS * 0.172;

              let surtaxe = 0;
              if (plusValueBrute > 50000) {
                const tranche = Math.min(plusValueBrute - 50000, 350000);
                surtaxe += tranche * 0.02;
                if (plusValueBrute > 400000) {
                  const tranche2 = Math.min(plusValueBrute - 400000, 300000);
                  surtaxe += tranche2 * 0.03;
                }
                if (plusValueBrute > 700000) {
                  const tranche3 = Math.min(plusValueBrute - 700000, 200000);
                  surtaxe += tranche3 * 0.04;
                }
                if (plusValueBrute > 900000) {
                  const tranche4 = Math.min(plusValueBrute - 900000, 200000);
                  surtaxe += tranche4 * 0.05;
                }
                if (plusValueBrute > 1100000) {
                  surtaxe += (plusValueBrute - 1100000) * 0.06;
                }
              }

              const impotTotal = impotIR + impotPS + surtaxe;
              const plusValueNette = plusValueBrute - impotTotal;

              // Stocker les donn√©es
              const modalData = {
                prixVente,
                prixAchat,
                fraisAchat,
                travaux,
                dateAchat,
                dateVente,
                typeBien,
                dureeDetention: dureeAnnes,
                prixRevient,
                plusValueBrute,
                abattementIR,
                abattementPS,
                plusValueIR,
                plusValuePS,
                impotIR,
                impotPS,
                surtaxe,
                impotTotal,
                plusValueNette
              };

              // Ajouter √† la comparaison
              PlusValueComparison.addComparison(modalData);
              document.getElementById("plusvalue-comparaison").scrollIntoView({ behavior: "smooth" });

              // Fermer le modal et r√©initialiser
              closeModal();
            });
          }
        });
      });
    </script>
    
    <!-- Auto-initialisation des exports PDF/CSV (importe pdfExport.js automatiquement) -->
    <script type="module">
  const __lcLoadAutoExport = () => import("../utils/autoExportInit.js");
  if ("requestIdleCallback" in window) {
    window.requestIdleCallback(__lcLoadAutoExport, { timeout: 4000 });
  } else {
    window.setTimeout(__lcLoadAutoExport, 2000);
  }
</script>
  <div class="ymyl-officiel-btn" style="text-align:center;margin:20px 0;"><a class="btn-officiel" href="https://www.notaires.fr" target="_blank" rel="noopener" style="display:inline-block;background:#007bff;color:#fff;padding:12px 24px;border-radius:4px;text-decoration:none;font-weight:bold;">üëâ estimateur gratuit notaires.fr</a><p style="font-size:12px;color:#666;margin-top:8px;">Pour un calcul d√©finitif conforme aux bar√®mes en vigueur</p></div>

<!-- YMYL Verbalization Script -->
<script>(function() {
  'use strict';
  
  // Configuration par type
  const CONFIG = {
    APL: { source: 'CAF', url: 'https://www.caf.fr' },
    IMPOT: { source: 'impots.gouv.fr', url: 'https://www.impots.gouv.fr' },
    NOTAIRE: { source: 'notaires.fr', url: 'https://www.notaires.fr' },
    RSA: { source: 'CAF', url: 'https://www.caf.fr' },
    PRIME: { source: 'CAF', url: 'https://www.caf.fr' },
    IK: { source: 'impots.gouv.fr', url: 'https://www.impots.gouv.fr' },
    SALAIRE: { source: '', url: 'https://www.impots.gouv.fr' },
    PRET: { source: 'banque', url: '#' },
    TAXE: { source: 'impots.gouv.fr', url: 'https://www.impots.gouv.fr' },
    PLUSVALUE: { source: 'notaire', url: 'https://www.notaires.fr' }
  };
  
  // Detecter le type de simulateur
  function detectType() {
    const path = window.location.pathname.toLowerCase();
    if (path.includes('apl')) return 'APL';
    if (path.includes('impot')) return 'IMPOT';
    if (path.includes('notaire')) return 'NOTAIRE';
    if (path.includes('rsa')) return 'RSA';
    if (path.includes('prime')) return 'PRIME';
    if (path.includes('ik') || path.includes('kilometrique')) return 'IK';
    if (path.includes('salaire')) return 'SALAIRE';
    if (path.includes('pret')) return 'PRET';
    if (path.includes('taxe')) return 'TAXE';
    if (path.includes('plus-value')) return 'PLUSVALUE';
    return 'GENERIC';
  }
  
  // Verbaliser un montant
  function verbalize(value) {
    const num = parseInt(value);
    if (isNaN(num) || num< 10) return value;
    const rounded = Math.round(num / 10) * 10;
    return 'environ ' + rounded + ' ‚Ç¨';
  }
  
  // Traiter un element
  function processElement(el, type) {
    const text = el.textContent || el.innerText || '';
    const match = text.match(/(d[ds]{2,5})s*‚Ç¨/);
    if (!match) return;
    
    const exactVal = match[1].replace(/s/g, '');
    const verbalVal = verbalize(exactVal);
    const config = CONFIG[type] || CONFIG.GENERIC;
    
    // Remplacer contenu
    el.innerHTML = '<span class="ymyl-verbal" style="color:inherit;">' + verbalVal + '</span>' +
                   '<span class="ymyl-exact" style="display:none;">' + exactVal + ' ‚Ç¨</span>' +
                   '<small style="display:block;color:#666;font-size:0.8em;margin-top:2px;">valeur indicative ‚Äì voir ' + config.source + ' pour montant estim√©</small>';
  }
  
  // Observer les changements DOM
  const observer = new MutationObserver(function(mutations) {
    const type = detectType();
    mutations.forEach(function(mutation) {
      mutation.addedNodes.forEach(function(node) {
        if (node.nodeType === 1) { // Element
          // Chercher dans les resultats
          const results = node.querySelectorAll ? 
            node.querySelectorAll('.result, .montant, [class*="result"], [class*="montant"], output, .calculator-result, #calculator-result') : [];
          results.forEach(function(el) {
            if (el.textContent.includes('‚Ç¨')) {
              processElement(el, type);
            }
          });
        }
      });
    });
  });
  
  // Demarrer observation
  document.addEventListener('DOMContentLoaded', function() {
    const type = detectType();
    
    // Traiter elements existants
    document.querySelectorAll('.result, .montant, [class*="result"], [class*="montant"], output, .calculator-result, #calculator-result, strong, span').forEach(function(el) {
      if (el.textContent.match(/d{3,6}s*‚Ç¨/)) {
        processElement(el, type);
      }
    });
    
    // Observer nouveaux elements
    observer.observe(document.body, { childList: true, subtree: true });
  });
})();
</script>

</body>
</html>



