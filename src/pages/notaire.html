<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Frais de Notaire 2025 ‚Äî Calcul imm√©diat (gratuit + comparatif)</title>
    <meta
      name="description"
      content="Comparez les frais de notaire entre plusieurs villes en 10 secondes. Bar√®me officiel 2025, simulateur gratuit, graphe interactif et export."
    />
    <meta
      name="keywords"
      content="frais notaire 2025, calculateur frais notaire gratuit, comparaison frais notaire d√©partements, bar√®mes notaire officiels, √©moluments notaire, droits enregistrement, simulation achat immobilier, co√ªt notaire maison appartement, taux notaire france, calcul frais acte, estimation frais notaire d√©partement, comparateur frais notaire villes, graphique frais notaire, export csv frais notaire"
    />
    <meta name="google-adsense-account" content="ca-pub-2209781252231399" />

    <!-- SEO & Social -->
    <link rel="canonical" href="https://www.lescalculateurs.fr/notaire" />
    <meta
      property="og:url"
      content="https://lescalculateurs.fr/pages/notaire.html"
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Frais de Notaire 2025 ‚Äî Calcul imm√©diat (gratuit + comparatif)"
    />
    <meta
      property="og:description"
      content="Comparez les frais de notaire entre plusieurs villes en 10 secondes. Bar√®me officiel 2025, simulateur gratuit, graphe interactif et export."
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="üè† Frais de Notaire 2025 - √âconomisez !"
    />
    <meta
      name="twitter:description"
      content="√âconomisez des milliers d'euros sur vos frais de notaire 2025"
    />

    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../assets/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../assets/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../assets/favicon-16x16.png"
    />
    <link rel="manifest" href="../assets/site.webmanifest" />
    <link rel="shortcut icon" href="../assets/favicon.ico" />

    <!-- Google AdSense -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2209781252231399"
      crossorigin="anonymous"
    ></script>

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-TPFZCGX5");
    </script>
    <!-- End Google Tag Manager -->

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-2HNTGCYQ1X"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-2HNTGCYQ1X");
    </script>

    <!-- Open Graph -->
    

    <!-- Schema.org -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Calculateur Frais de Notaire 2025",
        "description": "Outil de calcul des frais de notaire selon les bar√®mes officiels 2025",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Web Browser"
      }
    </script>
  </head>
  <body class="bg-gray-50">
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-TPFZCGX5"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
          <!-- Logo & Navigation -->
          <div class="flex items-center space-x-6">
            <img
              src="../assets/logo.svg"
              alt="LesCalculateurs.fr"
              class="w-6 h-6"
            />
            <a
              href="../index.html"
              class="flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium transition-colors"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10 19l-7-7m0 0l7-7m-7 7h18"
                ></path>
              </svg>
              <span>‚Üê Accueil</span>
            </a>
            <div class="hidden sm:block">
              <span class="text-gray-400">|</span>
            </div>
            <div class="hidden sm:flex items-center space-x-2">
              <div class="bg-blue-100 text-blue-700 rounded-lg p-1.5">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm5 6a1 1 0 011-1h1a1 1 0 110 2h-1a1 1 0 01-1-1z"
                  ></path>
                </svg>
              </div>
              <span class="text-sm font-medium text-gray-700"
                >Frais de Notaire</span
              >
            </div>
          </div>

          <!-- Title & Status -->
          <div class="flex items-center space-x-3">
            <h1 class="text-xl sm:text-2xl font-bold text-gray-900">
              üßæ Frais de Notaire 2025
            </h1>
            <span
              class="hidden sm:inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"
            >
              ‚úì Officiel
            </span>
          </div>

          <!-- Actions -->
          <div class="flex items-center space-x-2">
            <div class="hidden md:block">
              <span class="text-xs text-gray-500">Bar√®mes 2025</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Intro SEO -->
      <section class="mb-8">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl font-bold text-gray-900 mb-6">
            Calculateur de frais de notaire 2025 ‚Äî bar√®mes officiels
          </h2>
          <div class="prose prose-lg text-gray-600 space-y-3">
            <p>
              Calculez vos frais de notaire avec exactitude gr√¢ce aux bar√®mes
              officiels (√©moluments proportionnels, droits d'enregistrement,
              TVA, formalit√©s et CSI). L'ancien se situe en g√©n√©ral autour de
              7‚Äì8% et le neuf autour de 2‚Äì3% du prix d'achat.
            </p>
            <p>
              Pour obtenir une estimation utile, indiquez votre prix d'achat,
              le type de bien (ancien, neuf, terrain) et votre d√©partement.
              Nous appliquons automatiquement la grille officielle par tranches
              (3,870% / 1,596% / 1,064% / 0,799%), la TVA (20%), la CSI (0,10%
              min. 15‚Ç¨) et les droits selon votre d√©partement.
            </p>
            <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
              <p class="m-0 text-sm">
                Source officielle :
                <a class="text-blue-700 underline" href="https://www.service-public.gouv.fr/particuliers/vosdroits/F17701" rel="nofollow noopener" target="_blank">
                  Service Public ‚Äî Frais de notaire (F17701)
                </a>
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Section Fonctionnalit√© Comparaison - SEO -->
      <section
        class="mb-8 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 border-2 border-blue-200"
      >
        <div class="max-w-4xl mx-auto">
          <div class="flex items-center gap-3 mb-4">
            <span class="text-4xl">üìä</span>
            <h2 class="text-2xl font-bold text-gray-900">
              Comparez les frais de notaire entre plusieurs villes
            </h2>
          </div>
          <div class="prose prose-lg text-gray-700 mb-4">
            <p class="mb-3">
              <strong>√âconomisez jusqu'√† 3 500‚Ç¨</strong> en comparant les frais
              de notaire entre diff√©rents d√©partements ! Notre outil exclusif de
              <strong>comparaison multi-villes</strong> vous permet de
              visualiser instantan√©ment les diff√©rences de co√ªts selon la
              localisation de votre bien immobilier.
            </p>
            <p class="mb-3">
              Les droits d'enregistrement varient de
              <strong>4.5% en Corse √† 5.9% en √éle-de-France</strong>, ce qui
              repr√©sente des √©carts significatifs sur le montant total de vos
              frais de notaire. Par exemple, pour un achat de 250 000‚Ç¨, la
              diff√©rence peut atteindre plusieurs milliers d'euros entre Paris
              (18 283‚Ç¨) et la Gironde (17 943‚Ç¨).
            </p>
          </div>

          <div class="grid md:grid-cols-3 gap-4">
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">üó∫Ô∏è</div>
              <h3 class="font-bold text-gray-900 mb-1">
                Comparaison interactive
              </h3>
              <p class="text-sm text-gray-600">
                Comparez jusqu'√† 4 villes simultan√©ment avec un graphique visuel
                color√©
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">üí∞</div>
              <h3 class="font-bold text-gray-900 mb-1">√âconomies calcul√©es</h3>
              <p class="text-sm text-gray-600">
                Visualisez instantan√©ment les √©conomies possibles entre
                d√©partements
              </p>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <div class="text-3xl mb-2">üì•</div>
              <h3 class="font-bold text-gray-900 mb-1">
                Exportation CSV / XLSX
              </h3>
              <p class="text-sm text-gray-600">
                Exportez vos donn√©es en CSV (Google¬†Sheets) ou XLSX (Excel).
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Calculateur -->
      <div id="notaire-calculator"></div>

      <!-- Tableau de comparaison (masqu√© par d√©faut) -->
      <div id="comparaison-container" class="hidden"></div>

      <!-- Modale de s√©lection de ville pour comparaison -->
      <div
        id="modal-selection-ville"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        style="display: none"
      >
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
          <h3 class="text-xl font-bold text-gray-900 mb-4">
            Choisir une ville √† comparer
          </h3>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              D√©partement √† comparer *
            </label>
            <select
              id="modal-departement"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            >
              <option value="">-- S√©lectionnez un d√©partement --</option>
            </select>
          </div>

          <div class="flex gap-3">
            <button
              onclick="window.annulerSelectionVille()"
              class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50"
            >
              Annuler
            </button>
            <button
              onclick="window.confirmerSelectionVille()"
              class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
            >
              Comparer
            </button>
          </div>
        </div>
      </div>

      <!-- FAQ -->
      <section class="max-w-4xl mx-auto mt-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          ‚ùì Questions fr√©quentes sur les frais de notaire
        </h2>

        <div class="space-y-4" itemscope itemtype="https://schema.org/FAQPage">
          <div
            class="bg-white rounded-lg p-6 shadow-sm"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
              itemprop="name"
            >
              Quelle est la diff√©rence entre frais de notaire ancien et neuf ?
            </h3>
            <div
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer"
            >
              <p class="text-gray-600" itemprop="text">
                Pour l'ancien, les frais incluent les droits de mutation
                (environ 5,8% du prix) plus les √©moluments. Pour le neuf, seuls
                la TVA (20%) et les √©moluments s'appliquent, soit des frais
                totaux bien moindres.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
              itemprop="name"
            >
              Les frais de notaire sont-ils n√©gociables ?
            </h3>
            <div
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer"
            >
              <p class="text-gray-600" itemprop="text">
                Les √©moluments du notaire sont fix√©s par d√©cret et non
                n√©gociables. Seuls les honoraires pour prestations
                compl√©mentaires (conseil, n√©gociation) peuvent faire l'objet
                d'une discussion.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
              itemprop="name"
            >
              Quand payer les frais de notaire ?
            </h3>
            <div
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer"
            >
              <p class="text-gray-600" itemprop="text">
                Les frais de notaire sont pay√©s le jour de la signature de
                l'acte authentique chez le notaire, en m√™me temps que le solde
                du prix d'achat.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
              itemprop="name"
            >
              Peut-on financer les frais de notaire ?
            </h3>
            <div
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer"
            >
              <p class="text-gray-600" itemprop="text">
                Oui, certaines banques acceptent de financer les frais de
                notaire dans le pr√™t immobilier, mais cela augmente le montant
                emprunt√© et donc les int√©r√™ts pay√©s.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
              itemprop="name"
            >
              Que comprennent exactement les frais de notaire ?
            </h3>
            <div
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer"
            >
              <p class="text-gray-600" itemprop="text">
                Les frais incluent les √©moluments du notaire, les droits
                d'enregistrement, la TVA, les frais de formalit√©s (hypoth√®que,
                cadastre) et les d√©bours (frais avanc√©s par le notaire).
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm border-2 border-blue-200"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
              itemprop="name"
            >
              üìä Comment comparer les frais de notaire entre plusieurs villes ?
            </h3>
            <div
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer"
            >
              <p class="text-gray-600" itemprop="text">
                Notre calculateur permet de comparer jusqu'√† 4 villes
                simultan√©ment. Apr√®s votre premier calcul, cliquez sur "Comparer
                avec une autre ville", s√©lectionnez un d√©partement, et
                visualisez les diff√©rences sur un graphique interactif. Les
                frais varient selon les taux d√©partementaux (4.5% √† 5.9%) et les
                frais de formalit√©s locaux. Vous pouvez √©conomiser jusqu'√† 3
                500‚Ç¨ en choisissant strat√©giquement la localisation.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm border-2 border-blue-200"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
              itemprop="name"
            >
              üí∞ Quelles sont les diff√©rences de frais de notaire entre
              d√©partements ?
            </h3>
            <div
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer"
            >
              <p class="text-gray-600" itemprop="text">
                Les droits d'enregistrement varient de 4.5% en Corse (2A, 2B) √†
                5.9% en √éle-de-France (75, 92, 93, 94, 78, 91, 95), soit 5.8%
                dans la majorit√© des d√©partements. Pour un achat de 250 000‚Ç¨,
                cela repr√©sente une diff√©rence de 250‚Ç¨ √† 3 500‚Ç¨ selon les
                d√©partements. Les frais de cadastre, conservation et formalit√©s
                varient √©galement de 118‚Ç¨ √† 220‚Ç¨ selon les pratiques locales.
              </p>
            </div>
          </div>

          <div
            class="bg-white rounded-lg p-6 shadow-sm border-2 border-blue-200"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
              itemprop="name"
            >
              üì• Puis-je exporter ma comparaison de frais de notaire ?
            </h3>
            <div
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer"
            >
              <p class="text-gray-600" itemprop="text">
                Oui ! Apr√®s avoir effectu√© vos calculs et comparaisons, cliquez
                sur "Exporter en CSV" pour t√©l√©charger un fichier Excel avec
                tous les d√©tails : √©moluments, droits d'enregistrement, frais
                divers, TVA et totaux pour chaque ville compar√©e. Id√©al pour
                partager avec votre conseiller bancaire ou comparer diff√©rents
                sc√©narios d'achat immobilier.
              </p>
            </div>
          </div>

          <div
            class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 shadow-sm border-2 border-blue-300"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question"
          >
            <h3
              class="text-lg font-semibold text-gray-800 mb-3"
              itemprop="name"
            >
              üí° Comment utiliser la comparaison de frais de notaire ?
            </h3>
            <div
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer"
            >
              <div class="text-gray-700" itemprop="text">
                <p class="mb-3">
                  Notre outil de comparaison vous permet de visualiser les
                  diff√©rences de frais entre plusieurs villes. Suivez ces √©tapes
                  simples :
                </p>
                <ol class="text-sm space-y-2 list-decimal list-inside mb-3">
                  <li>
                    <strong>Faites votre premier calcul</strong> pour votre
                    ville avec le formulaire ci-dessus
                  </li>
                  <li>
                    <strong
                      >Cliquez sur "üìä Comparer avec une autre ville"</strong
                    >
                    dans les r√©sultats
                  </li>
                  <li>
                    <strong>S√©lectionnez d'autres d√©partements</strong> dans la
                    liste d√©roulante
                  </li>
                  <li>
                    <strong>Consultez le graphique</strong> et le tableau
                    comparatif d√©taill√©
                  </li>
                  <li>
                    <strong
                      >Exportez vos donn√©es en CSV (Google¬†Sheets) ou XLSX
                      (Excel)</strong
                    >
                  </li>
                </ol>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
      <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
        <h3 class="text-xl font-bold text-gray-900 mb-3">üîó Voir aussi</h3>
        <div class="flex flex-wrap gap-3">
          <a
            href="/pages/pret.html"
            class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
            >Mensualit√© de pr√™t</a
          >
          <a
            href="/pages/plusvalue.html"
            class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
            >Plus‚Äëvalue immobili√®re</a
          >
          <a
            href="/pages/charges.html"
            class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
            >Charges de copropri√©t√©</a
          >
          <a
            href="/pages/taxe.html"
            class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
            >Taxe fonci√®re</a
          >
          <a
            href="/pages/ik.html"
            class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
            >Frais kilom√©triques</a
          >
          <a
            href="/pages/travail.html"
            class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
            >Temps de travail</a
          >
          <a
            href="/pages/blog/departements/frais-notaire-departements.html"
            class="inline-block bg-blue-600 text-white rounded px-4 py-2 text-sm font-semibold shadow hover:bg-blue-700"
            >Tous les d√©partements</a
          >
          <a
            href="/pages/blog.html"
            class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
            >Blog</a
          >
        </div>
      </div>
    </section>

    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
      <div class="mt-12 bg-gray-100 rounded-lg p-6">
        <h3 class="font-bold text-gray-900 mb-3">
          üìö Sources et r√©f√©rences officielles
        </h3>
        <ul class="text-sm text-gray-700 space-y-2">
          <li>
            ‚Ä¢ Frais de notaire (d√©finition et bar√®me):
            <a
              href="https://www.service-public.fr/particuliers/vosdroits/F17701"
              target="_blank"
              rel="noopener"
              class="text-blue-600 hover:underline"
              >service-public.fr</a
            >
          </li>
          <li>
            ‚Ä¢ Simulateur frais de notaire:
            <a
              href="https://www.service-public.fr/particuliers/vosdroits/R54267"
              target="_blank"
              rel="noopener"
              class="text-blue-600 hover:underline"
              >service-public.fr (simulateur)</a
            >
          </li>
          <li>
            ‚Ä¢ √âmoluments et pratiques notariales:
            <a
              href="https://www.notaires.fr"
              target="_blank"
              rel="noopener"
              class="text-blue-600 hover:underline"
              >Conseil sup√©rieur du notariat</a
            >
          </li>
        </ul>
      </div>
    </section>

    <footer class="bg-gray-800 text-white py-8 mt-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <p class="text-gray-300">
          ¬© 2025 Les Calculateurs - Frais de notaire selon bar√®me officiel
        </p>
      </div>
    </footer>

    <script type="module" src="../main.ts"></script>
    <script type="module">
      import { CalculatorFrame } from "../components/CalculatorFrame.ts";
      import { formatCurrency } from "../main.ts";
      import { baremes } from "../data/baremes.ts";
      import { calculerFraisNotaire } from "../utils/calculNotaire.ts";
      import departements from "../data/departements.json";
      const fraisCfg = await (await fetch("../data/frais2025.json")).json();
      function getDmtoTaux(code) {
        const c = String(code);
        if (fraisCfg.dmto_struct && fraisCfg.dmto_struct.ancien) {
          const map = fraisCfg.dmto_struct.ancien.par_departement || {};
          const def = Number(fraisCfg.dmto_struct.ancien.default || 0.058);
          return map[c] != null ? Number(map[c]) : def;
        }
        if (fraisCfg.dmto && fraisCfg.dmto[c] != null) {
          return Number(fraisCfg.dmto[c]) / 100;
        }
        return 0.058;
      }
      function getDeboursForm(code) {
        const c = String(code);
        const dep = fraisCfg.debours?.par_departement?.[c];
        if (dep) return { debours: Number(dep.cadastre||0)+Number(dep.conservation||0), formalites: Number(dep.formalites||0) };
        const m = Number(fraisCfg.debours?.moyenne || 550);
        return { debours: m, formalites: 0 };
      }
      const pct = (n) => {
        const p = n * 100; const t = Math.floor(p * 100) / 100; return `‚âà ${t.toFixed(2).replace('.', ',')}%`;
      };
      const pct = (n) => {
        const p = n * 100;
        const t = Math.floor(p * 100) / 100;
        return `‚âà ${t.toFixed(2).replace('.', ',')}%`;
      };

      // Configuration du calculateur frais de notaire
      const notaireConfig = {
        title: "Calculateur de frais de notaire 2025",
        description:
          "Calculez vos frais de notaire selon les bar√®mes officiels en vigueur.",
        fields: [
          {
            id: "type_bien",
            label: "Type de bien immobilier *",
            type: "select",
            required: true,
            options: [
              { value: "ancien", label: "Acquisition d'un bien ancien" },
              { value: "neuf", label: "Acquisition d'un bien neuf" },
              { value: "terrain", label: "Acquisition d'un terrain" },
            ],
          },
          {
            id: "departement",
            label: "D√©partement du bien *",
            type: "select",
            required: true,
            options: [
              { value: "75", label: `75 - Paris (${pct((fraisCfg.dmto["75"]||5.80)/100)})` },
              { value: "92", label: `92 - Hauts-de-Seine (${pct((fraisCfg.dmto["92"]||5.80)/100)})` },
              { value: "93", label: `93 - Seine-Saint-Denis (${pct((fraisCfg.dmto["93"]||5.80)/100)})` },
              { value: "94", label: `94 - Val-de-Marne (${pct((fraisCfg.dmto["94"]||5.80)/100)})` },
              { value: "78", label: `78 - Yvelines (${pct((fraisCfg.dmto["78"]||5.80)/100)})` },
              { value: "91", label: `91 - Essonne (${pct((fraisCfg.dmto["91"]||5.80)/100)})` },
              { value: "95", label: `95 - Val-d'Oise (${pct((fraisCfg.dmto["95"]||5.80)/100)})` },
              { value: "77", label: `77 - Seine-et-Marne (${pct((fraisCfg.dmto["77"]||5.80)/100)})` },
              { value: "13", label: `13 - Bouches-du-Rh√¥ne (${pct((fraisCfg.dmto["13"]||5.80)/100)})` },
              { value: "69", label: `69 - Rh√¥ne (${pct((fraisCfg.dmto["69"]||5.80)/100)})` },
              { value: "59", label: `59 - Nord (${pct((fraisCfg.dmto["59"]||5.80)/100)})` },
              { value: "06", label: `06 - Alpes-Maritimes (${pct((fraisCfg.dmto["06"]||5.80)/100)})` },
              { value: "31", label: `31 - Haute-Garonne (${pct((fraisCfg.dmto["31"]||5.80)/100)})` },
              { value: "33", label: `33 - Gironde (${pct((fraisCfg.dmto["33"]||5.80)/100)})` },
              { value: "44", label: `44 - Loire-Atlantique (${pct((fraisCfg.dmto["44"]||5.80)/100)})` },
              { value: "34", label: `34 - H√©rault (${pct((fraisCfg.dmto["34"]||5.80)/100)})` },
              { value: "67", label: `67 - Bas-Rhin (${pct((fraisCfg.dmto["67"]||3.80)/100)})` },
              { value: "35", label: `35 - Ille-et-Vilaine (${pct((fraisCfg.dmto["35"]||5.80)/100)})` },
              { value: "38", label: `38 - Is√®re (${pct((fraisCfg.dmto["38"]||5.80)/100)})` },
              { value: "83", label: `83 - Var (${pct((fraisCfg.dmto["83"]||5.80)/100)})` },
              { value: "62", label: `62 - Pas-de-Calais (${pct((fraisCfg.dmto["62"]||5.80)/100)})` },
              { value: "76", label: `76 - Seine-Maritime (${pct((fraisCfg.dmto["76"]||5.80)/100)})` },
              { value: "84", label: `84 - Vaucluse (${pct((fraisCfg.dmto["84"]||5.80)/100)})` },
              { value: "30", label: `30 - Gard (${pct((fraisCfg.dmto["30"]||5.80)/100)})` },
              { value: "17", label: `17 - Charente-Maritime (${pct((fraisCfg.dmto["17"]||5.80)/100)})` },
              { value: "2A", label: `2A - Corse-du-Sud (${pct((fraisCfg.dmto["2A"]||4.50)/100)})` },
              { value: "2B", label: `2B - Haute-Corse (${pct((fraisCfg.dmto["2B"]||4.50)/100)})` },
              { value: "autre", label: "Autre d√©partement" },
            ],
          },
          {
            id: "prix_achat",
            label: "Prix d'acquisition *",
            type: "number",
            required: true,
            placeholder: "250000",
            min: 1000,
            step: 1000,
            suffix: "‚Ç¨",
          },
          {
            id: "montant_mobilier",
            label: "Dont montant du mobilier (optionnel)",
            type: "number",
            placeholder: "0",
            min: 0,
            step: 500,
            suffix: "‚Ç¨",
          },
          {
            id: "type_emprunt",
            label: "Type d'emprunt",
            type: "select",
            options: [
              { value: "sans", label: "Sans emprunt" },
              {
                value: "sans_garantie",
                label: "Emprunt sans garantie hypoth√©caire",
              },
              {
                value: "avec_garantie",
                label: "Emprunt avec garantie hypoth√©caire",
              },
            ],
          },
          {
            id: "remise_notaire_var",
            label: "Appliquer remise notariale sur la partie variable (-10%)",
            type: "checkbox",
          },
          {
            id: "prets_aides",
            label: "Montant des pr√™ts PTZ, PEL, CEL et pr√™ts aid√©s (optionnel)",
            type: "number",
            placeholder: "0",
            min: 0,
            step: 1000,
            suffix: "‚Ç¨",
          },
          {
            id: "autres_prets",
            label: "Montant des autres pr√™ts (optionnel)",
            type: "number",
            placeholder: "0",
            min: 0,
            step: 1000,
            suffix: "‚Ç¨",
          },
        ],
        calculate: (values) => {
          try {
            const prixAchat = values.prix_achat || 0;
            const montantMobilier = values.montant_mobilier || 0;
            const typeBien = values.type_bien;
            const departement = values.departement;
            const typeEmprunt = values.type_emprunt || "sans";
            const pretsAides = values.prets_aides || 0;
            const autresPrets = values.autres_prets || 0;
            const remiseVar = values.remise_notaire_var === true;

            // Prix net √† consid√©rer (hors mobilier)
            const prixNetImmobilier = prixAchat - montantMobilier;
            const montantTotalPrets = pretsAides + autresPrets;

            // R√©cup√©rer les taux et frais du d√©partement
            const depData =
              departements[departement] || departements["default"];
            // Bar√®me √©moluments officiels (CSN 2025)
            const tranches = (fraisCfg.bareme_emoluments_2025?.tranches || []).map(t => ({ min: t.min, max: t.max === 999999999 ? Infinity : t.max, taux: Number(t.taux) }));
            if (!tranches.length) {
              tranches.push({ min:0, max:6500, taux:0.0387 }, { min:6500, max:17000, taux:0.01596 }, { min:17000, max:60000, taux:0.01064 }, { min:60000, max:Infinity, taux:0.00799 });
            }
            let emoluments = 0;
            let reste = prixNetImmobilier;
            let emolumentsSansRemise = 0;
            for (const tranche of tranches) {
              if (reste <= 0) break;
              const montantTranche = Math.min(reste, tranche.max - tranche.min);
              emoluments += montantTranche * tranche.taux;
              emolumentsSansRemise += montantTranche * tranche.taux;
              reste -= montantTranche;
            }
            let remiseMontant = 0;
            if (remiseVar) {
              remiseMontant = emoluments * 0.1;
              emoluments = emoluments * 0.9;
            }

            // D√©bours/Formalit√©s par d√©partement
            const { debours, formalites } = getDeboursForm(values.departement);
            // CSI 0,10% (min 15‚Ç¨)
            const csi = Math.max(prixNetImmobilier * (Number(fraisCfg.csi?.taux || 0.001)), Number(fraisCfg.csi?.minimum || 15));

            // Frais d'hypoth√®que selon le type d'emprunt
            let fraisHypotheque = 0;
            if (typeEmprunt === "avec_garantie" && montantTotalPrets > 0) {
              fraisHypotheque = Math.max(375, montantTotalPrets * 0.015);
            } else if (
              typeEmprunt === "sans_garantie" &&
              montantTotalPrets > 0
            ) {
              fraisHypotheque = 150;
            }

            // Frais suppl√©mentaires pour terrain
            let fraisTerrain = 0;
            if (typeBien === "terrain") {
              fraisTerrain = 100;
            }

            // TVA sur √©moluments + formalit√©s uniquement
            const tva = Math.round((emoluments + formalites) * 0.2 * 100) / 100;

            // Droits d'enregistrement (ancien depuis JSON structur√©, neuf 0,715%)
            let tauxDroits = getDmtoTaux(departement);
            let droitsEnregistrement =
              Math.round(prixNetImmobilier * tauxDroits * 100) / 100;
            let droitsLabel = `Droits d'enregistrement (${pct(tauxDroits)})`;
            if (typeBien === "neuf") {
              tauxDroits = 0.00715;
              droitsEnregistrement =
                Math.round(prixNetImmobilier * tauxDroits * 100) / 100;
              droitsLabel = `Droits d'enregistrement r√©duits (0,715%)`;
            }

            // Total frais de notaire
            const total =
              Math.round(
                (emoluments +
                  droitsEnregistrement +
                  debours +
                  formalites +
                  csi +
                  fraisHypotheque +
                  fraisTerrain +
                  tva) *
                  100
              ) / 100;
            const pourcentage =
              prixAchat > 0 ? Math.round((total / prixAchat) * 10000) / 100 : 0;

            return {
              success: true,
              data: {
                emoluments: Math.round(emoluments * 100) / 100,
                emolumentsSansRemise:
                  Math.round(emolumentsSansRemise * 100) / 100,
                remiseMontant: Math.round(remiseMontant * 100) / 100,
                debours: Math.round(debours * 100) / 100,
                formalites: Math.round(formalites * 100) / 100,
                csi: Math.round(csi * 100) / 100,
                fraisHypotheque: Math.round(fraisHypotheque * 100) / 100,
                fraisTerrain: Math.round(fraisTerrain * 100) / 100,
                droitsEnregistrement,
                droitsLabel,
                tva,
                total,
                pourcentage,
                prixAchat: Math.round(prixAchat * 100) / 100,
                prixNetImmobilier: Math.round(prixNetImmobilier * 100) / 100,
                montantMobilier: Math.round(montantMobilier * 100) / 100,
                typeBien,
                departement,
                typeEmprunt,
                montantTotalPrets: Math.round(montantTotalPrets * 100) / 100,
                remiseVar,
                tauxDroits,
                isVEFA: typeBien === "neuf",
              },
            };
          } catch (error) {
            return {
              success: false,
              error: "Erreur lors du calcul. V√©rifiez vos donn√©es.",
            };
          }
        },
        formatResult: (result) => {
          const data = result.data;
          return `
          <div class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-blue-50 p-4 rounded-lg">
                <h4 class="font-semibold text-gray-800">Prix d'acquisition</h4>
                <p class="text-xl font-bold text-blue-600">${formatCurrency(
                  data.prixAchat
                )}</p>
                ${
                  data.montantMobilier > 0
                    ? `<p class="text-sm text-gray-600">Dont mobilier : ${formatCurrency(
                        data.montantMobilier
                      )}</p>`
                    : ""
                }
              </div>
              <div class="bg-green-50 p-4 rounded-lg">
                <h4 class="font-semibold text-gray-800">Frais de notaire totaux</h4>
                <p class="text-xl font-bold text-green-600">${formatCurrency(
                  data.total
                )}</p>
                <p class="text-sm text-gray-600">${data.pourcentage.toFixed(
                  2
                )}% du prix d'acquisition</p>
              </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg">
              <h4 class="font-semibold text-gray-800 mb-3">Informations de l'acquisition :</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                <div><span class="font-medium">Type de bien :</span> ${
                  data.typeBien === "ancien"
                    ? "Bien ancien"
                    : data.typeBien === "neuf"
                    ? "Bien neuf"
                    : "Terrain"
                }</div>
                <div><span class="font-medium">D√©partement :</span> ${
                  data.departement
                }</div>
                <div><span class="font-medium">Prix net immobilier :</span> ${formatCurrency(
                  data.prixNetImmobilier
                )}</div>
                <div><span class="font-medium">Type d'emprunt :</span> ${
                  data.typeEmprunt === "sans"
                    ? "Sans emprunt"
                    : data.typeEmprunt === "sans_garantie"
                    ? "Sans garantie hypoth√©caire"
                    : "Avec garantie hypoth√©caire"
                }</div>
                ${
                  data.montantTotalPrets > 0
                    ? `<div><span class="font-medium">Montant total des pr√™ts :</span> ${formatCurrency(
                        data.montantTotalPrets
                      )}</div>`
                    : ""
                }
                ${
                  data.remiseVar
                    ? `<div><span class="font-medium">Remise notariale appliqu√©e :</span> Oui (-10% sur la partie variable)</div>`
                    : ""
                }
              </div>
            </div>

            <div class="border-t pt-4">
              <h4 class="font-semibold text-gray-800 mb-3">D√©tail des frais :</h4>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between"><span>√âmoluments du notaire :</span><span class="font-medium">${formatCurrency(
                  data.emoluments
                )}</span></div>
                ${
                  data.remiseVar
                    ? `<div class="flex justify-between"><span>Remise notariale (-10%) :</span><span class="font-medium">- ${formatCurrency(
                        data.remiseMontant
                      )}</span></div>`
                    : ""
                }
                <div class="flex justify-between"><span>Droits d'enregistrement (${(
                  data.tauxDroits * 100
                ).toFixed(
                  2
                )}%) :</span><span class="font-medium">${formatCurrency(
            data.droitsEnregistrement
          )}</span></div>
                <div class="flex justify-between"><span>D√©bours (cadastre, conservation) :</span><span class="font-medium">${formatCurrency(
                  data.debours
                )}</span></div>
                <div class="flex justify-between"><span>Formalit√©s diverses :</span><span class="font-medium">${formatCurrency(
                  data.formalites
                )}</span></div>
                <div class="flex justify-between"><span>Contribution de S√©curit√© Immobili√®re (CSI) :</span><span class="font-medium">${formatCurrency(
                  data.csi
                )}</span></div>
                ${
                  data.fraisHypotheque > 0
                    ? `<div class="flex justify-between"><span>Frais d'hypoth√®que :</span><span class="font-medium">${formatCurrency(
                        data.fraisHypotheque
                      )}</span></div>`
                    : ""
                }
                ${
                  data.fraisTerrain > 0
                    ? `<div class="flex justify-between"><span>Frais sp√©cifiques terrain :</span><span class="font-medium">${formatCurrency(
                        data.fraisTerrain
                      )}</span></div>`
                    : ""
                }
                <div class="flex justify-between"><span>TVA (20%) :</span><span class="font-medium">${formatCurrency(
                  data.tva
                )}</span></div>
                <div class="flex justify-between border-t pt-2 font-semibold text-lg"><span>Total frais de notaire :</span><span class="text-green-600">${formatCurrency(
                  data.total
                )}</span></div>
              </div>
            </div>

            ${
              data.isVEFA
                ? `<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4"><p class="text-sm text-yellow-800"><strong>‚ö† Dans le cas d‚Äôun bien neuf (VEFA), les droits de mutation sont r√©duits (0,715%).<br>Cette r√®gle est d√©j√† int√©gr√©e dans le calcul.</strong></p></div>`
                : ""
            }

            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4">
              <p class="text-sm text-yellow-800"><strong>Information :</strong> Cette estimation est bas√©e sur les bar√®mes officiels 2024-2025. Le montant exact peut varier selon la complexit√© du dossier, les prestations compl√©mentaires et les taux locaux (droits de mutation variables selon les d√©partements).</p>
            </div>
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
              <p class="text-sm text-blue-800"><strong>Bon √† savoir :</strong> Les droits d'enregistrement peuvent varier selon votre localisation. Contactez votre notaire pour une estimation pr√©cise.</p>
            </div>

            <!-- Bouton de partage du calcul -->
            <div class="mt-4 flex justify-center">
              <button type="button" id="btn-share-calc" class="bg-blue-600 text-white font-semibold px-4 py-2 rounded-md shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-600" title="Copier/partager le lien du calcul">üîó Partager ce calcul</button>
            </div>

            <!-- Bouton Ajouter √† la comparaison -->
            <div class="mt-6 flex justify-center">
              <button onclick="window.ajouterCalculActuelEtOuvrirModale?.()" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold py-3 px-8 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2"><span class="text-xl">üìä</span><span>Comparer avec une autre ville</span></button>
            </div>
          </div>
          `;
        },
        exportCSV: {
          enabled: true,
          filename: "frais_notaire_2025.csv",
          getCSVData: (result, values) => {
            const d = result.data;
            // Forcer le texte en ajoutant un espace ins√©cable au d√©but
            const fmt = (n) => {
              if (!n || isNaN(n)) return " 0,00";
              return (
                " " +
                n.toLocaleString("fr-FR", {
                  minimumFractionDigits: 2,
                  maximumFractionDigits: 2,
                })
              );
            };
            const pct = (montant) => {
              if (!montant || isNaN(montant) || !d.prixAchat) return " 0,00%";
              return " " + ((montant / d.prixAchat) * 100).toFixed(2) + "%";
            };

            // Mapper d√©partement ‚Üí label complet
            const deptMap = {
              75: "75 - Paris",
              13: "13 - Bouches-du-Rh√¥ne",
              69: "69 - Rh√¥ne",
              59: "59 - Nord",
              92: "92 - Hauts-de-Seine",
              93: "93 - Seine-Saint-Denis",
              94: "94 - Val-de-Marne",
              77: "77 - Seine-et-Marne",
              78: "78 - Yvelines",
              91: "91 - Essonne",
              95: "95 - Val-d'Oise",
              "06": "06 - Alpes-Maritimes",
              31: "31 - Haute-Garonne",
              33: "33 - Gironde",
              44: "44 - Loire-Atlantique",
              34: "34 - H√©rault",
              67: "67 - Bas-Rhin",
              35: "35 - Ille-et-Vilaine",
              38: "38 - Is√®re",
              83: "83 - Var",
              autre: "Autre d√©partement",
            };

            const typeBienLabel =
              d.typeBien === "ancien"
                ? "Bien ancien"
                : d.typeBien === "neuf"
                ? "Bien neuf"
                : "Terrain";
            const empruntLabel =
              d.typeEmprunt === "sans"
                ? "Sans emprunt"
                : d.typeEmprunt === "sans_garantie"
                ? "Sans garantie hypoth√©caire"
                : "Avec garantie hypoth√©caire";
            const departementLabel = deptMap[d.departement] || d.departement;

            return {
              headers: ["Description", "Montant (‚Ç¨)", "Pourcentage du prix"],
              rows: [
                ["--- INFORMATIONS ---", "", ""],
                ["Type de bien", typeBienLabel, ""],
                ["D√©partement", departementLabel, ""],
                ["Prix net immobilier", fmt(d.prixNetImmobilier), ""],
                ["Type d'emprunt", empruntLabel, ""],
                ["", "", ""],
                ["--- CALCUL DES FRAIS ---", "", ""],
                ["Prix d'acquisition", fmt(d.prixAchat), " 100%"],
                ["√âmoluments du notaire", fmt(d.emoluments), pct(d.emoluments)],
                [
                  "Droits d'enregistrement",
                  fmt(d.droitsEnregistrement),
                  pct(d.droitsEnregistrement),
                ],
                [
                  "Frais divers (cadastre...)",
                  fmt(d.fraisDivers),
                  pct(d.fraisDivers),
                ],
                ...(d.fraisHypotheque > 0
                  ? [
                      [
                        "Frais d'hypoth√®que",
                        fmt(d.fraisHypotheque),
                        pct(d.fraisHypotheque),
                      ],
                    ]
                  : []),
                ...(d.fraisTerrain > 0
                  ? [
                      [
                        "Frais sp√©cifiques terrain",
                        fmt(d.fraisTerrain),
                        pct(d.fraisTerrain),
                      ],
                    ]
                  : []),
                ["TVA (20%)", fmt(d.tva), pct(d.tva)],
                ["", "", ""],
                ["TOTAL FRAIS DE NOTAIRE", fmt(d.total), pct(d.total)],
              ],
            };
          },
        },
        exportXLSX: {
          enabled: true,
          filename: "frais_notaire_2025.xlsx",
          getXLSXData: (result, values) => {
            const d = result.data;
            const fmt = (n) => {
              const v = n && !isNaN(n) ? Number(n) : 0;
              return (
                " " +
                v.toLocaleString("fr-FR", {
                  minimumFractionDigits: 2,
                  maximumFractionDigits: 2,
                })
              );
            };
            const pct = (m) => {
              const base =
                d.prixAchat && !isNaN(d.prixAchat) ? Number(d.prixAchat) : 0;
              const val = m && !isNaN(m) ? Number(m) : 0;
              const p = base > 0 ? (val / base) * 100 : 0;
              return (
                " " +
                p.toLocaleString("fr-FR", {
                  minimumFractionDigits: 2,
                  maximumFractionDigits: 2,
                }) +
                "%"
              );
            };
            const deptMap = {
              75: "75 - Paris",
              13: "13 - Bouches-du-Rh√¥ne",
              69: "69 - Rh√¥ne",
              59: "59 - Nord",
              92: "92 - Hauts-de-Seine",
              93: "93 - Seine-Saint-Denis",
              94: "94 - Val-de-Marne",
              77: "77 - Seine-et-Marne",
              78: "78 - Yvelines",
              91: "91 - Essonne",
              95: "95 - Val-d'Oise",
              "06": "06 - Alpes-Maritimes",
              31: "31 - Haute-Garonne",
              33: "33 - Gironde",
              44: "44 - Loire-Atlantique",
              34: "34 - H√©rault",
              67: "67 - Bas-Rhin",
              35: "35 - Ille-et-Vilaine",
              38: "38 - Is√®re",
              83: "83 - Var",
              autre: "Autre d√©partement",
            };
            const typeBienLabel =
              d.typeBien === "ancien"
                ? "Bien ancien"
                : d.typeBien === "neuf"
                ? "Bien neuf"
                : "Terrain";
            const empruntLabel =
              d.typeEmprunt === "sans"
                ? "Sans emprunt"
                : d.typeEmprunt === "sans_garantie"
                ? "Sans garantie hypoth√©caire"
                : "Avec garantie hypoth√©caire";
            const departementLabel = deptMap[d.departement] || d.departement;
            return {
              headers: ["Description", "Montant (‚Ç¨)", "Pourcentage du prix"],
              rows: [
                ["--- INFORMATIONS ---", "", ""],
                ["Type de bien", typeBienLabel, ""],
                ["D√©partement", departementLabel, ""],
                ["Prix net immobilier", fmt(d.prixNetImmobilier), ""],
                ["Type d'emprunt", empruntLabel, ""],
                ["", "", ""],
                ["--- CALCUL DES FRAIS ---", "", ""],
                ["Prix d'acquisition", fmt(d.prixAchat), " 100%"],
                ["√âmoluments du notaire", fmt(d.emoluments), pct(d.emoluments)],
                [
                  "Droits d'enregistrement",
                  fmt(d.droitsEnregistrement),
                  pct(d.droitsEnregistrement),
                ],
                [
                  "Frais divers (cadastre...)",
                  fmt(d.fraisDivers),
                  pct(d.fraisDivers),
                ],
                ...(d.fraisHypotheque > 0
                  ? [
                      [
                        "Frais d'hypoth√®que",
                        fmt(d.fraisHypotheque),
                        pct(d.fraisHypotheque),
                      ],
                    ]
                  : []),
                ...(d.fraisTerrain > 0
                  ? [
                      [
                        "Frais sp√©cifiques terrain",
                        fmt(d.fraisTerrain),
                        pct(d.fraisTerrain),
                      ],
                    ]
                  : []),
                ["TVA (20%)", fmt(d.tva), pct(d.tva)],
                ["", "", ""],
                ["TOTAL FRAIS DE NOTAIRE", fmt(d.total), pct(d.total)],
              ],
            };
          },
        },
      };

      // Initialisation du calculateur
      new CalculatorFrame("notaire-calculator", notaireConfig);
    </script>
    <script type="module">
      const fraisCfg = await (await fetch("../data/frais2025.json")).json();
      const departements = (await import("../data/departements.json", { assert: { type: "json" } })).default;
      const pct = (n) => { const p = n * 100; const t = Math.floor(p * 100)/100; return `‚âà ${t.toFixed(2).replace('.', ',')}%`; };
      const getDmtoTaux = (code) => {
        const c = String(code);
        if (fraisCfg.dmto_struct?.ancien) {
          const map = fraisCfg.dmto_struct.ancien.par_departement || {};
          const def = Number(fraisCfg.dmto_struct.ancien.default || 0.058);
          return map[c] != null ? Number(map[c]) : def;
        }
        if (fraisCfg.dmto?.[c] != null) return Number(fraisCfg.dmto[c]) / 100;
        return 0.058;
      };
      const getName = (code) => {
        const c = String(code).toUpperCase();
        const arr = Array.isArray(departements) ? departements : Object.keys(departements).map(k => ({ code: k, nom: departements[k].nom }));
        const found = arr.find(d => String(d.code).toUpperCase() === c);
        return found?.nom || c;
      };
      function buildModalOptions() {
        const select = document.getElementById('modal-departement');
        if (!select) return;
        const popular = ["75","92","93","94","78","91","95","77","13","69","59","06","31","33","44","34","67","35","38","83","62","76","84","30","17","2A","2B"];
        select.innerHTML = '<option value="">-- S√©lectionnez un d√©partement --</option>' + popular.map(code => {
          const name = getName(code);
          const taux = getDmtoTaux(code);
          return `<option value="${code}">${code} - ${name} (${pct(taux)})</option>`;
        }).join('');
      }
      buildModalOptions();
    </script>

    <script>
      /**
       * Attache le partage du calcul (copie ou Web Share) sans perturber le rendu
       */
      (function () {
        document.addEventListener("click", function (e) {
          var target = e.target;
          var isShare = false;
          if (target && target.id === "btn-share-calc") {
            isShare = true;
          } else if (target && target.closest) {
            var el = target.closest("#btn-share-calc");
            isShare = !!el;
          }
          if (!isShare) return;
          e.preventDefault();
          try {
            var link = window.location.href;
            var dc =
              window.dernierCalculNotaire && window.dernierCalculNotaire.values
                ? window.dernierCalculNotaire.values
                : null;
            if (dc) {
              var u = new URL(window.location.pathname, window.location.origin);
              var p = new URLSearchParams();
              Object.keys(dc).forEach(function (k) {
                var v = dc[k];
                if (v !== undefined && v !== null && String(v) !== "")
                  p.set(k, String(v));
              });
              u.search = p.toString();
              link = u.toString();
            }
            if (navigator.share) {
              navigator.share({
                title: document.title,
                text: "Estimation des frais de notaire",
                url: link,
              });
            } else {
              navigator.clipboard.writeText(link);
              var t = document.createElement("div");
              t.textContent = "Lien copi√© !";
              t.className =
                "fixed bottom-6 left-1/2 -translate-x-1/2 bg-black text-white text-sm px-3 py-2 rounded-md shadow";
              document.body.appendChild(t);
              setTimeout(function () {
                document.body.removeChild(t);
              }, 2000);
            }
          } catch (err) {
            console.error("Partage erreur", err);
          }
        });
      })();
    </script>

    <!-- HowTo JSON-LD: Calculer vos frais de notaire -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "HowTo",
        "name": "Calculer vos frais de notaire",
        "description": "Proc√©dure pas √† pas pour estimer les frais de notaire selon le type de bien et le d√©partement.",
        "step": [
          {
            "@type": "HowToStep",
            "name": "Choisir le type de bien",
            "text": "S√©lectionnez ancien, neuf ou terrain selon votre projet."
          },
          {
            "@type": "HowToStep",
            "name": "Indiquer le d√©partement",
            "text": "Renseignez le d√©partement o√π se situe le bien."
          },
          {
            "@type": "HowToStep",
            "name": "Saisir le prix d'acquisition",
            "text": "Entrez le prix du bien. Ajoutez le mobilier si applicable pour le d√©duire."
          },
          {
            "@type": "HowToStep",
            "name": "Pr√©ciser l'emprunt",
            "text": "Indiquez le type d'emprunt et les montants; choisissez si une garantie hypoth√©caire s'applique."
          },
          {
            "@type": "HowToStep",
            "name": "Calculer",
            "text": "Cliquez sur Calculer pour obtenir le d√©tail: √©moluments, droits, d√©bours, TVA et total."
          }
        ]
      }
    </script>

    <!-- Gestion de la comparaison multi-villes -->
    <script type="module">
      import { ComparaisonNotaire } from "../utils/comparaisonNotaire.ts";

      // Instance globale de comparaison
      window.comparaisonNotaire = new ComparaisonNotaire(
        "comparaison-container"
      );

      // Variable pour tracker si la comparaison a d√©j√† √©t√© lanc√©e
      let comparaisonDemarree = false;

      // Fonction pour ajouter le calcul courant et ouvrir la modale de comparaison
      window.ajouterCalculActuelEtOuvrirModale = () => {
        // R√©cup√©rer le calcul courant
        const calculData = window.dernierCalculNotaire;
        if (!calculData || !calculData.result || !calculData.values) {
          alert("Veuillez d'abord effectuer un calcul avant de comparer");
          return;
        }

        // Ajouter le calcul courant √† la comparaison (une seule fois)
        if (window.comparaisonNotaire.getNombreCalculs() === 0) {
          const deptMap = {
            75: "75 - Paris (5.9%)",
            92: "92 - Hauts-de-Seine (5.9%)",
            93: "93 - Seine-Saint-Denis (5.9%)",
            94: "94 - Val-de-Marne (5.9%)",
            78: "78 - Yvelines (5.9%)",
            91: "91 - Essonne (5.9%)",
            95: "95 - Val-d'Oise (5.9%)",
            77: "77 - Seine-et-Marne (5.8%)",
            13: "13 - Bouches-du-Rh√¥ne (5.8%)",
            69: "69 - Rh√¥ne (5.8%)",
            59: "59 - Nord (5.8%)",
            "06": "06 - Alpes-Maritimes (5.8%)",
            31: "31 - Haute-Garonne (5.8%)",
            33: "33 - Gironde (5.8%)",
            44: "44 - Loire-Atlantique (5.8%)",
            34: "34 - H√©rault (5.8%)",
            67: "67 - Bas-Rhin (5.8%)",
            35: "35 - Ille-et-Vilaine (5.8%)",
            38: "38 - Is√®re (5.8%)",
            83: "83 - Var (5.8%)",
            62: "62 - Pas-de-Calais (5.8%)",
            76: "76 - Seine-Maritime (5.8%)",
            84: "84 - Vaucluse (5.8%)",
            30: "30 - Gard (5.8%)",
            17: "17 - Charente-Maritime (5.8%)",
            "2A": "2A - Corse-du-Sud (4.5%)",
            "2B": "2B - Haute-Corse (4.5%)",
            autre: "Autre d√©partement (5.8%)",
          };

          const departementLabel =
            deptMap[calculData.values.departement] ||
            calculData.values.departement;

          window.comparaisonNotaire.ajouterCalcul(
            calculData.result,
            calculData.values,
            departementLabel
          );

          console.log("Premier calcul ajout√© √† la comparaison");
        }

        // Ouvrir la modale pour ajouter d'autres villes
        const modal = document.getElementById("modal-selection-ville");
        if (modal) {
          modal.style.display = "flex";
          console.log("Modale ouverte pour ajouter une autre ville");
        }
      };

      // Fonction pour ouvrir la modale depuis le tableau de comparaison (pour ajouter d'autres villes)
      window.ouvrirModaleComparaison = () => {
        const modal = document.getElementById("modal-selection-ville");
        if (modal) {
          modal.style.display = "flex";
          console.log("Modale ouverte pour ajouter une autre ville");
        }
      };

      // Fonction pour ouvrir la modale de s√©lection (premier clic depuis les r√©sultats)
      window.ajouterAComparaison = () => {
        // Ajouter le calcul actuel (la fonction v√©rifie d√©j√† les doublons)
        const calculData = window.dernierCalculNotaire;
        if (calculData && calculData.result && calculData.values) {
          const deptMap = {
            75: "75 - Paris (5.9%)",
            92: "92 - Hauts-de-Seine (5.9%)",
            93: "93 - Seine-Saint-Denis (5.9%)",
            94: "94 - Val-de-Marne (5.9%)",
            78: "78 - Yvelines (5.9%)",
            91: "91 - Essonne (5.9%)",
            95: "95 - Val-d'Oise (5.9%)",
            77: "77 - Seine-et-Marne (5.8%)",
            13: "13 - Bouches-du-Rh√¥ne (5.8%)",
            69: "69 - Rh√¥ne (5.8%)",
            59: "59 - Nord (5.8%)",
            "06": "06 - Alpes-Maritimes (5.8%)",
            31: "31 - Haute-Garonne (5.8%)",
            33: "33 - Gironde (5.8%)",
            44: "44 - Loire-Atlantique (5.8%)",
            34: "34 - H√©rault (5.8%)",
            67: "67 - Bas-Rhin (5.8%)",
            35: "35 - Ille-et-Vilaine (5.8%)",
            38: "38 - Is√®re (5.8%)",
            83: "83 - Var (5.8%)",
            62: "62 - Pas-de-Calais (5.8%)",
            76: "76 - Seine-Maritime (5.8%)",
            84: "84 - Vaucluse (5.8%)",
            30: "30 - Gard (5.8%)",
            17: "17 - Charente-Maritime (5.8%)",
            "2A": "2A - Corse-du-Sud (4.5%)",
            "2B": "2B - Haute-Corse (4.5%)",
            autre: "Autre d√©partement (5.8%)",
          };

          const departementLabel =
            deptMap[calculData.values.departement] ||
            calculData.values.departement;

          window.comparaisonNotaire.ajouterCalcul(
            calculData.result,
            calculData.values,
            departementLabel
          );
        }
        // Toujours ouvrir la modale pour ajouter une autre ville
        const modal = document.getElementById("modal-selection-ville");
        if (modal) {
          modal.style.display = "flex";
        }
      };

      // Fonction pour annuler la s√©lection
      window.annulerSelectionVille = () => {
        const modal = document.getElementById("modal-selection-ville");
        if (modal) {
          modal.style.display = "none";
          console.log("Modale ferm√©e");
        }
      };

      // Fonction pour confirmer la s√©lection et calculer
      window.confirmerSelectionVille = () => {
        const select = document.getElementById("modal-departement");
        const departementChoisi = select.value;

        if (!departementChoisi) {
          alert("Veuillez s√©lectionner un d√©partement");
          return;
        }

        // Fermer la modale
        const modal = document.getElementById("modal-selection-ville");
        if (modal) {
          modal.style.display = "none";
        }

        // R√©cup√©rer les valeurs actuelles du dernier calcul
        const calculData = window.dernierCalculNotaire;
        if (!calculData || !calculData.values) {
          alert("Erreur : veuillez d'abord effectuer un calcul");
          return;
        }

        // Modifier le d√©partement dans le formulaire
        const deptSelect = document.getElementById("departement");
        if (!deptSelect) {
          alert("Erreur : formulaire non trouv√©");
          return;
        }
        deptSelect.value = departementChoisi;

        // Copier les autres valeurs du dernier calcul
        const values = { ...calculData.values };
        values.departement = departementChoisi;

        // Remplir le formulaire avec les m√™mes valeurs
        let formulaireRempli = true;
        Object.keys(values).forEach((key) => {
          const input = document.getElementById(key);
          if (input) {
            if (input.type === "checkbox") {
              input.checked = values[key];
            } else {
              input.value = values[key];
            }
          }
        });

        // D√©clencher le calcul automatiquement
        setTimeout(() => {
          const form = document.querySelector("#notaire-calculator form");
          const submitBtn = form?.querySelector('button[type="submit"]');
          if (!submitBtn) {
            console.error("Bouton soumettre non trouv√©");
            alert("Erreur : impossible de d√©clencher le calcul");
            return;
          }

          console.log(
            "D√©clenchement du calcul pour le d√©partement:",
            departementChoisi
          );
          submitBtn.click();

          // Attendre que le calcul soit fait et ajouter √† la comparaison
          setTimeout(() => {
            const nouveauCalcul = window.dernierCalculNotaire;
            if (nouveauCalcul && nouveauCalcul.result && nouveauCalcul.values) {
              console.log("Calcul re√ßu, ajout √† la comparaison");
              const deptMap = {
                75: "75 - Paris (5.9%)",
                92: "92 - Hauts-de-Seine (5.9%)",
                93: "93 - Seine-Saint-Denis (5.9%)",
                94: "94 - Val-de-Marne (5.9%)",
                78: "78 - Yvelines (5.9%)",
                91: "91 - Essonne (5.9%)",
                95: "95 - Val-d'Oise (5.9%)",
                77: "77 - Seine-et-Marne (5.8%)",
                13: "13 - Bouches-du-Rh√¥ne (5.8%)",
                69: "69 - Rh√¥ne (5.8%)",
                59: "59 - Nord (5.8%)",
                "06": "06 - Alpes-Maritimes (5.8%)",
                31: "31 - Haute-Garonne (5.8%)",
                33: "33 - Gironde (5.8%)",
                44: "44 - Loire-Atlantique (5.8%)",
                34: "34 - H√©rault (5.8%)",
                67: "67 - Bas-Rhin (5.8%)",
                35: "35 - Ille-et-Vilaine (5.8%)",
                38: "38 - Is√®re (5.8%)",
                83: "83 - Var (5.8%)",
                62: "62 - Pas-de-Calais (5.8%)",
                76: "76 - Seine-Maritime (5.8%)",
                84: "84 - Vaucluse (5.8%)",
                30: "30 - Gard (5.8%)",
                17: "17 - Charente-Maritime (5.8%)",
                "2A": "2A - Corse-du-Sud (4.5%)",
                "2B": "2B - Haute-Corse (4.5%)",
                autre: "Autre d√©partement (5.8%)",
              };

              const departementLabel =
                deptMap[nouveauCalcul.values.departement] ||
                nouveauCalcul.values.departement;

              window.comparaisonNotaire.ajouterCalcul(
                nouveauCalcul.result,
                nouveauCalcul.values,
                departementLabel
              );

              // Scroller vers la comparaison
              document.getElementById("comparaison-container")?.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            } else {
              console.warn("Calcul non re√ßu ou incomplet apr√®s d√©lai");
            }
          }, 1000);
        }, 100);
      };
    </script>

    <!-- Auto-initialisation des exports PDF/CSV -->
    <script type="module" src="../utils/pdfExport.js"></script>
    <script type="module" src="../utils/autoExportInit.js"></script>
  </body>
</html>
