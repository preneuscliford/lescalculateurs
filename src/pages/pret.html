<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulateur Pr√™t Immobilier 2026 - Calcul Gratuit</title>
    <meta
      name="description"
      content="üè† Calculez votre capacit√© d'emprunt immobilier 2026 selon vos revenus et charges. D√©couvrez quel salaire pour emprunter 200 000 ‚Ç¨, 250 000 ‚Ç¨ ou plus. R√©sultat imm√©diat !"
    />
    <meta
      name="keywords"
      content="capacit√© d'emprunt immobilier, combien puis-je emprunter, quel salaire pour emprunter, simulateur capacit√© emprunt, taux d'endettement 35%, reste √† vivre, pr√™t immobilier 2026"
    />
    <meta name="google-adsense-account" content="ca-pub-2209781252231399" />

    <!-- SEO & Social -->
    <link rel="canonical" href="https://www.lescalculateurs.fr/pages/pret" />
    <meta
      property="og:url"
      content="https://www.lescalculateurs.fr/pages/pret"
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Simulateur pr√™t immobilier 2026 : Calcul capacit√© emprunt gratuite"
    />
    <meta
      property="og:description"
      content="üè† Calculez votre capacit√© d'emprunt immobilier 2026 selon vos revenus et charges. D√©couvrez quel salaire pour emprunter 200 000 ‚Ç¨, 250 000 ‚Ç¨ ou plus. R√©sultat imm√©diat !"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Simulateur pr√™t immobilier 2026 : Calcul capacit√© emprunt gratuite"
    />
    <meta
      name="twitter:description"
      content="üè† Calculez votre capacit√© d'emprunt immobilier 2026 selon vos revenus et charges. D√©couvrez quel salaire pour emprunter 200 000 ‚Ç¨, 250 000 ‚Ç¨ ou plus. R√©sultat imm√©diat !"
    />

    <!-- JSON-LD: BreadcrumbList & FAQPage -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Accueil",
            "item": "https://www.lescalculateurs.fr/index"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Capacit√© d'emprunt immobilier",
            "item": "https://www.lescalculateurs.fr/pages/pret"
          }
        ]
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "Quel salaire pour emprunter 200 000 ‚Ç¨ ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Pour emprunter 200 000 ‚Ç¨ sur 20 ans √† 4%, la mensualit√© est d'environ 1 210 ‚Ç¨. Avec un taux d'endettement de 35%, il faut g√©n√©ralement un revenu net mensuel d'environ 3 500 ‚Ç¨ sans autres charges, ou 4 500 ‚Ç¨ avec des charges existantes."
            }
          },
          {
            "@type": "Question",
            "name": "Quelle est la capacit√© d'emprunt avec 3 000 ‚Ç¨ net par mois ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Avec 3 000 ‚Ç¨ nets mensuels et sans autre cr√©dit, votre capacit√© d'emprunt peut se situer autour de 165 000 ‚Ç¨ sur 20 ans (taux 4%) ou 195 000 ‚Ç¨ sur 25 ans, selon votre taux d'endettement maximal de 35%."
            }
          },
          {
            "@type": "Question",
            "name": "Comment calculer ma capacit√© d'emprunt maximale ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Votre capacit√© d√©pend de vos revenus nets, de vos charges existantes et du taux d'endettement (souvent ~35% assurance incluse). Multipliez vos revenus par 35%, soustrayez vos charges existantes pour obtenir votre mensualit√© maximale, puis calculez le capital correspondant selon la dur√©e et le taux."
            }
          },
          {
            "@type": "Question",
            "name": "Quel est le taux d'endettement maximum en 2026 ?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Les banques appliquent g√©n√©ralement un taux d'endettement maximum de 35% assurance incluse. Ce seuil peut √™tre d√©pass√© dans certains cas pour les primo-acc√©dants avec un bon reste √† vivre."
            }
          }
        ]
      }
    </script>

    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../assets/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../assets/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../assets/favicon-16x16.png"
    />
    <link rel="manifest" href="../assets/site.webmanifest" />
    <link rel="shortcut icon" href="../assets/favicon.ico" />

    <script defer src="/third-party-loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- JSON-LD Calculator Schema -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Calculator",
        "name": "Simulateur Capacit√© d'Emprunt Immobilier 2026",
        "description": "Calculez votre capacit√© d'emprunt immobilier selon vos revenus, charges et taux d'endettement indicatif - estimation indicative",
        "url": "https://www.lescalculateurs.fr/pages/pret",
        "applicationCategory": "FinanceApplication",
        "screenshot": "https://www.lescalculateurs.fr/pages/pret",
        "isBasedOn": [
          "https://www.lescalculateurs.fr/pages/methodologie",
          "https://www.lescalculateurs.fr/pages/sources"
        ],
        "citation": [
          {
            "@type": "Organization",
            "name": "Banque de France",
            "url": "https://www.banque-france.fr"
          },
          {
            "@type": "CreativeWork",
            "name": "Service-public.fr ‚Äì Cr√©dit immobilier",
            "url": "https://www.service-public.fr/particuliers/vosdroits/N20373"
          }
        ]
      }
    </script>

    <!-- Schema.org SoftwareApplication -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Simulateur de capacit√© d'emprunt immobilier",
        "operatingSystem": "Web",
        "applicationCategory": "FinanceApplication",
        "description": "Simulateur de capacit√© d'emprunt immobilier pour estimer combien vous pouvez emprunter selon vos revenus.",
        "url": "https://www.lescalculateurs.fr/pages/pret",
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "EUR" }
      }
    </script>
    <meta name="source" content="banque-france.fr, service-public.fr, legifrance.gouv.fr" />

    <style>
      .indicateur-barre {
        height: 8px;
        border-radius: 4px;
        transition: all 0.3s ease;
      }
      .indicateur-bg {
        background: linear-gradient(
          to right,
          #10b981 0%,
          #10b981 30%,
          #f59e0b 30%,
          #f59e0b 70%,
          #ef4444 70%,
          #ef4444 100%
        );
      }
      .indicateur-marker {
        width: 12px;
        height: 12px;
        background: #1f2937;
        border-radius: 50%;
        position: absolute;
        top: -2px;
        transform: translateX(-50%);
        transition: left 0.3s ease;
      }
      .table-capacite th {
        background: #f3f4f6;
        font-weight: 600;
      }
      .table-capacite td {
        border-bottom: 1px solid #e5e7eb;
      }
      .table-capacite tr:hover td {
        background: #f9fafb;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div
      class="sticky-ymyl"
      role="alert"
      style="
        position: sticky;
        top: 0;
        z-index: 9999;
        background: #fff3cd;
        border: 1px solid #ffc107;
        padding: 8px 12px;
        text-align: center;
        font-size: 13px;
      "
    >
      <strong>‚ö†Ô∏è Estimation indicative.</strong>
      <span class="hidden sm:inline">Montant d√©finitif sur </span>
      <a
        href="https://www.banque-france.fr/fr/les-taux-monetaires-directeurs"
        target="_blank"
        rel="noopener"
        style="color: #856404; text-decoration: underline; font-weight: bold"
        >Banque de France</a
      >
      <span class="hidden md:inline">
        |
        <a
          href="/pages/historique-mises-a-jour"
          style="color: #856404; text-decoration: underline"
          >üîÑ Historique</a
        ></span
      >
    </div>

    <header
      class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-14">
          <a href="/" class="flex items-center space-x-2">
            <img
              src="/assets/lescalculateurs-new-logo.png"
              alt="LesCalculateurs"
              class="h-8 w-auto"
            />
            <span class="font-bold text-gray-900 hidden sm:block"
              >Les Calculateurs</span
            >
          </a>
          <nav class="hidden md:flex items-center space-x-4 text-sm">
            <a href="/" class="text-gray-600 hover:text-blue-600">üè† Accueil</a>
            <a
              href="/pages/simulateurs.html"
              class="text-gray-600 hover:text-blue-600"
              >üéØ Outils</a
            >
            <a
              href="/pages/methodologie.html"
              class="hidden lg:block text-gray-600 hover:text-blue-600"
              >üìö M√©thodo</a
            >
          </nav>
          <button id="mobile-menu-btn" class="md:hidden text-gray-600">
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
          </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden py-2 border-t">
          <nav class="flex flex-col space-y-2 text-sm">
            <a href="/" class="text-gray-600 hover:text-blue-600 py-1"
              >üè† Accueil</a
            >
            <a
              href="/pages/simulateurs.html"
              class="text-gray-600 hover:text-blue-600 py-1"
              >üéØ Simulateurs</a
            >
          </nav>
        </div>
      </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- H1 et Introduction -->
      <div class="flex flex-col items-center mt-6 mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 text-center">
          Simulateur capacit√© d'emprunt immobilier 2026
        </h1>
        <p class="text-sm text-gray-600 mt-2 text-center max-w-2xl">
          Calculez votre capacit√© d'emprunt selon vos revenus, charges
          mensuelles et le taux d'endettement bancaire indicatif (~35% assurance
          incluse). D√©couvrez
          <strong>combien vous pouvez emprunter</strong> pour votre projet
          immobilier.
        </p>
        <button
          data-scroll-target="#calculator-container"
          class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-colors shadow-md mt-6"
        >
          üü¢ Calculer ma capacit√© d'emprunt
        </button>
      </div>

      <!-- H2 SEO (compl√©mentaire au H1) -->
      <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Simulateur de cr√©dit immobilier 2026 ‚Äî bar√®mes bancaires et taux en vigueur</h2>

      <!-- R√©sum√© rapide -->
      <section class="mb-8 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-100 max-w-3xl mx-auto">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
          <span class="mr-2">üìå</span> R√©sum√© rapide
        </h3>
        <ul class="space-y-2 text-gray-700">
          <li><strong>Source :</strong> <a href="https://www.banque-france.fr/fr/les-taux-monetaires-directeurs" target="_blank" rel="noopener" class="text-blue-600 hover:underline">Taux cr√©dit immobilier (BdF)</a>, <a href="https://www.service-public.fr/particuliers/vosdroits/N20373" target="_blank" rel="noopener" class="text-blue-600 hover:underline">Fiche cr√©dit immobilier</a></li>
          <li><strong>Calcul :</strong> Capacit√© d'emprunt = (Revenus √ó 35%) ‚àí Charges existantes</li>
          <li><strong>R√®gle :</strong> Taux d'endettement maximum 35% assurance incluse</li>
          <li><strong>Facteurs :</strong> Revenus, dur√©e du pr√™t, taux d'int√©r√™t, assurance</li>
          <li><strong>Outil :</strong> 100% gratuit, sans cr√©ation de compte</li>
        </ul>
      </section>

      <!-- Simulateur -->
      <div id="calculator-container"></div>

      <!-- R√©sultats d√©taill√©s avec indicateur -->
      <div id="resultats-avances" class="hidden mt-8 space-y-8">
        <!-- Indicateur visuel d'endettement -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üìä Taux d'endettement
          </h2>
          <div class="mb-4">
            <div class="flex justify-between mb-2">
              <span class="text-sm font-medium text-gray-700"
                >Votre endettement</span
              >
              <span
                id="taux-endettement-valeur"
                class="text-lg font-bold text-blue-700"
                >--%</span
              >
            </div>
            <div class="relative h-8 bg-gray-200 rounded-lg overflow-hidden">
              <div
                class="absolute inset-0"
                style="
                  background: linear-gradient(
                    to right,
                    #10b981 0%,
                    #10b981 60%,
                    #f59e0b 60%,
                    #f59e0b 70%,
                    #ef4444 70%,
                    #ef4444 100%
                  );
                "
              ></div>
              <div
                id="indicateur-position"
                class="absolute top-0 bottom-0 w-1 bg-black border-2 border-white rounded transition-all duration-500"
                style="left: 0%"
              ></div>
            </div>
            <div class="flex justify-between mt-2 text-xs">
              <span class="text-green-600 font-semibold">üü¢ OK (&lt;30%)</span>
              <span class="text-yellow-600 font-semibold"
                >üü° Limite (30-35%)</span
              >
              <span class="text-red-600 font-semibold"
                >üî¥ Risque (&gt;35%)</span
              >
            </div>
          </div>
          <div id="endettement-message" class="p-4 rounded-lg bg-gray-50">
            <p class="text-sm text-gray-700">
              Calculez votre capacit√© pour voir l'√©valuation de votre
              endettement.
            </p>
          </div>
        </div>

        <!-- üè¶ Analyse bancaire avanc√©e -->
        <div
          class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg shadow-lg p-6 border border-blue-200"
        >
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üè¶ Analyse de votre profil bancaire
          </h2>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="text-left border-b-2 border-blue-200">
                  <th class="p-3">Indicateur</th>
                  <th class="p-3">Valeur estim√©e</th>
                  <th class="p-3">Interpr√©tation</th>
                </tr>
              </thead>
              <tbody id="analyse-bancaire-corps">
                <tr class="border-b border-blue-100">
                  <td class="p-3 font-medium">Taux d'endettement</td>
                  <td class="p-3 font-bold text-blue-700" id="analyse-taux">
                    --%
                  </td>
                  <td class="p-3" id="analyse-taux-interp">--</td>
                </tr>
                <tr class="border-b border-blue-100">
                  <td class="p-3 font-medium">Reste √† vivre</td>
                  <td class="p-3 font-bold text-blue-700" id="analyse-reste">
                    --
                  </td>
                  <td class="p-3" id="analyse-reste-interp">--</td>
                </tr>
                <tr class="border-b border-blue-100">
                  <td class="p-3 font-medium">Capacit√© max projet</td>
                  <td class="p-3 font-bold text-blue-700" id="analyse-capacite">
                    --
                  </td>
                  <td class="p-3 text-green-700">üü¢ Adapt√©e √† votre profil</td>
                </tr>
                <tr>
                  <td class="p-3 font-medium">Dur√©e optimale</td>
                  <td class="p-3 font-bold text-blue-700" id="analyse-duree">
                    --
                  </td>
                  <td class="p-3 text-blue-700">‚öñÔ∏è √âquilibr√©e</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- üìä Indicateur risque bancaire -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üìä Risque bancaire estim√©
          </h2>
          <div class="mb-4">
            <div class="flex justify-between mb-2">
              <span class="text-sm font-medium text-gray-700"
                >Score de solvabilit√©</span
              >
              <span id="risque-score" class="text-lg font-bold">--</span>
            </div>
            <div class="relative h-10 bg-gray-200 rounded-lg overflow-hidden">
              <div
                class="absolute inset-0"
                style="
                  background: linear-gradient(
                    to right,
                    #10b981 0%,
                    #10b981 40%,
                    #f59e0b 40%,
                    #f59e0b 70%,
                    #ef4444 70%,
                    #ef4444 100%
                  );
                "
              ></div>
              <div
                id="risque-position"
                class="absolute top-0 bottom-0 w-2 bg-black border-2 border-white rounded transition-all duration-500"
                style="left: 0%"
              ></div>
            </div>
            <!-- L√©gende dynamique (une seule zone selon le score) -->
            <div
              id="legende-risque"
              class="mt-2 text-sm font-semibold text-center"
            >
              <span class="text-gray-500"
                >Calculez pour voir votre √©valuation</span
              >
            </div>
          </div>
          <div id="risque-message" class="p-4 rounded-lg bg-gray-50">
            <p class="text-sm text-gray-700">
              Calculez votre capacit√© pour voir l'√©valuation de votre profil.
            </p>
          </div>
        </div>

        <!-- üìä Multi-dur√©e automatique -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-2">
            üìä Comparaison automatique multi-dur√©es
          </h2>
          <p class="text-sm text-gray-600 mb-2">
            Pour le m√™me projet immobilier, voici comment √©voluent vos
            mensualit√©s et le co√ªt total selon la dur√©e choisie.
          </p>
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
            <p class="text-xs text-blue-800">
              <strong>‚ÑπÔ∏è Pourquoi la mensualit√© reste identique ?</strong> Elle
              correspond √† votre capacit√© maximale (35% d'endettement). La dur√©e
              influence uniquement le montant total empruntable, pas la
              mensualit√© maximale que vous pouvez supporter.
            </p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm table-capacite">
              <thead>
                <tr class="text-left bg-gray-100">
                  <th class="p-3 rounded-tl-lg">Dur√©e</th>
                  <th class="p-3">Mensualit√© estim√©e</th>
                  <th class="p-3">Co√ªt total du cr√©dit</th>
                  <th class="p-3">Int√©r√™ts totaux</th>
                  <th class="p-3 rounded-tr-lg">Capacit√© max</th>
                </tr>
              </thead>
              <tbody id="tableau-multi-duree">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- üí∞ Simulation apport -->
        <div
          class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg shadow-lg p-6 border border-green-200"
        >
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üí∞ Et si vous augmentiez votre apport ?
          </h2>
          <p class="text-sm text-gray-600 mb-4">
            D√©couvrez l'impact d'un apport suppl√©mentaire sur votre mensualit√©
            et votre co√ªt total. M√™me un petit apport peut faire une grande
            diff√©rence.
          </p>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <button
              onclick="simulerApport(0)"
              class="p-4 bg-white rounded-lg shadow border-2 border-transparent hover:border-green-500 transition-all text-center"
              id="btn-apport-0"
            >
              <p class="text-sm text-gray-600">Sans apport</p>
              <p class="text-lg font-bold text-gray-900 mt-1">0 ‚Ç¨</p>
            </button>
            <button
              onclick="simulerApport(10000)"
              class="p-4 bg-white rounded-lg shadow border-2 border-transparent hover:border-green-500 transition-all text-center"
              id="btn-apport-10k"
            >
              <p class="text-sm text-gray-600">Apport de</p>
              <p class="text-lg font-bold text-green-700 mt-1">10 000 ‚Ç¨</p>
            </button>
            <button
              onclick="simulerApport(20000)"
              class="p-4 bg-white rounded-lg shadow border-2 border-transparent hover:border-green-500 transition-all text-center"
              id="btn-apport-20k"
            >
              <p class="text-sm text-gray-600">Apport de</p>
              <p class="text-lg font-bold text-green-700 mt-1">20 000 ‚Ç¨</p>
            </button>
          </div>
          <div id="resultat-apport" class="hidden p-4 bg-white rounded-lg">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
              <div>
                <p class="text-sm text-gray-600">Mensualit√© r√©duite de</p>
                <p
                  class="text-xl font-bold text-green-700"
                  id="apport-economie-mensualite"
                >
                  --
                </p>
              </div>
              <div>
                <p class="text-sm text-gray-600">√âconomie totale</p>
                <p
                  class="text-xl font-bold text-green-700"
                  id="apport-economie-totale"
                >
                  --
                </p>
              </div>
              <div>
                <p class="text-sm text-gray-600">Nouvelle capacit√©</p>
                <p
                  class="text-xl font-bold text-blue-700"
                  id="apport-nouvelle-capacite"
                >
                  --
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Graphique dur√©e vs capacit√© -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-2">
            üìà Impact de la dur√©e sur votre capacit√© d'emprunt
          </h2>
          <p class="text-sm text-gray-600 mb-4">
            Visualisez comment la dur√©e du pr√™t influence le montant maximal que
            vous pouvez emprunter avec vos revenus actuels.
          </p>
          <div class="h-64 md:h-80">
            <canvas id="graphique-capacite"></canvas>
          </div>
          <div class="mt-4 grid grid-cols-3 gap-4 text-center text-sm">
            <div class="p-3 bg-blue-50 rounded-lg">
              <p class="font-semibold text-blue-900" id="capacite-15ans">--</p>
              <p class="text-xs text-gray-600">15 ans</p>
            </div>
            <div class="p-3 bg-blue-50 rounded-lg">
              <p class="font-semibold text-blue-900" id="capacite-20ans">--</p>
              <p class="text-xs text-gray-600">20 ans</p>
            </div>
            <div class="p-3 bg-blue-50 rounded-lg">
              <p class="font-semibold text-blue-900" id="capacite-25ans">--</p>
              <p class="text-xs text-gray-600">25 ans</p>
            </div>
          </div>
        </div>

        <!-- Tableau Quel salaire pour... avec texte SEO (en bas pour longue tra√Æne) -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-2">
            üí∂ Quel salaire pour emprunter ? Tableau comparatif
          </h2>
          <div
            class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded-r-lg"
          >
            <p class="text-sm text-blue-800">
              <strong>Comment lire ce tableau :</strong> Pour emprunter un
              montant donn√© (colonne de gauche), sur une dur√©e sp√©cifique, avec
              un endettement maximal de 35%, vous avez besoin du revenu net
              mensuel indiqu√©. Ces estimations sont bas√©es sur un taux indicatif
              de 4% hors assurance.
            </p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm table-capacite">
              <thead>
                <tr class="text-left">
                  <th class="p-3 rounded-tl-lg">Montant √† emprunter</th>
                  <th class="p-3">Sur 15 ans</th>
                  <th class="p-3">Sur 20 ans</th>
                  <th class="p-3 rounded-tr-lg">Sur 25 ans</th>
                </tr>
              </thead>
              <tbody id="tableau-salaire-corps">
                <!-- G√©n√©r√© dynamiquement -->
              </tbody>
            </table>
          </div>
          <div class="mt-4 p-4 bg-gray-50 rounded-lg">
            <h3 class="font-semibold text-gray-800 mb-2">üìå Exemple concret</h3>
            <p class="text-sm text-gray-600">
              Pour emprunter <strong>200 000 ‚Ç¨ sur 20 ans</strong> √† 4%, avec un
              endettement maximal de 35%, un revenu net mensuel d'environ
              <strong>3 500 ‚Ç¨</strong> est recommand√© sans charges existantes.
              Avec 500 ‚Ç¨ de charges mensuelles, ce montant passe √†
              <strong>4 500 ‚Ç¨</strong>.
            </p>
          </div>
          <p class="text-xs text-gray-500 mt-3">
            * Estimation bas√©e sur un taux de 4% et un endettement de 35%. Hors
            assurance et charges existantes.
          </p>
        </div>
      </div>

      <!-- Comparaison de sc√©narios -->
      <div class="mt-8 flex justify-center gap-3">
        <button
          id="pret-add-to-compare"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold shadow-md transition-colors"
        >
          ‚ûï Ajouter √† la comparaison
        </button>
        <button
          id="pret-reset-compare"
          class="px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 font-semibold shadow-md transition-colors hidden"
        >
          üîÑ R√©initialiser
        </button>
      </div>
      <div id="pret-comparaison" class="hidden mt-8"></div>

      <!-- Blocs longue tra√Æne strat√©giques -->
      <section class="mt-16 space-y-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-8">
          üìä Combien pouvez-vous emprunter ? Guide complet
        </h2>

        <!-- H2 d√©di√© : Quel salaire pour 150 000 ‚Ç¨ -->
        <div class="bg-white rounded-lg shadow-lg p-8">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üí∂ Quel salaire pour emprunter 150 000 ‚Ç¨ ?
          </h2>
          <p class="text-gray-600 mb-4">
            Pour emprunter <strong>150 000 ‚Ç¨</strong>, le salaire n√©cessaire
            d√©pend principalement de la dur√©e du pr√™t et de vos charges
            existantes. Sur 20 ans √† 4%, la mensualit√© s'√©l√®ve √† environ
            <strong>908 ‚Ç¨ hors assurance</strong>. Avec un taux d'endettement
            maximal de 35%, il vous faut un
            <strong>revenu net mensuel d'environ 2 600 ‚Ç¨</strong> sans autres
            charges.
          </p>
          <div class="bg-gray-50 rounded-lg p-4 mb-4">
            <h3 class="font-semibold text-gray-800 mb-2">
              D√©tail du calcul par dur√©e :
            </h3>
            <ul class="text-gray-700 space-y-2 text-sm">
              <li>
                ‚Ä¢ <strong>15 ans :</strong> Mensualit√© ~1 108 ‚Ç¨ ‚Üí Revenu
                n√©cessaire ~3 200 ‚Ç¨ (sans charges)
              </li>
              <li>
                ‚Ä¢ <strong>20 ans :</strong> Mensualit√© ~908 ‚Ç¨ ‚Üí Revenu
                n√©cessaire ~2 600 ‚Ç¨ (sans charges)
              </li>
              <li>
                ‚Ä¢ <strong>25 ans :</strong> Mensualit√© ~788 ‚Ç¨ ‚Üí Revenu
                n√©cessaire ~2 300 ‚Ç¨ (sans charges)
              </li>
            </ul>
          </div>
          <p class="text-sm text-gray-500">
            Ce montant correspond g√©n√©ralement √† l'achat d'un appartement T2/T3
            en province ou d'un studio dans les grandes villes.
          </p>
        </div>

        <!-- H2 d√©di√© : Quel salaire pour 200 000 ‚Ç¨ -->
        <div class="bg-white rounded-lg shadow-lg p-8">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üí∂ Quel salaire pour emprunter 200 000 ‚Ç¨ ?
          </h2>
          <p class="text-gray-600 mb-4">
            Le seuil des <strong>200 000 ‚Ç¨</strong> repr√©sente le budget moyen
            pour l'achat d'une premi√®re r√©sidence principale en France. √Ä ce
            niveau, sur 20 ans √† 4%, la mensualit√© se situe autour de
            <strong>1 210 ‚Ç¨ hors assurance</strong>. Pour respecter le plafond
            d'endettement de 35%, il faut viser un
            <strong>revenu net mensuel d'environ 3 500 ‚Ç¨</strong> sans charges
            pr√©existantes.
          </p>
          <div class="bg-gray-50 rounded-lg p-4 mb-4">
            <h3 class="font-semibold text-gray-800 mb-2">
              D√©tail du salaire n√©cessaire :
            </h3>
            <ul class="text-gray-700 space-y-2 text-sm">
              <li>
                ‚Ä¢ <strong>Sans charges :</strong> Revenu de
                <strong>3 500 ‚Ç¨</strong> minimum (endettement 35%)
              </li>
              <li>
                ‚Ä¢ <strong>Avec 500 ‚Ç¨ de charges :</strong> Revenu de
                <strong>4 500 ‚Ç¨</strong> requis
              </li>
              <li>
                ‚Ä¢ <strong>Option 25 ans (taux 4,2%) :</strong> Mensualit√©
                r√©duite √† ~1 080 ‚Ç¨ ‚Üí Revenu suffisant de ~3 100 ‚Ç¨
              </li>
            </ul>
          </div>
          <p class="text-sm text-gray-500">
            Avec 200 000 ‚Ç¨, vous pouvez viser une maison de 80-100m¬≤ en r√©gion
            ou un trois-pi√®ces en proche banlieue des grandes m√©tropoles.
          </p>
        </div>

        <!-- H2 d√©di√© : Quel salaire pour 250 000 ‚Ç¨ -->
        <div class="bg-white rounded-lg shadow-lg p-8">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üí∂ Quel salaire pour emprunter 250 000 ‚Ç¨ ?
          </h2>
          <p class="text-gray-600 mb-4">
            Un budget de <strong>250 000 ‚Ç¨</strong> ouvre les portes de biens
            plus spacieux, id√©aux pour une famille. Sur une dur√©e classique de
            20 ans √† 4%, pr√©voyez une mensualit√© d'environ
            <strong>1 515 ‚Ç¨ hors assurance</strong>. Le revenu net mensuel
            conseill√© se situe alors autour de <strong>4 300 ‚Ç¨</strong> sans
            autres cr√©dits en cours.
          </p>
          <div class="bg-gray-50 rounded-lg p-4 mb-4">
            <h3 class="font-semibold text-gray-800 mb-2">
              Combien faut-il gagner ?
            </h3>
            <ul class="text-gray-700 space-y-2 text-sm">
              <li>
                ‚Ä¢ <strong>Sans cr√©dit en cours :</strong> Revenu d'au moins
                <strong>4 300 ‚Ç¨</strong>
              </li>
              <li>
                ‚Ä¢ <strong>Avec 500 ‚Ç¨ de charges mensuelles :</strong> Revenu de
                <strong>5 400 ‚Ç¨</strong> n√©cessaire
              </li>
              <li>
                ‚Ä¢ <strong>Sur 25 ans (taux 4,2%) :</strong> Mensualit√© ~1 350 ‚Ç¨
                ‚Üí Revenu minimal de ~3 850 ‚Ç¨
              </li>
            </ul>
          </div>
          <p class="text-sm text-gray-500">
            Cette enveloppe budg√©taire permet d'acqu√©rir une belle maison avec
            terrain en r√©gion ou un appartement familial en p√©riph√©rie des
            grandes agglom√©rations.
          </p>
        </div>

        <!-- H2 d√©di√© : Capacit√© avec 2000 ‚Ç¨ net par mois -->
        <div class="bg-white rounded-lg shadow-lg p-8">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üíµ Quelle capacit√© d'emprunt avec 2 000 ‚Ç¨ net par mois ?
          </h2>
          <p class="text-gray-600 mb-4">
            Avec un <strong>salaire net de 2 000 ‚Ç¨ par mois</strong> et sans
            charges existantes, votre capacit√© d'emprunt maximale se situe
            autour de <strong>105 000 ‚Ç¨ sur 20 ans</strong> (taux indicatif 4%).
            La mensualit√© maximale que vous pouvez supporter est d'environ
            <strong>700 ‚Ç¨</strong>
            (35% d'endettement).
          </p>
          <div class="grid md:grid-cols-3 gap-4 text-sm">
            <div class="bg-blue-50 p-4 rounded-lg text-center">
              <p class="text-gray-600 mb-1">15 ans</p>
              <p class="text-xl font-bold text-blue-700">~85 000 ‚Ç¨</p>
              <p class="text-xs text-gray-500 mt-1">Mensualit√© ~700 ‚Ç¨</p>
            </div>
            <div class="bg-blue-50 p-4 rounded-lg text-center">
              <p class="text-gray-600 mb-1">20 ans</p>
              <p class="text-xl font-bold text-blue-700">~105 000 ‚Ç¨</p>
              <p class="text-xs text-gray-500 mt-1">Mensualit√© ~700 ‚Ç¨</p>
            </div>
            <div class="bg-blue-50 p-4 rounded-lg text-center">
              <p class="text-gray-600 mb-1">25 ans</p>
              <p class="text-xl font-bold text-blue-700">~125 000 ‚Ç¨</p>
              <p class="text-xs text-gray-500 mt-1">Mensualit√© ~700 ‚Ç¨</p>
            </div>
          </div>
          <p class="text-sm text-gray-500 mt-4">
            üí° <strong>Conseil :</strong> Avec 2 000 ‚Ç¨/mois, privil√©giez une
            dur√©e plus longue (25 ans) pour maximiser votre capacit√© et viser un
            bien plus cons√©quent.
          </p>
        </div>

        <!-- H2 d√©di√© : Capacit√© avec 3000 ‚Ç¨ net par mois -->
        <div class="bg-white rounded-lg shadow-lg p-8">
          <h2 class="text-xl font-bold text-gray-900 mb-4">
            üíµ Quelle capacit√© d'emprunt avec 3 000 ‚Ç¨ net par mois ?
          </h2>
          <p class="text-gray-600 mb-4">
            Avec un <strong>revenu net de 3 000 ‚Ç¨ mensuels</strong>, vous entrez
            dans la cat√©gorie des emprunteurs confortables. Votre capacit√©
            maximale atteint environ <strong>165 000 ‚Ç¨ sur 20 ans</strong>, avec
            une mensualit√© maximale d'environ <strong>1 050 ‚Ç¨</strong> (35%
            d'endettement).
          </p>
          <div class="grid md:grid-cols-3 gap-4 text-sm">
            <div class="bg-green-50 p-4 rounded-lg text-center">
              <p class="text-gray-600 mb-1">15 ans</p>
              <p class="text-xl font-bold text-green-700">~128 000 ‚Ç¨</p>
              <p class="text-xs text-gray-500 mt-1">Mensualit√© ~1 050 ‚Ç¨</p>
            </div>
            <div class="bg-green-50 p-4 rounded-lg text-center">
              <p class="text-gray-600 mb-1">20 ans</p>
              <p class="text-xl font-bold text-green-700">~165 000 ‚Ç¨</p>
              <p class="text-xs text-gray-500 mt-1">Mensualit√© ~1 050 ‚Ç¨</p>
            </div>
            <div class="bg-green-50 p-4 rounded-lg text-center">
              <p class="text-gray-600 mb-1">25 ans</p>
              <p class="text-xl font-bold text-green-700">~195 000 ‚Ç¨</p>
              <p class="text-xs text-gray-500 mt-1">Mensualit√© ~1 050 ‚Ç¨</p>
            </div>
          </div>
          <p class="text-sm text-gray-500 mt-4">
            üí° <strong>Conseil :</strong> Avec 3 000 ‚Ç¨/mois, vous pouvez viser
            un bien de 150 000-200 000 ‚Ç¨ selon la dur√©e, ce qui ouvre de belles
            opportunit√©s sur le march√© immobilier actuel.
          </p>
        </div>

        <!-- Capacit√© avec 4000 ‚Ç¨ et 5000 ‚Ç¨ (compl√©ment) -->
        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-lg font-bold text-gray-900 mb-4">
              üíµ Avec 4 000 ‚Ç¨ net/mois
            </h2>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between p-2 bg-purple-50 rounded">
                <span>Sur 15 ans</span>
                <span class="font-bold">~170 000 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-purple-50 rounded">
                <span>Sur 20 ans</span>
                <span class="font-bold">~220 000 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-purple-50 rounded">
                <span>Sur 25 ans</span>
                <span class="font-bold">~260 000 ‚Ç¨</span>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-lg font-bold text-gray-900 mb-4">
              üíµ Avec 5 000 ‚Ç¨ net/mois
            </h2>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between p-2 bg-indigo-50 rounded">
                <span>Sur 15 ans</span>
                <span class="font-bold">~215 000 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-indigo-50 rounded">
                <span>Sur 20 ans</span>
                <span class="font-bold">~275 000 ‚Ç¨</span>
              </div>
              <div class="flex justify-between p-2 bg-indigo-50 rounded">
                <span>Sur 25 ans</span>
                <span class="font-bold">~325 000 ‚Ç¨</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- FAQ -->
      <section class="mt-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">
          ‚ùì Questions fr√©quentes sur la capacit√© d'emprunt
        </h2>
        <div class="space-y-4">
          <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">
              Quel salaire pour emprunter 200 000 ‚Ç¨ ?
            </h3>
            <p class="text-gray-600">
              Pour emprunter 200 000 ‚Ç¨ sur 20 ans √† 4%, la mensualit√© est
              d'environ 1 210 ‚Ç¨. Avec un taux d'endettement de 35%, il faut
              g√©n√©ralement un
              <strong>revenu net mensuel d'environ 3 500 ‚Ç¨</strong> sans autres
              charges.
            </p>
          </div>
          <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">
              Quelle est la capacit√© d'emprunt avec 3 000 ‚Ç¨ net par mois ?
            </h3>
            <p class="text-gray-600">
              Avec 3 000 ‚Ç¨ nets mensuels et sans autre cr√©dit, votre capacit√©
              d'emprunt peut se situer autour de
              <strong>165 000 ‚Ç¨ sur 20 ans</strong> (taux 4%) ou 195 000 ‚Ç¨ sur
              25 ans.
            </p>
          </div>
          <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">
              Quel est le taux d'endettement maximum en 2026 ?
            </h3>
            <p class="text-gray-600">
              Les banques appliquent g√©n√©ralement un taux d'endettement maximum
              de <strong>35% assurance incluse</strong>. Ce seuil peut √™tre
              d√©pass√© pour les primo-acc√©dants avec un bon reste √† vivre.
            </p>
          </div>
        </div>
      </section>

      <!-- Maillage interne -->
      <section class="mt-16">
        <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-3">
            üîó Voir aussi - Parcours immobilier complet
          </h3>
          <div class="flex flex-wrap gap-3">
            <a
              href="/pages/financement.html"
              class="inline-block bg-blue-50 border border-blue-200 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-100"
              >üí≥ Financement personnel</a
            >
            <a
              href="/pages/notaire.html"
              class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
              >‚öñÔ∏è Frais de notaire</a
            >
            <a
              href="/pages/apl.html"
              class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
              >üè† APL 2026</a
            >
            <a
              href="/pages/taxe.html"
              class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
              >üè† Taxe fonci√®re</a
            >
            <a
              href="/pages/charges.html"
              class="inline-block bg-white border border-gray-300 rounded px-3 py-2 text-sm text-blue-700 hover:bg-blue-50"
              >üè¢ Charges de copropri√©t√©</a
            >
          </div>
        </div>
      </section>
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <p class="text-gray-300">
          ¬© 2026 Les Calculateurs - Simulateur capacit√© d'emprunt immobilier
        </p>
      </div>
    </footer>

    <script type="module" src="../main.ts"></script>
    <script type="module">
      import { CalculatorFrame } from "../components/CalculatorFrame.ts";
      import { formatCurrency } from "../main.ts";

      let chartInstance = null;

      // Configuration du calculateur
      const pretConfig = {
        title: "Simulateur de capacit√© d'emprunt immobilier 2026",
        description:
          "Calculez votre capacit√© d'emprunt maximale selon vos revenus, charges et taux d'endettement indicatif (~35%)",
        fields: [
          {
            id: "revenus_emprunteur1",
            label: "Revenus mensuels nets emprunteur 1 (‚Ç¨) *",
            type: "number",
            required: true,
            placeholder: "3500",
            min: 1000,
            max: 50000,
            step: 100,
          },
          {
            id: "revenus_emprunteur2",
            label: "Revenus mensuels nets emprunteur 2 (‚Ç¨)",
            type: "number",
            placeholder: "0",
            min: 0,
            max: 50000,
            step: 100,
          },
          {
            id: "charges_mensuelles",
            label: "Charges mensuelles existantes (‚Ç¨)",
            type: "number",
            placeholder: "0",
            min: 0,
            max: 50000,
            step: 50,
          },
          {
            id: "duree",
            label: "Dur√©e du pr√™t envisag√©e *",
            type: "select",
            required: true,
            options: [
              { value: "10", label: "10 ans" },
              { value: "15", label: "15 ans" },
              { value: "20", label: "20 ans" },
              { value: "25", label: "25 ans" },
              { value: "30", label: "30 ans" },
            ],
          },
          {
            id: "taux_nominal",
            label: "Taux d'int√©r√™t nominal estim√© (%/an) *",
            type: "number",
            required: true,
            placeholder: "4.0",
            min: 0.1,
            max: 15,
            step: 0.1,
          },
          {
            id: "assurance_taux",
            label: "Taux d'assurance emprunteur (%/an)",
            type: "number",
            placeholder: "0.36",
            min: 0,
            max: 2,
            step: 0.01,
          },
        ],
        calculate: (values) => {
          try {
            // Helper pour convertir les nombres (gerer virgule et point)
            const parseNumber = (val) => {
              if (typeof val === "number") return val;
              if (!val) return 0;
              return Number(String(val).replace(",", ".")) || 0;
            };

            const dureeAnnees = parseInt(values.duree) || 20;
            const dureeMois = dureeAnnees * 12;
            const tauxNominal = parseNumber(values.taux_nominal) / 100;
            const tauxMensuel = tauxNominal / 12;
            const revenusMensuels =
              parseNumber(values.revenus_emprunteur1) +
              parseNumber(values.revenus_emprunteur2);
            const chargesMensuelles = parseNumber(values.charges_mensuelles);
            const tauxAssurance = parseNumber(values.assurance_taux) / 100;

            if (revenusMensuels <= 0) {
              return {
                success: false,
                error: "Veuillez saisir des revenus mensuels valides.",
              };
            }

            // Validation des bornes r√©alistes
            if (revenusMensuels > 100000) {
              return {
                success: false,
                error:
                  "Les revenus mensuels ne peuvent pas d√©passer 100 000 ‚Ç¨. Veuillez v√©rifier votre saisie.",
              };
            }
            if (chargesMensuelles > 50000) {
              return {
                success: false,
                error:
                  "Les charges mensuelles ne peuvent pas d√©passer 50 000 ‚Ç¨. Veuillez v√©rifier votre saisie.",
              };
            }
            if (tauxNominal * 100 > 15) {
              return {
                success: false,
                error:
                  "Le taux d'int√©r√™t ne peut pas d√©passer 15%. Veuillez v√©rifier votre saisie.",
              };
            }

            // Calcul capacit√©
            const tauxEndettementMax = 35;
            const mensualiteMax = Math.max(
              0,
              (revenusMensuels * tauxEndettementMax) / 100 - chargesMensuelles,
            );

            const coefficientAmortissement =
              tauxMensuel > 0
                ? (tauxMensuel * Math.pow(1 + tauxMensuel, dureeMois)) /
                  (Math.pow(1 + tauxMensuel, dureeMois) - 1)
                : 1 / dureeMois;
            const coefficientAssurance = tauxAssurance / 12;
            const coefficientTotal =
              coefficientAmortissement + coefficientAssurance;
            const capaciteEmprunt =
              coefficientTotal > 0 ? mensualiteMax / coefficientTotal : 0;
            const resteAVivre =
              revenusMensuels - chargesMensuelles - mensualiteMax;
            const tauxEndettementReel =
              ((mensualiteMax + chargesMensuelles) / revenusMensuels) * 100;

            // Verifier les valeurs invalides
            if (!isFinite(capaciteEmprunt) || isNaN(capaciteEmprunt)) {
              return {
                success: false,
                error: "Erreur de calcul. Verifiez vos valeurs (taux, duree).",
              };
            }

            // Calculs pour diff√©rentes dur√©es (pour le graphique)
            const capacitesParDuree = {};
            [15, 20, 25].forEach((duree) => {
              const mois = duree * 12;
              const coeff =
                tauxMensuel > 0
                  ? (tauxMensuel * Math.pow(1 + tauxMensuel, mois)) /
                    (Math.pow(1 + tauxMensuel, mois) - 1)
                  : 1 / mois;
              const coeffTotal = coeff + coefficientAssurance;
              capacitesParDuree[duree] = mensualiteMax / coeffTotal;
            });

            return {
              success: true,
              data: {
                revenusMensuels,
                chargesMensuelles,
                dureeAnnees,
                tauxNominal: tauxNominal * 100,
                tauxAssurance: tauxAssurance * 100,
                tauxEndettementMax,
                mensualiteMax,
                capaciteEmprunt,
                resteAVivre,
                tauxEndettementReel,
                capacitesParDuree,
              },
            };
          } catch (error) {
            return { success: false, error: "Erreur dans le calcul" };
          }
        },
        formatResult: (result) => {
          if (!result || !result.success || !result.data) {
            return '<div class="p-4 bg-red-50 text-red-700 rounded-lg">Erreur lors du calcul. Veuillez verifier vos donnees.</div>';
          }
          const d = result.data;

          // Mettre a jour les resultats avances
          const resultatsAvances = document.getElementById("resultats-avances");
          if (resultatsAvances) resultatsAvances.classList.remove("hidden");

          // Indicateur d'endettement
          const tauxEndettement = Math.min(d.tauxEndettementReel, 50);
          document.getElementById("taux-endettement-valeur").textContent =
            d.tauxEndettementReel.toFixed(1) + "%";
          document.getElementById("indicateur-position").style.left =
            tauxEndettement * 2 + "%";

          let messageEndettement = "";
          let couleurMessage = "";
          if (d.tauxEndettementReel < 30) {
            messageEndettement =
              "üü¢ <strong>Endettement confortable</strong> : Votre situation est saine. Vous avez de la marge pour votre projet.";
            couleurMessage = "bg-green-50 border-green-200";
          } else if (d.tauxEndettementReel <= 35) {
            messageEndettement =
              "üü° <strong>Endettement √† la limite</strong> : Votre taux d'endettement se situe √† la limite des recommandations bancaires (35%).";
            couleurMessage = "bg-yellow-50 border-yellow-200";
          } else {
            messageEndettement =
              "üî¥ <strong>Endettement √©lev√©</strong> : Votre dossier pourrait √™tre refus√© ou n√©cessiter un apport plus important.";
            couleurMessage = "bg-red-50 border-red-200";
          }
          const msgDiv = document.getElementById("endettement-message");
          msgDiv.className = `p-4 rounded-lg border ${couleurMessage}`;
          msgDiv.innerHTML = `<p class="text-sm">${messageEndettement}</p><p class="text-xs mt-2 text-gray-600">Reste √† vivre estim√© : ${formatCurrency(d.resteAVivre)}/mois</p>`;

          // Mettre √† jour les valeurs du graphique
          document.getElementById("capacite-15ans").textContent =
            formatCurrency(d.capacitesParDuree[15]);
          document.getElementById("capacite-20ans").textContent =
            formatCurrency(d.capacitesParDuree[20]);
          document.getElementById("capacite-25ans").textContent =
            formatCurrency(d.capacitesParDuree[25]);

          // G√©n√©rer le graphique
          genererGraphique(d.capacitesParDuree);

          // G√©n√©rer le tableau "Quel salaire pour..."
          genererTableauSalaire(d.tauxNominal / 100, d.tauxAssurance / 100);

          // PHASE 2 : Fonctions avancees avec protection
          try {
            genererAnalyseBancaire(d);
            genererTableauMultiDuree(d);
            genererIndicateurRisque(d);
            configurerSimulationApport(d);
          } catch (e) {
            console.error("Erreur fonction avancee:", e);
          }

          return `
          <div class="space-y-6">
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-6 border border-green-200">
              <h3 class="text-xl font-bold text-green-900 mb-4">üéØ Votre capacit√© d'emprunt estim√©e</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white rounded-lg p-4 text-center shadow-sm">
                  <p class="text-sm text-gray-600 mb-1">Capacit√© maximale</p>
                  <p class="text-3xl font-bold text-green-700">${formatCurrency(d.capaciteEmprunt)}</p>
                  <p class="text-xs text-gray-500 mt-1">sur ${d.dureeAnnees} ans</p>
                </div>
                <div class="bg-white rounded-lg p-4 text-center shadow-sm">
                  <p class="text-sm text-gray-600 mb-1">Mensualit√© maximale</p>
                  <p class="text-2xl font-bold text-blue-700">${formatCurrency(d.mensualiteMax)}</p>
                  <p class="text-xs text-gray-500 mt-1">endettement ${d.tauxEndettementMax}%</p>
                </div>
              </div>
            </div>
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
              <p class="text-sm text-blue-800">
                <strong>üìä D√©tails :</strong> Revenus ${formatCurrency(d.revenusMensuels)} ‚Ä¢ Charges ${formatCurrency(d.chargesMensuelles)} ‚Ä¢ Reste √† vivre ${formatCurrency(d.resteAVivre)}
              </p>
            </div>
          </div>
          `;
        },
      };

      // Fonction pour g√©n√©rer le graphique
      function genererGraphique(capacites) {
        const canvas = document.getElementById("graphique-capacite");
        if (!canvas || typeof Chart === "undefined") {
          console.warn("Chart.js non disponible");
          return;
        }
        const ctx = canvas.getContext("2d");

        if (chartInstance) {
          chartInstance.destroy();
        }

        chartInstance = new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["15 ans", "20 ans", "25 ans"],
            datasets: [
              {
                label: "Capacit√© d'emprunt",
                data: [capacites[15], capacites[20], capacites[25]],
                backgroundColor: ["#3b82f6", "#10b981", "#8b5cf6"],
                borderRadius: 8,
                borderWidth: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return formatCurrency(context.raw);
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value / 1000 + "k‚Ç¨";
                  },
                },
              },
            },
          },
        });
      }

      // Fonction pour g√©n√©rer le tableau "Quel salaire pour..."
      function genererTableauSalaire(tauxNominal, tauxAssurance) {
        const montants = [150000, 200000, 250000];
        const durees = [15, 20, 25];
        const tbody = document.getElementById("tableau-salaire-corps");

        let html = "";
        montants.forEach((montant) => {
          html += "<tr>";
          html += `<td class="p-3 font-medium">${formatCurrency(montant)}</td>`;

          durees.forEach((duree) => {
            const mois = duree * 12;
            const tauxMensuel = tauxNominal / 12;
            const coeff =
              tauxMensuel > 0
                ? (tauxMensuel * Math.pow(1 + tauxMensuel, mois)) /
                  (Math.pow(1 + tauxMensuel, mois) - 1)
                : 1 / mois;
            const coeffAssurance = tauxAssurance / 12;
            const mensualite = montant * (coeff + coeffAssurance);
            const salaireNecessaire = mensualite / 0.35;

            html += `<td class="p-3">~${formatCurrency(salaireNecessaire)}</td>`;
          });

          html += "</tr>";
        });

        tbody.innerHTML = html;
      }

      // PHASE 2 : Analyse bancaire avancee
      function genererAnalyseBancaire(d) {
        const resteAVivreParPersonne = d.resteAVivre / 2;
        const ratioCharges = (d.chargesMensuelles / d.revenusMensuels) * 100;

        // Score credit (0-100)
        let scoreCredit = 50;
        if (d.tauxEndettementReel < 25) scoreCredit += 20;
        else if (d.tauxEndettementReel > 35) scoreCredit -= 20;
        if (resteAVivreParPersonne > 800) scoreCredit += 15;
        else if (resteAVivreParPersonne < 400) scoreCredit -= 15;
        if (ratioCharges < 10) scoreCredit += 10;
        else if (ratioCharges > 20) scoreCredit -= 10;
        scoreCredit = Math.max(0, Math.min(100, scoreCredit));

        let interpretationEndettement, interpretationReste;

        if (d.tauxEndettementReel < 28)
          interpretationEndettement =
            '<span class="text-green-600">OK Excellent</span>';
        else if (d.tauxEndettementReel < 33)
          interpretationEndettement =
            '<span class="text-green-600">OK Correct</span>';
        else if (d.tauxEndettementReel <= 35)
          interpretationEndettement =
            '<span class="text-yellow-600">! Limite</span>';
        else
          interpretationEndettement =
            '<span class="text-red-600">X Trop eleve</span>';

        if (resteAVivreParPersonne >= 800)
          interpretationReste =
            '<span class="text-green-600">OK Confortable</span>';
        else if (resteAVivreParPersonne >= 600)
          interpretationReste = '<span class="text-yellow-600">! Serre</span>';
        else
          interpretationReste = '<span class="text-red-600">X Fragile</span>';

        // Mettre a jour le tableau d'analyse existant
        document.getElementById("analyse-taux").textContent =
          d.tauxEndettementReel.toFixed(1) + "%";
        document.getElementById("analyse-taux-interp").innerHTML =
          interpretationEndettement;
        document.getElementById("analyse-reste").textContent = formatCurrency(
          d.resteAVivre,
        );
        document.getElementById("analyse-reste-interp").innerHTML =
          interpretationReste +
          " (" +
          formatCurrency(resteAVivreParPersonne) +
          "/pers)";
        document.getElementById("analyse-capacite").textContent =
          formatCurrency(d.capaciteEmprunt);
        document.getElementById("analyse-duree").textContent =
          d.dureeAnnees + " ans";
      }

      // PHASE 2 : Tableau multi-durees detaille
      function genererTableauMultiDuree(d) {
        const durees = [15, 20, 25];
        const tauxMensuel = d.tauxNominal / 100 / 12;
        const coeffAssurance = d.tauxAssurance / 100 / 12;
        const tbody = document.getElementById("tableau-multi-duree");

        let html = "";
        durees.forEach((duree) => {
          const mois = duree * 12;
          const coeff =
            tauxMensuel > 0
              ? (tauxMensuel * Math.pow(1 + tauxMensuel, mois)) /
                (Math.pow(1 + tauxMensuel, mois) - 1)
              : 1 / mois;
          const coeffTotal = coeff + coeffAssurance;
          const capacite = d.mensualiteMax / coeffTotal;
          const mensualite = capacite * coeffTotal;
          const coutTotal = mensualite * mois;
          const interetsTotaux = coutTotal - capacite;

          html += '<tr class="hover:bg-gray-50">';
          html += '<td class="p-3 font-medium">' + duree + " ans</td>";
          html +=
            '<td class="p-3 font-bold text-blue-700">' +
            formatCurrency(mensualite) +
            "</td>";
          html +=
            '<td class="p-3 text-orange-600">' +
            formatCurrency(coutTotal) +
            "</td>";
          html +=
            '<td class="p-3 text-red-500">' +
            formatCurrency(interetsTotaux) +
            "</td>";
          html +=
            '<td class="p-3 text-green-700 font-medium">' +
            formatCurrency(capacite) +
            "</td>";
          html += "</tr>";
        });

        tbody.innerHTML = html;
      }

      // PHASE 2 : Indicateur de risque bancaire
      function genererIndicateurRisque(d) {
        const resteAVivre = d.resteAVivre;
        const tauxEndettement = d.tauxEndettementReel;
        const revenusMensuels = d.revenusMensuels;
        const chargesMensuelles = d.chargesMensuelles;

        // Calcul du score de solvabilite (0-100, 100 = excellent)
        // Base: 40 points
        // +15 si endettement < 30%, -15 si > 35%
        // +15 si reste √† vivre > 1000‚Ç¨, -15 si < 600‚Ç¨
        // +10 si ratio charges/revenus < 10%
        // +10 si revenus > 3000‚Ç¨ (stabilit√© per√ßue)
        // +10 si co-emprunteur (2 revenus)
        let scoreSolvabilite = 40;
        let detailsScore = ["Base: 40 points"];

        // Crit√®re endettement
        if (tauxEndettement < 25) {
          scoreSolvabilite += 15;
          detailsScore.push("+15 (endettement < 25%)");
        } else if (tauxEndettement < 30) {
          scoreSolvabilite += 10;
          detailsScore.push("+10 (endettement < 30%)");
        } else if (tauxEndettement > 35) {
          scoreSolvabilite -= 15;
          detailsScore.push("-15 (endettement > 35%)");
        }

        // Crit√®re reste √† vivre
        if (resteAVivre > 1200) {
          scoreSolvabilite += 15;
          detailsScore.push("+15 (reste √† vivre > 1200‚Ç¨)");
        } else if (resteAVivre > 800) {
          scoreSolvabilite += 10;
          detailsScore.push("+10 (reste √† vivre > 800‚Ç¨)");
        } else if (resteAVivre < 600) {
          scoreSolvabilite -= 15;
          detailsScore.push("-15 (reste √† vivre < 600‚Ç¨)");
        }

        // Crit√®re ratio charges existantes
        const ratioChargesExistants =
          (chargesMensuelles / revenusMensuels) * 100;
        if (ratioChargesExistants < 10) {
          scoreSolvabilite += 10;
          detailsScore.push("+10 (charges existantes < 10%)");
        } else if (ratioChargesExistants > 20) {
          scoreSolvabilite -= 5;
          detailsScore.push("-5 (charges existantes > 20%)");
        }

        // Crit√®re stabilit√© revenus
        if (revenusMensuels > 4000) {
          scoreSolvabilite += 10;
          detailsScore.push("+10 (revenus √©lev√©s > 4000‚Ç¨)");
        } else if (revenusMensuels > 2500) {
          scoreSolvabilite += 5;
          detailsScore.push("+5 (revenus confortables > 2500‚Ç¨)");
        }

        // Crit√®re co-emprunteur (d√©tect√© via 2 revenus significatifs)
        const revenuEmprunteur2 = d.revenusMensuels - d.revenusMensuels * 0.7; // Approximation
        if (revenuEmprunteur2 > 500) {
          scoreSolvabilite += 10;
          detailsScore.push("+10 (co-emprunteur d√©tect√©)");
        }

        scoreSolvabilite = Math.max(0, Math.min(100, scoreSolvabilite));

        // Mettre a jour le score
        const scoreEl = document.getElementById("risque-score");
        const positionEl = document.getElementById("risque-position");
        const messageEl = document.getElementById("risque-message");

        if (scoreEl) scoreEl.textContent = scoreSolvabilite + "/100";
        if (positionEl) positionEl.style.left = scoreSolvabilite + "%";

        // Mise √† jour de la l√©gende dynamique (une seule zone)
        const legendeEl = document.getElementById("legende-risque");
        if (legendeEl) {
          if (scoreSolvabilite >= 70) {
            legendeEl.innerHTML =
              '<span class="text-green-600 font-semibold">üü¢ Profil solide (70-100)</span>';
          } else if (scoreSolvabilite >= 50) {
            legendeEl.innerHTML =
              '<span class="text-yellow-600 font-semibold">üü° Profil √† optimiser (50-69)</span>';
          } else {
            legendeEl.innerHTML =
              '<span class="text-red-600 font-semibold">üî¥ Profil fragile (0-49)</span>';
          }
        }

        // Message selon le score
        let message, couleurClass, titre;
        if (scoreSolvabilite >= 70) {
          titre = "üü¢ Profil solide";
          message =
            "Votre dossier devrait √™tre bien re√ßu par les banques. Vous avez une bonne marge de man≈ìuvre.";
          couleurClass = "bg-green-50 text-green-800";
        } else if (scoreSolvabilite >= 50) {
          titre = "üü° Profil √† optimiser";
          message =
            "Votre dossier est recevable mais pourrait √™tre am√©lior√© avec un apport ou une dur√©e ajust√©e.";
          couleurClass = "bg-yellow-50 text-yellow-800";
        } else {
          titre = "üî¥ Profil fragile";
          message =
            "Votre dossier pourrait √™tre difficile √† financer. Envisagez d'augmenter votre apport ou de r√©duire votre projet.";
          couleurClass = "bg-red-50 text-red-800";
        }

        if (messageEl) {
          messageEl.className = "p-4 rounded-lg " + couleurClass;
          messageEl.innerHTML =
            '<p class="font-semibold mb-1">' +
            titre +
            "</p>" +
            '<p class="text-sm mb-2">' +
            message +
            "</p>" +
            '<p class="text-xs opacity-75">Score: ' +
            detailsScore.join(" | ") +
            "</p>";
        }
      }

      // PHASE 2 : Configuration simulation d'apport
      function configurerSimulationApport(d) {
        window.simulationData = {
          capaciteBase: d.capaciteEmprunt,
          mensualiteBase: d.mensualiteMax,
          tauxNominal: d.tauxNominal,
          tauxAssurance: d.tauxAssurance,
          dureeAnnees: d.dureeAnnees,
        };
      }

      // PHASE 2 : Simulation apport (exposer au global)
      window.simulerApport = function (montantApport) {
        const data = window.simulationData;
        if (!data) return;

        // Mettre a jour les boutons
        document
          .getElementById("btn-apport-0")
          .classList.remove("ring-2", "ring-green-500");
        document
          .getElementById("btn-apport-10k")
          .classList.remove("ring-2", "ring-green-500");
        document
          .getElementById("btn-apport-20k")
          .classList.remove("ring-2", "ring-green-500");
        document
          .getElementById(
            "btn-apport-" +
              (montantApport === 0
                ? "0"
                : montantApport === 10000
                  ? "10k"
                  : "20k"),
          )
          .classList.add("ring-2", "ring-green-500");

        // Afficher le resultat
        document.getElementById("resultat-apport").classList.remove("hidden");

        if (montantApport === 0) {
          document.getElementById("apport-economie-mensualite").textContent =
            "0 ‚Ç¨";
          document.getElementById("apport-economie-totale").textContent = "0 ‚Ç¨";
          document.getElementById("apport-nouvelle-capacite").textContent =
            formatCurrency(data.capaciteBase);
          return;
        }

        // Calculer les economies
        // Avec un apport, la capacite augmente (apport * 5 en regle grossiere)
        // Ou la mensualite diminue pour le meme projet
        const mois = data.dureeAnnees * 12;
        const tauxMensuel = data.tauxNominal / 100 / 12;
        const coeffAssurance = data.tauxAssurance / 100 / 12;

        // Reduction de la mensualite si on garde la meme capacite mais avec apport
        const coeff =
          tauxMensuel > 0
            ? (tauxMensuel * Math.pow(1 + tauxMensuel, mois)) /
              (Math.pow(1 + tauxMensuel, mois) - 1)
            : 1 / mois;
        const coeffTotal = coeff + coeffAssurance;

        // Nouvelle capacite avec apport
        const nouvelleCapacite = data.capaciteBase + montantApport * 3; // Multiplicateur effet levier

        // Ou reduction de mensualite pour meme montant
        const economieMensualite = montantApport * coeffTotal;
        const economieTotale = economieMensualite * mois;

        document.getElementById("apport-economie-mensualite").textContent =
          "-" + formatCurrency(economieMensualite) + "/mois";
        document.getElementById("apport-economie-totale").textContent =
          formatCurrency(economieTotale);
        document.getElementById("apport-nouvelle-capacite").textContent =
          formatCurrency(nouvelleCapacite);
      };

      // Initialisation
      new CalculatorFrame("calculator-container", pretConfig);

      // Mobile menu
      document
        .getElementById("mobile-menu-btn")
        ?.addEventListener("click", function () {
          document.getElementById("mobile-menu")?.classList.toggle("hidden");
        });
    </script>
  </body>
</html>
