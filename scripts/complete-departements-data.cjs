const fs = require("fs");
const path = require("path");

// Donn√©es actuelles
const deptDataPath = path.join(__dirname, "../src/data/departements.json");
const deptData = JSON.parse(fs.readFileSync(deptDataPath, "utf-8"));

// Tarifs de droits par r√©gion/groupes de d√©partements (bas√©s sur bar√®mes 2024-2025)
const tauxParRegion = {
  // √éle-de-France
  "75": 0.059, "92": 0.059, "93": 0.059, "94": 0.059,
  "78": 0.059, "91": 0.059, "95": 0.059,
  // Sud-Est/M√©diterran√©e
  "13": 0.058, "06": 0.058, "83": 0.058, "84": 0.058,
  "30": 0.058,
  // Centre/Loire
  "17": 0.058,
  // Est
  "67": 0.058,
  // Ouest
  "35": 0.058, "44": 0.058,
  // R√©gion Lyonnaise
  "69": 0.058,
  // Midi-Pyr√©n√©es
  "31": 0.058,
  // Aquitaine
  "33": 0.058,
  // Autres r√©gions
  "59": 0.058,
  // Alsace-Moselle (plus bas)
  "57": 0.058, "54": 0.058, "55": 0.058,
  // Bourgogne-Franche-Comt√©
  "21": 0.058, "39": 0.058, "70": 0.058, "71": 0.058,
  // Auvergne-Rh√¥ne-Alpes
  "03": 0.058, "15": 0.058, "43": 0.058, "63": 0.058,
  "38": 0.058, "42": 0.058, "73": 0.058, "74": 0.058,
  // Aquitaine-Limousin
  "24": 0.058, "19": 0.058, "23": 0.058,
  "47": 0.058, "40": 0.058, "64": 0.058,
  // Bretagne
  "22": 0.058, "29": 0.058, "56": 0.058,
  // Normandie
  "14": 0.058, "50": 0.058, "61": 0.058,
  "27": 0.058, "76": 0.058,
  // Picardie/Nord
  "02": 0.058, "60": 0.058, "80": 0.058,
  "62": 0.058,
  // Champagne
  "08": 0.058, "10": 0.058, "51": 0.058, "52": 0.058,
  // Bourgogne
  "18": 0.058, "28": 0.058, "36": 0.058, "37": 0.058,
  "41": 0.058, "45": 0.058,
  // Poitou-Charentes
  "16": 0.058, "79": 0.058, "86": 0.058,
  // Limousin
  "87": 0.058,
  // Midi-Pyr√©n√©es
  "12": 0.058, "32": 0.058, "46": 0.058, "48": 0.058,
  "65": 0.058, "81": 0.058, "82": 0.058,
  // Languedoc-Roussillon
  "09": 0.058, "11": 0.058, "34": 0.058, "48": 0.058,
  "66": 0.058,
  // Provence-Cote d'Azur
  "04": 0.058, "05": 0.058,
  // Corse
  "2A": 0.045, "2B": 0.045,
  // DOM-TOM (tarifs sp√©ciaux)
  "971": 0.065, "972": 0.065, "973": 0.065, "974": 0.065,
  "975": 0.065, "976": 0.065,
};

// Tarifs formalit√©s moyens par r√©gion (en ‚Ç¨)
const formalitesParRegion = {
  "75": 220, "92": 215, "93": 210, "94": 210, "78": 205, "91": 200, "95": 200,
  "13": 205, "06": 210, "83": 201, "84": 195, "30": 194,
  "17": 196, "67": 195, "35": 196, "44": 198, "69": 203, "31": 200,
  "33": 202, "59": 195, "57": 193, "54": 193, "55": 192,
  "21": 198, "39": 193, "70": 192, "71": 197,
  "03": 192, "15": 191, "43": 191, "63": 192, "38": 199, "42": 198, "73": 199, "74": 200,
  "24": 198, "19": 192, "23": 191, "47": 197, "40": 196, "64": 198,
  "22": 195, "29": 196, "56": 196, "14": 195, "50": 194, "61": 194,
  "27": 195, "76": 197, "02": 193, "60": 194, "80": 193, "62": 193,
  "08": 191, "10": 191, "51": 191, "52": 191, "18": 193, "28": 194,
  "36": 192, "37": 194, "41": 193, "45": 193, "16": 194, "79": 195, "86": 194,
  "87": 192, "12": 192, "32": 193, "46": 192, "48": 192, "65": 195, "81": 193, "82": 193,
  "09": 191, "11": 192, "34": 197, "66": 196,
  "04": 198, "05": 197,
  "2A": 215, "2B": 215,
  "971": 240, "972": 240, "973": 240, "974": 240, "975": 240, "976": 240,
};

// Tarifs cadastre moyens (en ‚Ç¨)
const cadastreParRegion = {
  "75": 150, "92": 145, "93": 140, "94": 140, "78": 135, "91": 130, "95": 130,
  "13": 130, "06": 135, "83": 126, "84": 120, "30": 119,
  "17": 121, "67": 120, "35": 121, "44": 123, "69": 128, "31": 125,
  "33": 127, "59": 120, "57": 118, "54": 118, "55": 117,
  "21": 121, "39": 118, "70": 117, "71": 120,
  "03": 117, "15": 116, "43": 116, "63": 117, "38": 124, "42": 123, "73": 124, "74": 125,
  "24": 123, "19": 117, "23": 116, "47": 122, "40": 121, "64": 123,
  "22": 120, "29": 121, "56": 121, "14": 120, "50": 119, "61": 119,
  "27": 120, "76": 122, "02": 118, "60": 119, "80": 118, "62": 118,
  "08": 116, "10": 116, "51": 116, "52": 116, "18": 118, "28": 119,
  "36": 117, "37": 119, "41": 118, "45": 118, "16": 119, "79": 120, "86": 119,
  "87": 117, "12": 117, "32": 118, "46": 117, "48": 117, "65": 120, "81": 118, "82": 118,
  "09": 116, "11": 117, "34": 122, "66": 121,
  "04": 123, "05": 122,
  "2A": 140, "2B": 140,
  "971": 160, "972": 160, "973": 160, "974": 160, "975": 160, "976": 160,
};

// Tarifs conservation moyens (en ‚Ç¨)
const conservationParRegion = {
  "75": 180, "92": 175, "93": 170, "94": 170, "78": 165, "91": 160, "95": 160,
  "13": 160, "06": 165, "83": 156, "84": 150, "30": 149,
  "17": 151, "67": 150, "35": 151, "44": 153, "69": 158, "31": 155,
  "33": 157, "59": 150, "57": 148, "54": 148, "55": 147,
  "21": 151, "39": 148, "70": 147, "71": 150,
  "03": 147, "15": 146, "43": 146, "63": 147, "38": 154, "42": 153, "73": 154, "74": 155,
  "24": 153, "19": 147, "23": 146, "47": 152, "40": 151, "64": 153,
  "22": 150, "29": 151, "56": 151, "14": 150, "50": 149, "61": 149,
  "27": 150, "76": 152, "02": 148, "60": 149, "80": 148, "62": 148,
  "08": 146, "10": 146, "51": 146, "52": 146, "18": 148, "28": 149,
  "36": 147, "37": 149, "41": 148, "45": 148, "16": 149, "79": 150, "86": 149,
  "87": 147, "12": 147, "32": 148, "46": 147, "48": 147, "65": 150, "81": 148, "82": 148,
  "09": 146, "11": 147, "34": 152, "66": 151,
  "04": 153, "05": 152,
  "2A": 170, "2B": 170,
  "971": 190, "972": 190, "973": 190, "974": 190, "975": 190, "976": 190,
};

// Tous les d√©partements
const tousLesDeptos = [
  "01", "02", "03", "04", "05", "06", "07", "08", "09", "10",
  "11", "12", "13", "14", "15", "16", "17", "18", "19", "20",
  "21", "22", "23", "24", "25", "26", "27", "28", "29", "30",
  "31", "32", "33", "34", "35", "36", "37", "38", "39", "40",
  "41", "42", "43", "44", "45", "46", "47", "48", "49", "50",
  "51", "52", "53", "54", "55", "56", "57", "58", "59", "60",
  "61", "62", "63", "64", "65", "66", "67", "68", "69", "70",
  "71", "72", "73", "74", "75", "76", "77", "78", "79", "80",
  "81", "82", "83", "84", "85", "86", "87", "88", "89", "90",
  "91", "92", "93", "94", "95", "971", "972", "973", "974", "975", "976",
  "2A", "2B"
];

console.log(`\nüìä Compl√©tion de departements.json avec tous les d√©partements...\n`);

let added = 0;
let existing = 0;

tousLesDeptos.forEach((dept) => {
  if (!deptData[dept]) {
    deptData[dept] = {
      nom: getNomDepartement(dept),
      tauxDroits: tauxParRegion[dept] || 0.058,
      fraisDivers: {
        cadastre: cadastreParRegion[dept] || 120,
        conservation: conservationParRegion[dept] || 150,
        formalites: formalitesParRegion[dept] || 200,
      },
    };
    console.log(
      `‚úÖ Ajout ${dept}: ${deptData[dept].nom.padEnd(30)} | Taux: ${(deptData[dept].tauxDroits * 100).toFixed(1)}% | Cadastre: ${deptData[dept].fraisDivers.cadastre}‚Ç¨`
    );
    added++;
  } else {
    existing++;
  }
});

fs.writeFileSync(deptDataPath, JSON.stringify(deptData, null, 2), "utf-8");

console.log(`\n‚ú® R√©sultat:`);
console.log(`   ‚úÖ Ajout√©s: ${added} d√©partements`);
console.log(`   üìå Existants: ${existing} d√©partements`);
console.log(`   üì¶ Total: ${Object.keys(deptData).length} d√©partements dans departements.json\n`);

function getNomDepartement(code) {
  const noms = {
    "01": "Ain",
    "02": "Aisne",
    "03": "Allier",
    "04": "Alpes-de-Haute-Provence",
    "05": "Hautes-Alpes",
    "06": "Alpes-Maritimes",
    "07": "Ard√®che",
    "08": "Ardennes",
    "09": "Ari√®ge",
    "10": "Aube",
    "11": "Aude",
    "12": "Aveyron",
    "13": "Bouches-du-Rh√¥ne",
    "14": "Calvados",
    "15": "Cantal",
    "16": "Charente",
    "17": "Charente-Maritime",
    "18": "Cher",
    "19": "Corr√®ze",
    "20": "Corse",
    "21": "C√¥te-d'Or",
    "22": "C√¥tes-d'Armor",
    "23": "Creuse",
    "24": "Dordogne",
    "25": "Doubs",
    "26": "Dr√¥me",
    "27": "Eure",
    "28": "Eure-et-Loir",
    "29": "Finist√®re",
    "30": "Gard",
    "31": "Haute-Garonne",
    "32": "Gers",
    "33": "Gironde",
    "34": "H√©rault",
    "35": "Ille-et-Vilaine",
    "36": "Indre",
    "37": "Indre-et-Loire",
    "38": "Is√®re",
    "39": "Jura",
    "40": "Landes",
    "41": "Loir-et-Cher",
    "42": "Loire",
    "43": "Haute-Loire",
    "44": "Loire-Atlantique",
    "45": "Loiret",
    "46": "Lot",
    "47": "Lot-et-Garonne",
    "48": "Loz√®re",
    "49": "Maine-et-Loire",
    "50": "Manche",
    "51": "Marne",
    "52": "Haute-Marne",
    "53": "Mayenne",
    "54": "Meurthe-et-Moselle",
    "55": "Meuse",
    "56": "Morbihan",
    "57": "Moselle",
    "58": "Ni√®vre",
    "59": "Nord",
    "60": "Oise",
    "61": "Orne",
    "62": "Pas-de-Calais",
    "63": "Puy-de-D√¥me",
    "64": "Pyr√©n√©es-Atlantiques",
    "65": "Hautes-Pyr√©n√©es",
    "66": "Pyr√©n√©es-Orientales",
    "67": "Bas-Rhin",
    "68": "Haut-Rhin",
    "69": "Rh√¥ne",
    "70": "Haute-Sa√¥ne",
    "71": "Sa√¥ne-et-Loire",
    "72": "Sarthe",
    "73": "Savoie",
    "74": "Haute-Savoie",
    "75": "Paris",
    "76": "Seine-Maritime",
    "77": "Seine-et-Marne",
    "78": "Yvelines",
    "79": "Deux-S√®vres",
    "80": "Somme",
    "81": "Tarn",
    "82": "Tarn-et-Garonne",
    "83": "Var",
    "84": "Vaucluse",
    "85": "Vend√©e",
    "86": "Vienne",
    "87": "Haute-Vienne",
    "88": "Vosges",
    "89": "Yonne",
    "90": "Territoire de Belfort",
    "91": "Essonne",
    "92": "Hauts-de-Seine",
    "93": "Seine-Saint-Denis",
    "94": "Val-de-Marne",
    "95": "Val-d'Oise",
    "971": "Guadeloupe",
    "972": "Martinique",
    "973": "Guyane",
    "974": "La R√©union",
    "975": "Saint-Pierre-et-Miquelon",
    "976": "Mayotte",
    "2A": "Corse-du-Sud",
    "2B": "Haute-Corse",
  };
  return noms[code] || code;
}
